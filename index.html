<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Classroom History Challenge</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.7.77/Tone.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Akaya+Kanadaka&family=Architects+Daughter&family=Montserrat:wght@400;700;900&family=VT323&display=swap" rel="stylesheet">
    <style>
        /* Basic Animations */
        @keyframes gradient-animation {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        @keyframes shake {
            0% { transform: translate(1px, 1px) rotate(0deg); }
            10% { transform: translate(-1px, -2px) rotate(-1deg); }
            20% { transform: translate(-3px, 0px) rotate(1deg); }
            30% { transform: translate(3px, 2px) rotate(0deg); }
            40% { transform: translate(1px, -1px) rotate(1deg); }
            50% { transform: translate(-1px, 2px) rotate(-1deg); }
            60% { transform: translate(-3px, 1px) rotate(0deg); }
            70% { transform: translate(3px, 1px) rotate(-1deg); }
            80% { transform: translate(-1px, -1px) rotate(1deg); }
            90% { transform: translate(1px, 2px) rotate(0deg); }
            100% { transform: translate(1px, -2px) rotate(-1deg); }
        }
        @keyframes jiggle {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-1px); }
            50% { transform: translateX(1px); }
            75% { transform: translateX(-1px); }
        }
        @keyframes glow {
            0% { text-shadow: 0 0 5px #fff, 0 0 10px #fff; }
            50% { text-shadow: 0 0 10px #fff, 0 0 20px #fff, 0 0 30px #fff; }
            100% { text-shadow: 0 0 5px #fff, 0 0 10px #fff; }
        }
        @keyframes pulse-glow {
            0% { box-shadow: 8px 8px 0px #92400e, 0 0 15px #f59e0b; }
            50% { box-shadow: 8px 8px 0px #92400e, 0 0 30px #f97316, 0 0 15px #f59e0b; }
            100% { box-shadow: 8px 8px 0px #92400e, 0 0 15px #f59e0b; }
        }
        @keyframes active-boost-wiggle {
            0%, 100% { transform: rotate(0); }
            25% { transform: rotate(-3deg); }
            50% { transform: rotate(3deg); }
            75% { transform: rotate(-3deg); }
        }
        @keyframes red-flash-animation {
            0% { background-color: transparent; }
            50% { background-color: rgba(239, 68, 68, 0.5); }
            100% { background-color: transparent; }
        }
        @keyframes passive-ready-glow {
            0% { box-shadow: 6px 6px 0px #15803d, 0 0 10px #4ade80; }
            50% { box-shadow: 6px 6px 0px #15803d, 0 0 20px #4ade80, 0 0 10px #4ade80; }
            100% { box-shadow: 6px 6px 0px #15803d, 0 0 10px #4ade80; }
        }
        @keyframes timer-flash-green {
            0%, 100% { color: white; }
            50% { color: #86efac; }
        }
        @keyframes scanline {
            0% { background-position: 0 0; }
            100% { background-position: 0 100%; }
        }
        @keyframes typing {
            from { width: 0; }
            to { width: 100%; }
        }
        .typing-effect {
            overflow: hidden;
            white-space: nowrap;
            animation: typing 1s steps(60, end);
        }

        /* General Body and Layout */
        body {
            font-family: 'Montserrat', sans-serif;
            color: #111827;
            background: linear-gradient(-45deg, #f97316, #c026d3, #0ea5e9, #10b981);
            background-size: 400% 400%;
            animation: gradient-animation 15s ease infinite;
            overflow: hidden;
        }
        .red-flash::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            animation: red-flash-animation 0.5s ease-in-out;
            z-index: -1;
        }
        .main-container {
            display: grid;
            grid-template-columns: 3fr 1fr;
            grid-template-rows: auto 1fr;
            gap: 1.5rem;
            padding: 1.5rem;
            height: 100vh;
        }
        .header-grid {
            grid-column: 1 / -1;
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 1.5rem;
        }
        .right-panel {
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
            min-height: 0;
        }

        /* Card Styles */
        .card {
            border: 6px solid #111827;
            border-radius: 1.5rem;
            padding: 1rem;
            box-shadow: 8px 8px 0px #111827;
            text-align: center;
            font-weight: 700;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            background-color: rgba(255, 255, 255, 0.85);
            backdrop-filter: blur(10px);
        }
        .card h2 {
            font-family: 'Montserrat', sans-serif;
            font-weight: 900;
            text-transform: uppercase;
            font-size: 1.1rem;
            margin-bottom: 0.25rem;
            color: rgba(0,0,0,0.6);
        }
        .card.time-card h2, .card.score-card h2, .card.streak-card h2, .card.correct-card h2 {
            color: rgba(255,255,255,0.7);
        }
        .card .content {
            font-family: 'Architects Daughter', cursive;
            font-size: 2.5rem;
            line-height: 1.1;
        }
        .time-card { background-color: #ef4444; color: white; border-color: #991b1b; box-shadow: 8px 8px 0px #991b1b;}
        .time-card.flash-green { animation: timer-flash-green 0.5s ease-in-out 2; }
        .score-card { background-color: #22c55e; color: white; border-color: #14532d; box-shadow: 8px 8px 0px #14532d;}
        .streak-card { background-color: #a855f7; color: white; border-color: #5b21b6; box-shadow: 8px 8px 0px #5b21b6;}
        .correct-card { background-color: #2dd4bf; color: white; border-color: #0d9488; box-shadow: 8px 8px 0px #0d9488;}
        
        /* Header Buttons */
        .button-cluster {
            grid-column: 5 / 6;
            display: flex; flex-direction: column; gap: 0.75rem; justify-content: center;
            padding: 0; background: transparent; border: none; box-shadow: none;
        }
        .header-btn {
            color: white; border: 4px solid #111827; border-radius: 1rem; padding: 0.5rem;
            font-size: 1rem; font-weight: 900; cursor: pointer; transition: all 0.2s;
            box-shadow: 4px 4px 0px #111827;
        }
        .header-btn:hover { transform: translate(2px, 2px); box-shadow: 2px 2px 0px #111827; }
        #endTurnBtn { background-color: #8b5cf6; }
        #resetAllBtn { background-color: #ec4899; }
        #aboutBtn { background-color: #10b981; }

        /* Question Area */
        .question-container {
            background-color: #334155; border-color: #111827; box-shadow: 8px 8px 0px #111827;
            display: flex; flex-direction: column; gap: 1.5rem;
            transition: opacity 0.3s ease-in-out, transform 0.3s ease-in-out;
        }
        .question-container.switching { opacity: 0; transform: scale(0.95); }
        .question-container.shake { animation: shake 0.5s cubic-bezier(.36,.07,.19,.97) both; }
        .question-box {
            background-color: #fde047; border-color: #ca8a04; box-shadow: 8px 8px 0px #ca8a04;
            padding: 1rem; flex-grow: 1; display: flex; align-items: center; justify-content: space-between; gap: 1rem;
        }
        #questionText { 
            flex-grow: 1; 
            transition: font-size 0.3s ease-in-out; 
            text-align: center; 
            user-select: none;
            -webkit-user-select: none;
            -ms-user-select: none;
        }
        #hintBtn {
            background-color: #fb923c; border: 4px solid #c2410c; box-shadow: 4px 4px 0px #c2410c;
            border-radius: 50%; width: 60px; height: 60px; font-size: 1.5rem; font-weight: 900;
            flex-shrink: 0; cursor: pointer; transition: all 0.2s;
        }
        #hintBtn:hover { transform: translate(2px, 2px); box-shadow: 2px 2px 0px #c2410c; }
        .answer-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem; flex-grow: 2; }
        .answer-choice {
            background-color: #f59e0b; border-color: #92400e; box-shadow: 8px 8px 0px #92400e;
            cursor: pointer; transition: all 0.2s; display: flex; align-items: center;
            justify-content: center; padding: 1rem; font-size: 1.5rem; font-weight: 900;
        }
        .answer-choice:hover { transform: translate(4px, 4px); box-shadow: 4px 4px 0px #92400e; }
        .answer-choice.removed { 
            opacity: 0.3; cursor: not-allowed; background-color: #9ca3af; 
            border-color: #4b5563; box-shadow: none; transform: none; 
        }
        .correct { background-color: #22c55e !important; color: white !important; border-color: #14532d !important; box-shadow: 8px 8px 0px #14532d !important; }
        .incorrect { background-color: #ef4444 !important; color: white !important; border-color: #991b1b !important; box-shadow: 8px 8px 0px #991b1b !important; }

        /* Abilities Section */
        .abilities-container {
            background-color: #fde047; border-color: #ca8a04; box-shadow: 8px 8px 0px #ca8a04;
            padding: 1rem;
             /* Layout Fix */
            flex: 1; 
            min-height: 0; 
            display: flex; 
            flex-direction: column;
        }
        .abilities-title {
            font-family: 'Akaya Kanadaka', cursive; 
            font-size: 2.25rem;
            padding-bottom: 0.5rem; margin-bottom: 1rem; color: #ca8a04;
        }
        .abilities-layout {
            display: flex;
            flex-direction: column;
            gap: 1rem;
            width: 100%;
        }
        .top-abilities {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 0.75rem;
        }
        .ability-btn {
            background-color: #fefce8; border: 4px solid #eab308; box-shadow: 4px 4px 0px #eab308;
            padding: 0.5rem; transition: all 0.2s; border-radius: 1rem; font-weight: 900;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            position: relative;
            width: 100%;
        }
        .ability-btn.locked { opacity: 0.5; cursor: not-allowed; background-color: #e2e8f0; }
        .ability-btn.earned { cursor: pointer; }
        .ability-btn.earned:hover { transform: translateY(-2px); box-shadow: 6px 6px 0px #eab308; }
        .ability-btn.active { border-color: #92400e; }
        #abilityBoost {
            padding: 0.75rem;
            font-size: 1.25rem;
        }
        #abilityBoost.active {
            animation: pulse-glow 1.5s infinite, active-boost-wiggle 0.5s ease-in-out infinite;
        }
        .ability-btn .uses {
            position: absolute; top: -10px; right: -10px; background-color: #dc2626; color: white;
            border-radius: 50%; width: 24px; height: 24px; display: flex; justify-content: center;
            align-items: center; font-size: 0.875rem; font-weight: 900; border: 2px solid white;
        }
        #abilityInfoBtn {
            background-color: #fb923c; border-color: #c2410c; box-shadow: 4px 4px 0px #c2410c;
            color: white; font-size: 1.1rem;
        }
        .passive-ability {
            background-color: #dcfce7; border: 4px solid #16a34a; box-shadow: 6px 6px 0px #15803d;
            border-radius: 1rem; padding: 0.5rem; text-align: left; position: relative;
            width: 100%;
            transition: transform 0.2s;
        }
        .passive-ability.jiggle {
            animation-name: jiggle;
            animation-iteration-count: infinite;
        }
        .passive-ability.ready { animation: passive-ready-glow 1.5s infinite; }
        .passive-ability-title { font-weight: 900; font-size: 0.9rem; }
        .progress-bar-container {
            width: 100%; background-color: #a7f3d0; border-radius: 0.5rem;
            height: 1.25rem; border: 2px solid #15803d;
        }
        .progress-bar {
            background-color: #22c55e; height: 100%; border-radius: 0.25rem;
            transition: width 0.3s ease-in-out;
        }
        .panther-buck-counter {
            position: absolute; top: -10px; right: -10px; background-color: #a855f7;
            color: white; border-radius: 0.75rem; padding: 0.1rem 0.5rem;
            font-size: 0.875rem; font-weight: 900; border: 2px solid white;
        }

        /* Notification Panel */
        #notificationPanel {
            background: #1e293b;
            border: 6px solid #111827;
            box-shadow: 8px 8px 0px #111827, inset 0 0 15px rgba(0,0,0,0.5);
            border-radius: 1.5rem;
            padding: 1rem;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            overflow: hidden;
            background-image: linear-gradient(rgba(255, 255, 255, 0.05) 1px, transparent 1px);
            background-size: 100% 3px;
            animation: scanline 1s linear infinite;
        }
        #notificationText {
            font-family: 'VT323', monospace;
            font-size: 1.5rem;
            color: #93c5fd;
            text-shadow: 0 0 5px #2563eb, 0 0 10px #2563eb;
            width: 100%;
        }

        /* Modals */
        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background-color: rgba(0, 0, 0, 0.7); display: flex;
            justify-content: center; align-items: center; z-index: 100;
        }
        .modal-content {
            background-color: white; padding: 2rem; border-radius: 1.5rem;
            border: 6px solid #111827; box-shadow: 8px 8px 0px #111827;
            text-align: left; max-width: 600px;
        }
        .modal-content h2 { font-family: 'Akaya Kanadaka', cursive; text-align: center; }
        .modal-button {
            margin: 0.5rem; padding: 0.75rem 2rem; border-radius: 0.75rem;
            border: 4px solid #111827; font-weight: 700; cursor: pointer; transition: all 0.2s;
        }
        .modal-button:hover { transform: translate(4px, 4px); box-shadow: none; }

        /* FIXES FOR LAYOUT AND TIMER */
        #timer {
            font-family: 'VT323', monospace;
        }
        #notificationPanel {
            flex-shrink: 0; /* Prevents this from being pushed off-screen */
        }

        /* Responsive Design */
        @media (max-width: 1024px) {
            .main-container { grid-template-columns: 1fr; height: auto; overflow-y: auto; }
            .header-grid { grid-template-columns: 1fr 1fr; }
            .button-cluster { grid-column: 1 / -1; flex-direction: row; }
            .right-panel { flex-direction: column; }
        }
    </style>
</head>
<body>

    <!-- MODALS -->
    <div id="groupInfoModal" class="modal-overlay">
        <div class="modal-content" style="text-align: center;">
            <h2 class="text-4xl font-bold mb-4">History Challenge</h2>
            <div class="mb-4">
                <label for="gradeLevelSelect" class="text-xl mb-2 block">Select Grade Level:</label>
                <select id="gradeLevelSelect" class="w-full p-3 text-xl border-4 border-gray-800 rounded-xl">
                    <option value="grade6">6th Grade</option>
                    <option value="grade7">7th Grade</option>
                    <option value="grade8" selected>8th Grade</option>
                </select>
            </div>
            <button id="startGameBtn" class="modal-button bg-blue-500 text-white mt-6" style="box-shadow: 4px 4px 0px #111827;">Start Game!</button>
        </div>
    </div>
    <div id="endGameModal" class="modal-overlay hidden">
        <div class="modal-content" style="text-align: center;">
            <h2 class="text-5xl font-bold mb-4">Time's Up!</h2>
            <p class="text-3xl mb-6">You scored <span id="finalScore" class="font-bold text-green-500"></span> points!</p>
            <button id="newGameBtn" class="modal-button bg-blue-500 text-white" style="box-shadow: 4px 4px 0px #111827;">Play Again</button>
        </div>
    </div>
    <div id="aboutModal" class="modal-overlay hidden">
        <div class="modal-content" style="text-align: center;">
            <h2 class="text-4xl font-bold mb-4">About the Creator</h2>
            <p class="text-xl mb-6">This app was created by Mr. Lopez Torres, a Social Studies teacher at Woodlawn Middle School, to make learning history fun and interactive for his students. Go Panthers!</p>
            <button id="closeAboutBtn" class="modal-button bg-gray-500 text-white" style="box-shadow: 4px 4px 0px #111827;">Close</button>
        </div>
    </div>
    <div id="resetConfirmModal" class="modal-overlay hidden">
        <div class="modal-content" style="text-align: center;">
            <h2 class="text-4xl font-bold mb-4">Reset Game?</h2>
            <p class="text-xl mb-6">Are you sure? This will restart the game.</p>
            <div>
                <button id="confirmResetBtn" class="modal-button bg-red-500 text-white" style="box-shadow: 4px 4px 0px #111827;">Yes, Reset!</button>
                <button id="cancelResetBtn" class="modal-button bg-gray-500 text-white" style="box-shadow: 4px 4px 0px #111827;">Cancel</button>
            </div>
        </div>
    </div>
    <div id="hintModal" class="modal-overlay hidden">
        <div class="modal-content" style="text-align: center;">
            <h2 class="text-4xl font-bold mb-4">Here's a Hint!</h2>
            <p id="hintText" class="text-2xl mb-6"></p>
            <button id="closeHintBtn" class="modal-button bg-gray-500 text-white" style="box-shadow: 4px 4px 0px #111827;">Got it!</button>
        </div>
    </div>
    <div id="streakModal" class="modal-overlay hidden">
        <div class="modal-content" style="text-align: center;">
            <h2 class="text-5xl font-bold mb-4 text-purple-600 animate-[glow_1.5s_ease-in-out_infinite]">POWER UP!</h2>
            <p id="streakText" class="text-2xl mb-6"></p>
            <button id="closeStreakBtn" class="modal-button bg-purple-500 text-white">Awesome!</button>
        </div>
    </div>
    <div id="abilityInfoModal" class="modal-overlay hidden">
        <div class="modal-content">
            <h2 class="text-4xl font-bold mb-4">How Abilities Work</h2>
            <div class="space-y-4 text-lg">
                <p><strong class="text-purple-600">Passive Abilities (they happen automatically!):</strong></p>
                <ul class="list-disc list-inside ml-4 space-y-2">
                    <li><strong>Time Tinkerer:</strong> Get a <strong>4-question streak</strong> to add <strong>15 seconds</strong> back to the clock!</li>
                    <li><strong>Historian's Hunch:</strong> For every <strong>5 total correct answers</strong>, one wrong choice will be removed on the next question.</li>
                    <li><strong>Panther Bucks:</strong> For every <strong>10 total correct answers</strong>, you earn a Panther Buck! (Careful: a 4-wrong streak resets progress!)</li>
                </ul>
                <p><strong class="text-purple-600">Active Abilities (you have to click them!):</strong></p>
                <ul class="list-disc list-inside ml-4 space-y-2">
                    <li><strong class="text-blue-600">SKIP QUESTION:</strong> Earned at a <strong>3-question streak</strong>. Use it to pass a tricky question.</li>
                    <li><strong class="text-green-600">SECOND CHANCE:</strong> Earned at a <strong>5-question streak</strong>. Brings back your last two wrong answers for another try.</li>
                    <li><strong class="text-red-600">2x SCORE BOOST:</strong> Earned at a <strong>7-question streak</strong>. Doubles your points until you get one wrong.</li>
                </ul>
            </div>
            <div class="text-center mt-6">
                 <button id="closeAbilityInfoBtn" class="modal-button bg-gray-500 text-white" style="box-shadow: 4px 4px 0px #111827;">Got It!</button>
            </div>
        </div>
    </div>
    <div id="pantherBuckModal" class="modal-overlay hidden">
        <div class="modal-content" style="text-align: center;">
            <h2 class="text-5xl font-bold mb-4 text-purple-600 animate-[glow_1.5s_ease-in-out_infinite]">PANTHER BUCK!</h2>
            <p class="text-2xl mb-6">You've earned a Panther Buck! See Mr. Lopez Torres to claim your reward!</p>
            <button id="closePantherBuckBtn" class="modal-button bg-purple-500 text-white">Awesome!</button>
        </div>
    </div>


    <!-- MAIN CONTENT -->
    <main class="main-container">
        <header id="headerGrid" class="header-grid">
            <div class="card time-card" id="timeCard">
                <h2>Time</h2>
                <p id="timer" class="content">05:00</p>
            </div>
            <div class="card score-card">
                <h2>Score</h2>
                <p id="score" class="content">0</p>
            </div>
            <div class="card streak-card">
                <h2>Streak</h2>
                <p id="streak" class="content">0</p>
            </div>
            <div class="card correct-card">
                <h2>Correct</h2>
                <p id="correctAnswers" class="content">0</p>
            </div>
            <div class="button-cluster">
                <button id="endTurnBtn" class="header-btn">End Game</button>
                <button id="resetAllBtn" class="header-btn">Reset</button>
                <button id="aboutBtn" class="header-btn">About</button>
            </div>
        </header>

        <section id="gameArea" class="card question-container">
            <div id="questionBox" class="card question-box">
                <p id="questionText"></p>
                <button id="hintBtn">?</button>
            </div>
            <div class="answer-grid">
                <div class="card answer-choice" data-choice="0"><p></p></div>
                <div class="card answer-choice" data-choice="1"><p></p></div>
                <div class="card answer-choice" data-choice="2"><p></p></div>
                <div class="card answer-choice" data-choice="3"><p></p></div>
            </div>
        </section>

        <!-- Right panel containing abilities and notifications -->
        <div class="right-panel">
            <section id="abilitiesContainer" class="card abilities-container">
                <h2 class="abilities-title">Abilities</h2>
                <div class="abilities-layout">
                    <!-- Passive Abilities Section -->
                    <div class="passive-abilities-container space-y-2">
                        <div id="pantherBuckAbility" class="passive-ability">
                             <div id="pantherBuckCounter" class="panther-buck-counter">0 üêæ</div>
                            <p class="passive-ability-title">Panther Bucks (Next: 10)</p>
                            <div class="progress-bar-container">
                                <div id="pantherBuckProgress" class="progress-bar" style="width: 0%;"></div>
                            </div>
                        </div>
                        <div id="hunchAbility" class="passive-ability">
                            <p class="passive-ability-title">Historian's Hunch (Next: 5)</p>
                            <div class="progress-bar-container">
                                <div id="hunchProgress" class="progress-bar" style="width: 0%;"></div>
                            </div>
                        </div>
                        <div id="tinkerAbility" class="passive-ability">
                            <p class="passive-ability-title">Time Tinkerer (Streak)</p>
                            <div class="progress-bar-container">
                                <div id="tinkerProgress" class="progress-bar" style="width: 0%;"></div>
                            </div>
                        </div>
                    </div>
                    <!-- Active Abilities Section -->
                    <div class="top-abilities">
                        <button id="abilitySkip" class="ability-btn locked">
                            <span>SKIP</span>
                            <div id="skipUses" class="uses hidden"></div>
                        </button>
                        <button id="abilityRedo" class="ability-btn locked">
                            <span>REDO</span>
                            <div id="redoUses" class="uses hidden"></div>
                        </button>
                    </div>
                    <button id="abilityBoost" class="ability-btn locked">
                        <span>2x BOOST</span>
                    </button>
                    <button id="abilityInfoBtn" class="ability-btn earned">
                        <span>HOW TO USE</span>
                    </button>
                </div>
            </section>
            <div id="notificationPanel">
                <p id="notificationText"></p>
            </div>
        </div>
    </main>

    <script>
        // --- DATA ---
        const allQuestions = {
            grade6: [
                // Geography
                { question: "Which colonial region had rocky soil, long winters, and many forests?", choices: ["New England Colonies", "Middle Colonies", "Southern Colonies", "Western Territories"], answer: 0, hint: "This region's geography made farming difficult." },
                { question: "The Middle Colonies were known as the 'breadbasket' because their geography was good for growing...", choices: ["Tobacco and rice", "Wheat and other grains", "Cotton and indigo", "Lumber and furs"], answer: 1, hint: "This crop is used to make bread." },
                { question: "Which region had a warm climate and rich, fertile soil ideal for large-scale agriculture?", choices: ["New England Colonies", "Middle Colonies", "Southern Colonies", "Canadian Provinces"], answer: 2, hint: "This region's climate was good for growing cash crops." },
                { question: "Natural harbors and dense forests in New England led to an economy based on...", choices: ["Plantation farming", "Growing wheat", "Ranching cattle", "Shipbuilding and trade"], answer: 3, hint: "The ocean and trees were their most valuable resources." },
                { question: "The geography of the Southern Colonies, with its many wide rivers, was good for...", choices: ["Building many large cities", "Transporting crops from plantations", "Creating a lot of small family farms", "Mining for gold and silver"], answer: 1, hint: "These waterways acted like highways for trade." },
                
                // Religion
                { question: "Which religious group sought to 'purify' the Church of England and was dominant in New England?", choices: ["The Quakers", "The Catholics", "The Puritans", "The Baptists"], answer: 2, hint: "They wanted a stricter, more serious form of worship." },
                { question: "The Middle Colonies were known for the most religious...", choices: ["Intolerance", "Strictness", "Diversity", "Uniformity"], answer: 2, hint: "Groups like Quakers, Catholics, and Jews all settled here." },
                { question: "The official, established church in many Southern colonies like Virginia was the...", choices: ["Quaker Church", "Puritan Church", "Catholic Church", "Anglican Church"], answer: 3, hint: "This was also known as the Church of England." },
                { question: "Which colony was founded by Quakers, a group that believed in peace and religious tolerance?", choices: ["Massachusetts", "Pennsylvania", "Virginia", "Georgia"], answer: 1, hint: "This Middle Colony was founded by William Penn." },
                { question: "In New England, government was often closely linked with...", choices: ["The King of England", "The Catholic Pope", "The Puritan religion", "Economic companies"], answer: 2, hint: "Only male church members could vote in many areas." },
                
                // Education
                { question: "Which colonial region placed the highest importance on public education, mainly to teach children to read the Bible?", choices: ["New England Colonies", "Middle Colonies", "Southern Colonies", "The Frontier"], answer: 0, hint: "This region passed laws requiring towns to have schools." },
                { question: "In the Southern colonies, education was usually handled by...", choices: ["Public school systems", "The local church", "Wealthy families hiring private tutors", "The government in England"], answer: 2, hint: "Large distances between homes made public schools difficult." },
                { question: "Education in the Middle Colonies was often...", choices: ["Run by the government", "Forbidden for most people", "Focused only on farming", "Run by different religious groups"], answer: 3, hint: "Each church or group often had its own school." },
                { question: "Harvard College was founded in which colonial region to train ministers?", choices: ["The Caribbean", "The Southern Colonies", "The Middle Colonies", "New England"], answer: 3, hint: "It is the oldest university in the United States." },
                { question: "For most children in the Southern Colonies, what was the most likely form of education?", choices: ["Attending a large public school", "Learning from a private tutor", "Going to a religious school", "Learning trades at home"], answer: 3, hint: "Practical skills were often prioritized over formal schooling for many." },
                
                // Economy
                { question: "The economy of the Southern colonies was based mainly on what activity?", choices: ["Shipbuilding and fishing", "Large-scale agriculture", "Trade and manufacturing", "Fur trapping and logging"], answer: 1, hint: "This involved growing cash crops on plantations." },
                { question: "What were the main economic activities in the New England colonies?", choices: ["Growing tobacco and rice", "Farming wheat and corn", "Fishing, whaling, and shipbuilding", "Mining for silver and gold"], answer: 2, hint: "Their economy was tied to the Atlantic Ocean." },
                { question: "The economy of the Middle Colonies was a mix of...", choices: ["Only farming and mining", "Only whaling and fishing", "Only trade and shipbuilding", "Farming, trade, and crafts"], answer: 3, hint: "This region had a balanced and diverse economy." },
                { question: "Large farms called plantations that used enslaved labor were most common in which region?", choices: ["New England Colonies", "Middle Colonies", "Southern Colonies", "Northwest Territory"], answer: 2, hint: "This system was used to grow labor-intensive crops like tobacco." },
                { question: "The cities of Philadelphia and New York became major centers of trade in which region?", choices: ["New England", "The South", "The Middle Colonies", "The West"], answer: 2, hint: "These cities had excellent harbors and were centers of commerce." },
                
                // Government
                { question: "Town meetings, where citizens gathered to make local laws, were an important part of government in which region?", choices: ["The Southern Colonies", "The Middle Colonies", "The New England Colonies", "The Spanish Colonies"], answer: 2, hint: "This was a very direct form of democracy." },
                { question: "The House of Burgesses, the first representative assembly in the colonies, was established in...", choices: ["Massachusetts", "Pennsylvania", "New York", "Virginia"], answer: 3, hint: "This Southern colony pioneered this form of government." },
                { question: "Which colonial region had a government that was most tolerant of different religions and cultures?", choices: ["New England", "Middle Colonies", "Southern Colonies", "The French Territories"], answer: 1, hint: "Leaders like William Penn promoted religious freedom." },
                { question: "In the Southern colonies, political power was often held by...", choices: ["Small family farmers", "Wealthy plantation owners", "Religious leaders", "Elected town councils"], answer: 1, hint: "Land ownership was often linked to political influence." },
                { question: "The Fundamental Orders of Connecticut was an early written constitution from which region?", choices: ["New England", "The South", "The Middle Colonies", "The West Indies"], answer: 0, hint: "This document is sometimes called the first written constitution in America." },
                
                // Comparative Questions
                { question: "Which region was the most ethnically and religiously diverse?", choices: ["New England", "Southern Colonies", "Middle Colonies", "All regions were the same"], answer: 2, hint: "This region attracted immigrants from many different European countries." },
                { question: "Rocky soil was a major geographic feature of the ____, while fertile soil was a feature of the ____.", choices: ["South, New England", "New England, South", "Middle, New England", "South, Middle"], answer: 1, hint: "One region was good for small farms, the other for large plantations." },
                { question: "If you were a Puritan who wanted to live in a strictly religious society, you would most likely move to...", choices: ["Pennsylvania", "Virginia", "Massachusetts", "Maryland"], answer: 2, hint: "This was the heart of the New England colonies." },
                { question: "A blacksmith in Philadelphia would be working in which colonial region?", choices: ["New England", "The Southern Colonies", "The Middle Colonies", "The French colonies"], answer: 2, hint: "This region had large cities that were centers for skilled craftsmen." },
                { question: "Which statement is true about the economies of the three colonial regions?", choices: ["They were all based on farming", "They were all focused on trade", "Their economies were shaped by their geography", "They all depended on mining"], answer: 2, hint: "What they could grow or produce depended on their climate and resources." },
                { question: "Cash crops like tobacco and indigo were vital to the economy of the...", choices: ["New England Colonies", "Middle Colonies", "Southern Colonies", "All of the colonies"], answer: 2, hint: "These crops required a warm climate and a long growing season." },
                { question: "Unlike the South, the New England colonies had an economy that depended heavily on...", choices: ["Large plantations", "The Atlantic Ocean", "Growing wheat", "Trade with Spain"], answer: 1, hint: "Activities like fishing and shipbuilding were key industries." },
                { question: "Which region's government was most influenced by a single religious group?", choices: ["New England (Puritans)", "Middle (Quakers)", "Southern (Anglicans)", "All were equal"], answer: 0, hint: "In this region, church and state were very closely connected." },
                { question: "The 'breadbasket' colonies were located in which region?", choices: ["New England", "The South", "The West", "The Middle Colonies"], answer: 3, hint: "They produced a large amount of grain for the other colonies." },
                { question: "Why was there less need for public schools in the Southern Colonies compared to New England?", choices: ["People in the South were not religious", "The population was more spread out on farms", "The South had no large cities", "The King of England outlawed schools"], answer: 1, hint: "Long distances made it hard for children to gather in one place." },
                { question: "Which two regions had economies that heavily relied on port cities for trade?", choices: ["South and West", "New England and Middle", "South and Middle", "New England and West"], answer: 1, hint: "Cities like Boston, New York, and Philadelphia were vital." },
                { question: "A government that promotes religious tolerance would most likely be found in...", choices: ["Massachusetts", "Pennsylvania", "Virginia", "All three"], answer: 1, hint: "This colony was founded on the principles of the Quakers." },
                { question: "Long, cold winters and a short growing season best describe the climate of the...", choices: ["Southern Colonies", "Middle Colonies", "New England Colonies", "Caribbean islands"], answer: 2, hint: "This made it difficult to grow cash crops." },
                { question: "Which region's social life often revolved around the town and the church?", choices: ["Southern Colonies", "New England Colonies", "Middle Colonies", "The Frontier"], answer: 1, hint: "Communities were closer together in this region." },
                { question: "The use of enslaved African labor was most widespread in the...", choices: ["New England Colonies", "Middle Colonies", "Southern Colonies", "French Canada"], answer: 2, hint: "The plantation economy depended on this system." },
                { question: "Which region had the most balanced economy, with a mix of farming, trade, and skilled labor?", choices: ["New England", "Middle Colonies", "Southern Colonies", "All were balanced"], answer: 1, hint: "This region was not dominated by a single industry." },
                { question: "A colonist who wanted to live on a large tobacco plantation would move to...", choices: ["New Hampshire", "New Jersey", "Georgia", "Rhode Island"], answer: 2, hint: "This crop was a key part of the Southern economy." },
                { question: "Which list correctly matches a product with its most likely region?", choices: ["Tobacco - New England", "Wheat - Southern", "Ships - Middle", "Fish - New England"], answer: 3, hint: "Consider which region's economy was most tied to the ocean." },
                { question: "The Mayflower Compact and Town Meetings are examples of government from which region?", choices: ["New England", "Middle Colonies", "Southern Colonies", "The West"], answer: 0, hint: "These were early forms of self-rule in the northernmost colonies." },
                { question: "Which region offered the greatest amount of freedom for different religious groups?", choices: ["New England", "Middle Colonies", "Southern Colonies", "All were very strict"], answer: 1, hint: "It was known for its diversity and tolerance." },
                { question: "What geographic feature did all three colonial regions share?", choices: ["Large mountain ranges", "A coastline on the Atlantic Ocean", "Dry, desert-like conditions", "Vast, open prairies"], answer: 1, hint: "This feature was essential for trade, travel, and resources." },
                { question: "The term 'triangular trade' would be most associated with the economy of...", choices: ["The Southern Colonies only", "The New England Colonies only", "The Middle Colonies only", "All three regions"], answer: 3, hint: "Merchants from all regions participated in this complex trade network." },
                { question: "Which region's government was most likely to be run by an elite class of wealthy landowners?", choices: ["New England", "Middle Colonies", "Southern Colonies", "No region was like this"], answer: 2, hint: "The county government system gave power to influential planters." },
                { question: "If you wanted to start a small family farm growing wheat, the best region to move to would be the...", choices: ["New England Colonies", "Middle Colonies", "Southern Colonies", "Florida Territory"], answer: 1, hint: "This region was known for its fertile soil and grain production." },
                { question: "Which statement best contrasts the New England and Southern colonies?", choices: ["The South had small farms, New England had plantations.", "The South was religious, New England was not.", "The South relied on farming, New England on trade.", "The South had a cold climate, New England a warm one."], answer: 2, hint: "Their different geographies led to very different economies." }
            ],
            grade7: [
                { question: "From which country did the U.S. purchase the Louisiana Territory?", choices: ["Spain", "Great Britain", "France", "Russia"], answer: 2, hint: "This country was led by Napoleon Bonaparte at the time." },
                { question: "What was the primary goal of the American diplomats sent to France regarding Louisiana?", choices: ["To buy all of the territory", "To secure trading rights in New Orleans", "To form a military alliance", "To claim the land for free"], answer: 1, hint: "Control of the Mississippi River's port was crucial for American farmers." },
                { question: "The Louisiana Purchase in 1803 had what major effect on the size of the United States?", choices: ["It slightly increased its size", "It had no effect on the size", "It nearly doubled its size", "It tripled the country's area"], answer: 2, hint: "It was one of the largest land deals in history." },
                { question: "Who were the two primary leaders of the expedition to explore the Louisiana Purchase?", choices: ["Hamilton and Burr", "Lewis and Clark", "Adams and Washington", "Dunbar and Hunter"], answer: 1, hint: "Their last names are famously linked with this journey." },
                { question: "What was the official name of the Lewis and Clark expedition?", choices: ["The Corps of Discovery", "The Westward Journey", "The Pacific Explorers", "The American Voyagers"], answer: 0, hint: "Their mission was one of science and exploration." },
                { question: "A major goal of the Lewis and Clark expedition was to find a water route to which ocean?", choices: ["The Atlantic Ocean", "The Arctic Ocean", "The Indian Ocean", "The Pacific Ocean"], answer: 3, hint: "They were searching for the legendary Northwest Passage." },
                { question: "Which Native American woman served as a crucial guide and interpreter for Lewis and Clark?", choices: ["Pocahontas", "Sacagawea", "La Malinche", "Matoaka"], answer: 1, hint: "Her presence with her baby helped show the expedition was peaceful." },
                { question: "The Twelfth Amendment was created to solve a problem with which process?", choices: ["The way laws are passed", "The election of the President", "The appointment of judges", "The creation of new states"], answer: 1, hint: "It was a response to the confusing outcome of the 1800 election." },
                { question: "In the election of 1800, Thomas Jefferson famously tied with whom, leading to the 12th Amendment?", choices: ["John Adams", "Alexander Hamilton", "George Washington", "Aaron Burr"], answer: 3, hint: "He was supposed to be Jefferson's Vice President." },
                { question: "What did the Twelfth Amendment change about the voting process in the Electoral College?", choices: ["It gave each state one vote", "It allowed women to vote", "It created separate ballots for President and VP", "It lowered the voting age"], answer: 2, hint: "This prevented the President and Vice President from being from opposing parties." },
                { question: "The Dunbar-Hunter Expedition, also known as the Grand Expedition, explored which river?", choices: ["The Missouri River", "The Columbia River", "The Red River", "The Ouachita River"], answer: 3, hint: "This river flows through present-day Arkansas and Louisiana." },
                { question: "A key scientific purpose of the Dunbar-Hunter expedition was to study what natural feature?", choices: ["The Grand Canyon", "The Rocky Mountains", "The Hot Springs of Arkansas", "The Great Lakes"], answer: 2, hint: "Jefferson was very interested in the geology and minerals of this area." },
                { question: "The Red River Expedition was tasked with exploring the border between the Louisiana Purchase and what territory?", choices: ["British Canada", "Russian Alaska", "Spanish Texas", "French Quebec"], answer: 2, hint: "The exact boundaries of the new territory were not clear." },
                { question: "Which country's military forces stopped the Red River Expedition and forced it to turn back?", choices: ["Great Britain", "France", "Spain", "Mexico"], answer: 2, hint: "This European power still controlled the territory to the south." },
                { question: "President Jefferson had a constitutional concern about the Louisiana Purchase related to what?", choices: ["The high cost of the land", "The power of the president to buy land", "The rights of the people living there", "The morality of the transaction"], answer: 1, hint: "The Constitution did not explicitly grant him this authority." },
                { question: "Which French leader sold the Louisiana Territory to the United States?", choices: ["King Louis XVI", "Robespierre", "Napoleon Bonaparte", "Charles de Gaulle"], answer: 2, hint: "He needed money to fund his wars in Europe." },
                { question: "The Lewis and Clark expedition began its journey near which city?", choices: ["New Orleans", "Philadelphia", "St. Louis", "Washington D.C."], answer: 2, hint: "This city was known as the 'Gateway to the West'." },
                { question: "One of the main scientific tasks for Lewis and Clark was to...", choices: ["Search for ancient ruins", "Document new plants and animals", "Measure the height of mountains", "Predict the weather patterns"], answer: 1, hint: "Jefferson was a scientist himself and wanted to know about the new territory." },
                { question: "Before the 12th Amendment, how was the Vice President determined?", choices: ["The president appointed them", "The Senate voted for them", "The candidate with the second most votes", "The Speaker of the House became VP"], answer: 2, hint: "This system could lead to political rivals serving together." },
                { question: "The Red River and Dunbar-Hunter expeditions are less famous than Lewis and Clark's because they...", choices: ["Were considered total failures", "Did not have presidential support", "Covered less territory and were shorter", "Lost all of their records"], answer: 2, hint: "Lewis and Clark's cross-continental journey was a much grander accomplishment." },
                { question: "The Louisiana Purchase gave the U.S. full control of which vital waterway?", choices: ["The Ohio River", "The St. Lawrence River", "The Mississippi River", "The Rio Grande"], answer: 2, hint: "This was essential for farmers in the west to transport their goods." },
                { question: "What was the final cost of the Louisiana Purchase, which amounted to pennies per acre?", choices: ["$1 million", "$5 million", "$15 million", "$50 million"], answer: 2, hint: "It is considered one of the best bargains in history." },
                { question: "What did the Lewis and Clark expedition accomplish regarding the U.S. claim to the Oregon Territory?", choices: ["It gave up the claim", "It had no effect on the claim", "It weakened the claim", "It strengthened the claim"], answer: 3, hint: "Their presence in the region gave the U.S. a stronger basis for its claim." },
                { question: "The rise of what made the original system of electing a president and vice president unworkable?", choices: ["Large states", "Political parties", "A powerful Supreme Court", "A large standing army"], answer: 1, hint: "When candidates ran as a team, the old system created problems." },
                { question: "Thomas Jefferson belonged to which political party?", choices: ["The Federalists", "The Whigs", "The Democratic-Republicans", "The No-Nothing Party"], answer: 2, hint: "This party favored states' rights and a farming-based economy." },
                { question: "The Dunbar-Hunter and Red River expeditions were part of Jefferson's plan to...", choices: ["Find gold in the south", "Scientifically explore all of Louisiana", "Build forts along the border", "Create new states immediately"], answer: 1, hint: "He sent out multiple expeditions to map the new territory." },
                { question: "William Clark's primary role during the expedition was as the official...", choices: ["Doctor and physician", "Mapmaker and geographer", "Cook and quartermaster", "Musician and artist"], answer: 1, hint: "His detailed maps of the West were incredibly valuable." },
                { question: "Meriwether Lewis's primary role before and during the expedition was as the official...", choices: ["Lead scientist and naturalist", "Treasurer and accountant", "Ship captain and navigator", "Blacksmith and gunsmith"], answer: 0, hint: "Jefferson personally trained him to document the flora and fauna." },
                { question: "The 12th Amendment requires a person to receive what to be elected president?", choices: ["A plurality of the popular vote", "A majority of electoral votes", "The approval of the Supreme Court", "A unanimous vote in Congress"], answer: 1, hint: "This is the 'magic number' a candidate needs to win." },
                { question: "Why was Napoleon so willing to sell the Louisiana Territory in 1803?", choices: ["He disliked the territory", "He needed money for his wars in Europe", "The people there voted to join the U.S.", "He was a close friend of Jefferson"], answer: 1, hint: "His failures in Haiti also made an American empire seem less appealing." },
                { question: "The Lewis and Clark expedition spent a long, cold winter with which Native American tribes?", choices: ["The Apache and Navajo", "The Cherokee and Creek", "The Mandan and Hidatsa", "The Iroquois and Algonquin"], answer: 2, hint: "It was during this winter that they met Sacagawea." },
                { question: "The 'Corps of Discovery' ultimately proved that a direct, all-water route to the Pacific...", choices: ["Was easy to find and use", "Was controlled by the Spanish", "Did not exist as people hoped", "Could only be used in summer"], answer: 2, hint: "They had to cross the formidable Rocky Mountains." },
                { question: "The Red River Expedition is also known by the names of its leaders, who were...", choices: ["Mason and Dixon", "Pike and Long", "Freeman and Custis", "Bonneville and Fr√©mont"], answer: 2, hint: "This expedition is often referred to by their combined last names." },
                { question: "After the 12th Amendment, electors cast how many votes?", choices: ["One vote for a president/VP team", "One vote for president only", "Two votes: one for president, one for VP", "One vote for any candidate they wished"], answer: 2, hint: "The amendment clarified the voting process significantly." },
                { question: "The territory gained in the Louisiana Purchase stretched west from the Mississippi River to the...", choices: ["Appalachian Mountains", "Sierra Nevada Mountains", "Pacific Ocean", "Rocky Mountains"], answer: 3, hint: "This massive mountain range formed the rough western boundary." },
                { question: "Who did President Jefferson send to France to help Robert Livingston negotiate for New Orleans?", choices: ["James Madison", "John Marshall", "James Monroe", "Aaron Burr"], answer: 2, hint: "This future president's arrival helped finalize the deal." },
                { question: "Jefferson's vision for the west was that it would be populated by...", choices: ["Large industrial cities", "Wealthy plantation owners", "Small, independent farmers", "Military bases and forts"], answer: 2, hint: "He called this an 'Empire of Liberty'." },
                { question: "The main reason the Spanish stopped the Red River expedition was because...", choices: ["They believed it was a military mission", "They were allies with the French", "They had already explored the area", "The explorers were being too loud"], answer: 0, hint: "They saw the American explorers as a threat to their territory." },
                { question: "How long did the Lewis and Clark expedition's round trip take to complete?", choices: ["About six months", "Roughly one year", "More than two years", "Almost five years"], answer: 2, hint: "It was an incredibly long and difficult journey." },
                { question: "The Twelfth Amendment was necessary because the Constitution's original text did not account for...", choices: ["The existence of political parties", "The possibility of a tie vote", "The large number of new states", "The president dying in office"], answer: 0, hint: "The Founders didn't anticipate candidates running as a team." }
            ],
            grade8: [
                // Standard A: Growth of Industrial Economy
                { question: "Which economic system is based on private ownership and the pursuit of profit?", choices: ["Communism", "Socialism", "Capitalism", "Mercantilism"], answer: 2, hint: "This system encourages competition in a free market." },
                { question: "The U.S. government's 'laissez-faire' policy in the late 1800s meant it...", choices: ["Heavily regulated businesses", "Owned the major industries", "Interfered very little in the economy", "Set prices for most products"], answer: 2, hint: "This French term means 'let it be' or 'hands-off'." },
                { question: "Mass production, such as the use of the assembly line, led to what effect?", choices: ["Goods became more expensive", "Fewer products were made", "Products became much cheaper", "Workers' skills increased"], answer: 2, hint: "Making things faster and more efficiently lowers the cost." },
                { question: "A major effect of agricultural advancements like the mechanical reaper was...", choices: ["More people were needed to work on farms", "Fewer people were needed to grow food", "The price of food increased dramatically", "People moved from cities to farms"], answer: 1, hint: "New machines could do the work of many people." },
                { question: "The rise of corporations was a major factor in industrial growth because they could...", choices: ["Raise large amounts of money", "Avoid paying any taxes", "Only hire a few workers", "Operate without leaders"], answer: 0, hint: "Selling stock to investors allows for massive projects." },
                { question: "In a free market economy, prices and wages are primarily determined by...", choices: ["The government", "The business owners", "Supply and demand", "The labor unions"], answer: 2, hint: "This is the core principle of capitalism." },
                { question: "How did mass production affect the lives of factory workers?", choices: ["It made their jobs more creative", "It led to safer working conditions", "It required them to be more skilled", "It made their tasks repetitive"], answer: 3, hint: "Each worker would perform one simple task over and over." },
                { question: "The growth of cities, or urbanization, was a direct effect of...", choices: ["The government's free land policy", "A decline in industrial jobs", "People leaving farms for factory work", "A desire for a quieter lifestyle"], answer: 2, hint: "Advancements in farming meant fewer farm jobs were available." },
                { question: "A corporation is a type of business that is legally recognized as...", choices: ["An individual person", "A government agency", "A non-profit charity", "A part of the military"], answer: 0, hint: "This legal status protects the owners from personal liability." },
                { question: "The 'laissez-faire' approach to the economy was based on the idea that...", choices: ["Government helps businesses best", "The economy will regulate itself", "Businesses need strict rules", "Competition is bad for consumers"], answer: 1, hint: "This idea promotes minimal government intervention." },
                { question: "Which factor was NOT a major contributor to the growth of the industrial economy?", choices: ["A large workforce from immigration", "A wealth of natural resources", "Increased government regulation", "New inventions and technology"], answer: 2, hint: "Think about what the 'laissez-faire' policy means." },
                { question: "Advancements in farming, like the steel plow, helped to...", choices: ["Make farming less efficient", "Turn the Great Plains into farmland", "Decrease the amount of food grown", "Create more jobs for farmers"], answer: 1, hint: "This invention could break through the tough prairie soil." },
                { question: "The ability of corporations to sell 'stock' to the public allows them to...", choices: ["Avoid all competition", "Raise huge amounts of capital", "Pay their workers higher wages", "Control the government"], answer: 1, hint: "This money, or capital, is used to build factories and expand." },
                
                // Standard B: Innovations
                { question: "How did the expansion of railroads most affect the American economy?", choices: ["It decreased the speed of transport", "It created national markets for goods", "It led to the decline of cities", "It made communication harder"], answer: 1, hint: "Goods could now be sold across the entire country." },
                { question: "Thomas Edison's invention of a practical light bulb had what effect on factories?", choices: ["It made them less safe", "It forced them to close at night", "It allowed them to operate 24 hours a day", "It decreased their production"], answer: 2, hint: "Work was no longer dependent on the daylight." },
                { question: "The invention of the telephone by Alexander Graham Bell revolutionized...", choices: ["Personal and business communication", "The way food was cooked", "The speed of travel", "The production of steel"], answer: 0, hint: "It allowed for instant communication over long distances." },
                { question: "What was a major social effect of the railroad expansion in the West?", choices: ["It stopped people from moving west", "It led to conflict with Native Americans", "It helped preserve the buffalo", "It isolated the western territories"], answer: 1, hint: "The railroads brought settlers onto Native American lands." },
                { question: "The widespread use of electricity in cities led to the development of...", choices: ["Horse-drawn carriages", "Cleaner and safer streets", "Smaller, more compact cities", "A decline in population"], answer: 1, hint: "Electric streetlights and streetcars improved urban life." },
                { question: "How did the telephone change the way businesses operated?", choices: ["It slowed down business deals", "It made communication more efficient", "It required all business to be in person", "It was only used for emergencies"], answer: 1, hint: "Orders and information could be exchanged instantly." },
                { question: "The creation of standardized time zones was a direct result of the need to...", choices: ["Schedule railroad service safely", "Help farmers know when to plant", "Regulate factory working hours", "Coordinate telephone calls"], answer: 0, hint: "It was too confusing when every town had its own local time." },
                { question: "Besides the light bulb, Thomas Edison's laboratories were responsible for inventing the...", choices: ["Radio", "Automobile", "Phonograph", "Airplane"], answer: 2, hint: "This was the first machine that could record and play back sound." },
                { question: "Which innovation had the BIGGEST impact on opening the American West to settlers?", choices: ["The telephone", "The electric light bulb", "The Bessemer steel process", "The transcontinental railroad"], answer: 3, hint: "This connected the East and West coasts for the first time." },
                { question: "The ability to power machines with electricity, rather than steam, allowed factories to be built...", choices: ["Only next to rivers", "Anywhere they wanted", "Only in the countryside", "Underground for safety"], answer: 1, hint: "They no longer needed to be near a water source for power." },
                { question: "What was a negative economic effect of the railroads' power?", choices: ["They offered rebates to all customers", "They often charged high prices to farmers", "They could not carry large amounts of goods", "They refused to build lines in the West"], answer: 1, hint: "Farmers in remote areas had no other option for shipping." },
                
                // Standard C: Industrialists & Corporations
                { question: "John D. Rockefeller built a monopoly in which major industry?", choices: ["Steel", "Oil", "Railroads", "Banking"], answer: 1, hint: "His company was called Standard Oil." },
                { question: "Andrew Carnegie was a 'captain of industry' who dominated the...", choices: ["Banking and finance industry", "Telephone and telegraph industry", "Meatpacking industry", "Steel manufacturing industry"], answer: 3, hint: "His steel was used to build skyscrapers and bridges." },
                { question: "The business practice of buying out all of your competitors is called...", choices: ["Vertical integration", "Horizontal integration", "A corporation", "A partnership"], answer: 1, hint: "Think of moving sideways to take over similar companies." },
                { question: "Cornelius Vanderbilt was a powerful industrialist who controlled which industry?", choices: ["Oil refining", "Steel production", "Railroads and shipping", "Electrical power"], answer: 2, hint: "He was known as 'The Commodore'." },
                { question: "When a company controls all the steps of producing and selling a product, it is called...", choices: ["Vertical integration", "Horizontal integration", "A monopoly", "A trust"], answer: 0, hint: "Think of controlling all levels, from top to bottom." },
                { question: "J.P. Morgan was an incredibly powerful leader in which field?", choices: ["Agriculture", "Manufacturing", "Invention", "Banking and finance"], answer: 3, hint: "He helped to create companies like General Electric and U.S. Steel." },
                { question: "A 'monopoly' or 'trust' is a company that has...", choices: ["Complete control over an industry", "Many different owners", "A lot of competition", "Very few customers"], answer: 0, hint: "This lack of competition often leads to higher prices." },
                { question: "Madam C.J. Walker became a successful self-made millionaire by creating and selling...", choices: ["Railroad cars and engines", "Hair care products for Black women", "Inexpensive automobiles", "New types of light bulbs"], answer: 1, hint: "She was a pioneering Black female entrepreneur." },
                { question: "Andrew Carnegie used the Bessemer process to revolutionize his industry by...", choices: ["Making steel stronger and cheaper", "Inventing a way to drill for oil", "Creating the first telephone", "Building faster locomotives"], answer: 0, hint: "This innovation made mass production of steel possible." },
                { question: "John D. Rockefeller's Standard Oil trust was an example of...", choices: ["A failed business venture", "A company with many competitors", "A powerful monopoly", "A government-owned company"], answer: 2, hint: "At its peak, it controlled about 90% of the oil industry." },
                { question: "Industrialists like Carnegie and Rockefeller were sometimes called 'Robber Barons' because they...", choices: ["Paid their workers very high wages", "Used ruthless tactics to destroy competition", "Gave most of their money to charity", "Refused to use modern technology"], answer: 1, hint: "This was the negative term used by their critics." },
                { question: "The business strategy of combining many competing firms into one giant corporation is called...", choices: ["Vertical integration", "Horizontal integration", "Laissez-faire", "Mass production"], answer: 1, hint: "John D. Rockefeller used this to create Standard Oil." },
                { question: "Which industrialist bought Carnegie Steel and combined it with others to form U.S. Steel?", choices: ["Cornelius Vanderbilt", "John D. Rockefeller", "Andrew Carnegie", "J.P. Morgan"], answer: 3, hint: "This powerful banker organized some of the biggest deals in history." },
                { question: "Madam C.J. Walker's success was significant because she...", choices: ["Inherited her company from her father", "Was a successful Black female entrepreneur", "Received a lot of help from the government", "Was the first woman to own a railroad"], answer: 1, hint: "She overcame both racial and gender discrimination." },
                { question: "Andrew Carnegie's 'Gospel of Wealth' was the idea that the rich should...", choices: ["Keep all their money for their families", "Use their wealth to help society", "Pay no taxes to the government", "Spend their money on luxury items"], answer: 1, hint: "He donated millions to build libraries and universities." },
                { question: "A trust is a business arrangement where...", choices: ["A single board of trustees controls many companies", "Workers are given ownership of the factory", "The government sets all prices and wages", "All companies agree to compete fairly"], answer: 0, hint: "This was a way to create a monopoly without technically owning the other companies." },
                { question: "Cornelius Vanderbilt helped to standardize the railroad industry by...", choices: ["Using a single gauge for all tracks", "Inventing the first steam locomotive", "Building the transcontinental railroad", "Creating the first time zones"], answer: 0, hint: "This allowed trains to travel on different lines without stopping." },
                { question: "Which business practice did Andrew Carnegie use to control the steel industry?", choices: ["Horizontal integration only", "Vertical integration only", "Both vertical and horizontal integration", "Neither form of integration"], answer: 2, hint: "He owned mines, ships, and steel mills to control the entire process." },
                { question: "The immense wealth of industrialists like Rockefeller and Morgan led to concerns about their...", choices: ["Lack of business knowledge", "Poor treatment of their families", "Influence over the government", "Inability to find new products"], answer: 2, hint: "Many worried they had more power than elected officials." },
                { question: "What do Andrew Carnegie, John D. Rockefeller, and Madam C.J. Walker all have in common?", choices: ["They all worked in the oil industry.", "They were all famous inventors.", "They all started from humble beginnings.", "They all served as president."], answer: 2, hint: "They are all examples of 'self-made' success stories." }
            ]
        };

        // --- GAME STATE ---
        let playerState = {};
        let timerInterval = null;
        let timeLeft = 300; // 5 minutes in seconds
        let currentQuestionIndex = -1;
        let questionsCopy = [];
        let activeQuestionSet = [];
        let wrongAnswers = []; // Store indexes of wrong answers
        let abilities = {}; // Store state of abilities
        let notificationQueue = []; 
        let isModalActive = false; 
        let notificationTimer = null;
        let lastNotificationMessage = ''; // New state to track last message

        // --- DOM ELEMENTS ---
        const timerEl = document.getElementById('timer');
        const timeCardEl = document.getElementById('timeCard');
        const scoreEl = document.getElementById('score');
        const streakEl = document.getElementById('streak');
        const correctAnswersEl = document.getElementById('correctAnswers');
        const gameAreaEl = document.getElementById('gameArea');
        const questionTextEl = document.getElementById('questionText');
        const answerChoices = document.querySelectorAll('.answer-choice');
        const headerGridEl = document.getElementById('headerGrid');
        
        // Modals
        const groupInfoModal = document.getElementById('groupInfoModal');
        const endGameModal = document.getElementById('endGameModal');
        const aboutModal = document.getElementById('aboutModal');
        const resetConfirmModal = document.getElementById('resetConfirmModal');
        const hintModal = document.getElementById('hintModal');
        const streakModal = document.getElementById('streakModal');
        const streakTextEl = document.getElementById('streakText');
        const abilityInfoModal = document.getElementById('abilityInfoModal');
        const pantherBuckModal = document.getElementById('pantherBuckModal');

        // Buttons
        const gradeLevelSelect = document.getElementById('gradeLevelSelect');
        const startGameBtn = document.getElementById('startGameBtn');
        const newGameBtn = document.getElementById('newGameBtn');
        const endTurnBtn = document.getElementById('endTurnBtn');
        const resetAllBtn = document.getElementById('resetAllBtn');
        const aboutBtn = document.getElementById('aboutBtn');
        const hintBtn = document.getElementById('hintBtn');
        const closeAboutBtn = document.getElementById('closeAboutBtn');
        const confirmResetBtn = document.getElementById('confirmResetBtn');
        const cancelResetBtn = document.getElementById('cancelResetBtn');
        const closeHintBtn = document.getElementById('closeHintBtn');
        const closeStreakBtn = document.getElementById('closeStreakBtn');
        const closeAbilityInfoBtn = document.getElementById('closeAbilityInfoBtn');
        const closePantherBuckBtn = document.getElementById('closePantherBuckBtn');

        // Modal Content
        const finalScoreEl = document.getElementById('finalScore');
        const hintTextEl = document.getElementById('hintText');
        
        // Ability & Notification Elements
        const abilitySkipEl = document.getElementById('abilitySkip');
        const abilityRedoEl = document.getElementById('abilityRedo');
        const abilityBoostEl = document.getElementById('abilityBoost');
        const abilityInfoBtn = document.getElementById('abilityInfoBtn');
        const skipUsesEl = document.getElementById('skipUses');
        const redoUsesEl = document.getElementById('redoUses');
        const hunchAbilityEl = document.getElementById('hunchAbility');
        const tinkerAbilityEl = document.getElementById('tinkerAbility');
        const hunchProgressEl = document.getElementById('hunchProgress');
        const tinkerProgressEl = document.getElementById('tinkerProgress');
        const pantherBuckProgressEl = document.getElementById('pantherBuckProgress');
        const pantherBuckCounterEl = document.getElementById('pantherBuckCounter');
        const notificationTextEl = document.getElementById('notificationText');

        // --- SOUND ENGINE ---
        const synth = new Tone.PolySynth(Tone.Synth).toDestination();
        function playCorrectSound() {
            const now = Tone.now();
            synth.triggerAttackRelease("C4", "8n", now);
            synth.triggerAttackRelease("E4", "8n", now + 0.1);
            synth.triggerAttackRelease("G4", "8n", now + 0.2);
            synth.triggerAttackRelease("C5", "8n", now + 0.3);
        }
        function playIncorrectSound() {
            const now = Tone.now();
            synth.triggerAttackRelease("C2", "8n", now);
        }
        function playClickSound() { synth.triggerAttackRelease("C5", "16n"); }
        function playStartSound() {
            const now = Tone.now();
            synth.triggerAttackRelease("G3", "8n", now);
            synth.triggerAttackRelease("C4", "8n", now + 0.1);
        }
        function playStreakSound() {
            const now = Tone.now();
            synth.triggerAttackRelease("G4", "8n", now);
            synth.triggerAttackRelease("C5", "8n", now + 0.1);
            synth.triggerAttackRelease("E5", "4n", now + 0.2);
        }
        function playPantherBuckSound() {
            const now = Tone.now();
            synth.triggerAttackRelease("A5", "8n", now);
        }

        // --- HELPER & NOTIFICATION FUNCTIONS ---
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
        }
        
        function triggerConfetti() {
            confetti({ particleCount: 100, spread: 70, origin: { y: 0.6 }, zIndex: 101 });
        }
        
        function addNotification(notification) {
            notificationQueue.push(notification);
            processNotificationQueue();
        }

        function processNotificationQueue() {
            if (isModalActive || notificationQueue.length === 0) {
                return;
            }
            isModalActive = true;
            const notification = notificationQueue.shift();
            
            triggerConfetti();

            if (notification.type === 'streak') {
                playStreakSound();
                streakTextEl.textContent = notification.text;
                streakModal.classList.remove('hidden');
            } else if (notification.type === 'pantherBuck') {
                playPantherBuckSound();
                pantherBuckModal.classList.remove('hidden');
            }
        }
        
        function updateNotification(message) {
            if (message === lastNotificationMessage) return; // <-- FIX: Prevent repeat messages
            lastNotificationMessage = message;

            if (notificationTimer) clearTimeout(notificationTimer);
            notificationTextEl.textContent = ''; 
            notificationTextEl.classList.remove('typing-effect');
            
            void notificationTextEl.offsetWidth; 
            
            notificationTextEl.textContent = message;
            notificationTextEl.classList.add('typing-effect');

            notificationTimer = setTimeout(() => {
                 notificationTextEl.classList.remove('typing-effect');
            }, 1000); 
        }

        // --- ABILITY LOGIC ---
        function updateAbilitiesUI() {
            // Passive: Panther Bucks
            const buckProgress = (playerState.pantherBuckProgress / 10) * 100;
            pantherBuckProgressEl.style.width = `${buckProgress}%`;
            pantherBuckCounterEl.textContent = `${playerState.pantherBucksEarned} üêæ`;

            // Passive: Historian's Hunch
            const hunchProgress = (playerState.correctAnswers % 5) / 5 * 100;
            hunchProgressEl.style.width = `${hunchProgress}%`;
            hunchAbilityEl.classList.toggle('ready', hunchProgress >= 80);
            if (hunchProgress > 50) {
                hunchAbilityEl.classList.add('jiggle');
                const duration = 0.4 - ((hunchProgress - 50) / 50) * 0.3; 
                hunchAbilityEl.style.animationDuration = `${duration}s`;
            } else {
                hunchAbilityEl.classList.remove('jiggle');
                hunchAbilityEl.style.animationDuration = '';
            }

            // Passive: Time Tinkerer
            const tinkerProgress = Math.min((playerState.streak / 4) * 100, 100);
            tinkerProgressEl.style.width = `${tinkerProgress}%`;
            tinkerAbilityEl.classList.toggle('ready', playerState.streak >= 4);
            if (tinkerProgress > 50) {
                tinkerAbilityEl.classList.add('jiggle');
                const duration = 0.4 - ((tinkerProgress - 50) / 50) * 0.3; 
                tinkerAbilityEl.style.animationDuration = `${duration}s`;
            } else {
                tinkerAbilityEl.classList.remove('jiggle');
                tinkerAbilityEl.style.animationDuration = '';
            }

            // Active: Skip
            if (abilities.skip > 0) {
                abilitySkipEl.classList.remove('locked');
                abilitySkipEl.classList.add('earned');
                skipUsesEl.textContent = abilities.skip;
                skipUsesEl.classList.remove('hidden');
            } else {
                abilitySkipEl.classList.add('locked');
                abilitySkipEl.classList.remove('earned');
                skipUsesEl.classList.add('hidden');
            }
            // Active: Redo
            if (abilities.redo > 0) {
                abilityRedoEl.classList.remove('locked');
                abilityRedoEl.classList.add('earned');
                redoUsesEl.textContent = abilities.redo;
                redoUsesEl.classList.remove('hidden');
            } else {
                abilityRedoEl.classList.add('locked');
                abilityRedoEl.classList.remove('earned');
                redoUsesEl.classList.add('hidden');
            }
             // Active: Boost
            if (abilities.boostActive) {
                abilityBoostEl.classList.remove('locked');
                abilityBoostEl.classList.add('active');
            } else {
                abilityBoostEl.classList.remove('active');
                abilityBoostEl.classList.add('locked');
            }
        }

        function activateSkip() {
            if (abilities.skip > 0) {
                playClickSound();
                abilities.skip--;
                updateAbilitiesUI();
                updateNotification("Question skipped!");
                displayNextQuestion();
            }
        }

        function activateRedo() {
            if (abilities.redo > 0 && wrongAnswers.length > 0) {
                playClickSound();
                abilities.redo--;

                if (currentQuestionIndex !== -1) {
                    const currentQuestionObject = activeQuestionSet[currentQuestionIndex];
                    questionsCopy.push(currentQuestionObject);
                    shuffleArray(questionsCopy);
                }
                
                const questionsToRedo = wrongAnswers.map(index => activeQuestionSet[index]);
                questionsCopy.unshift(...questionsToRedo);
                
                updateNotification(`Second Chance! Answering ${wrongAnswers.length} questions again.`);
                wrongAnswers = [];
                updateAbilitiesUI();
                displayNextQuestion();
            }
        }

        // --- CORE GAME LOGIC ---
        function resetPlayerState() {
             playerState = { 
                score: 0, questionsAnswered: 0, streak: 0, correctAnswers: 0,
                wrongStreak: 0, pantherBuckProgress: 0,
                earned3Streak: false, earned4Streak: false, earned5Streak: false, earned7Streak: false,
                historiansHunchPending: false, pantherBucksEarned: 0
            };
            abilities = { skip: 0, redo: 0, boostActive: false };
            wrongAnswers = [];
        }

        async function startGame() {
            await Tone.start();
            playStartSound();
            
            resetPlayerState();
            
            scoreEl.textContent = '0';
            streakEl.textContent = '0';
            correctAnswersEl.textContent = '0';
            groupInfoModal.classList.add('hidden');
            
            const selectedGrade = gradeLevelSelect.value;
            activeQuestionSet = allQuestions[selectedGrade];
            questionsCopy = [...activeQuestionSet];
            shuffleArray(questionsCopy);

            updateAbilitiesUI();
            startTimer();
            updateNotification("The challenge has begun. Good luck!");
            displayNextQuestion();
        }

        function startTimer() {
            if (timerInterval) clearInterval(timerInterval);
            timeLeft = 300;
            timerEl.textContent = "05:00";
            timerInterval = setInterval(() => {
                timeLeft--;
                const minutes = Math.floor(timeLeft / 60).toString().padStart(2, '0');
                const seconds = (timeLeft % 60).toString().padStart(2, '0');
                timerEl.textContent = `${minutes}:${seconds}`;

                if (timeLeft === 150) {
                    updateNotification("Halfway through! Keep up the pace!");
                } else if (timeLeft === 60) {
                    updateNotification("Warning: One minute remaining!");
                }

                if (timeLeft <= 0) endGame();
            }, 1000);
        }

        function displayNextQuestion() {
            gameAreaEl.classList.add('switching');
            setTimeout(() => {
                if (questionsCopy.length === 0) {
                    endGame();
                    return;
                }
                answerChoices.forEach(choice => {
                    choice.classList.remove('correct', 'incorrect', 'removed');
                    choice.style.pointerEvents = 'auto';
                });
                const question = questionsCopy.shift();
                currentQuestionIndex = activeQuestionSet.indexOf(question);
                
                if (playerState.historiansHunchPending) {
                    const correctAnswerIndex = question.answer;
                    const wrongChoices = [0, 1, 2, 3].filter(i => i !== correctAnswerIndex);
                    shuffleArray(wrongChoices);
                    const choiceToRemove = wrongChoices[0];
                    answerChoices[choiceToRemove].classList.add('removed');
                    answerChoices[choiceToRemove].style.pointerEvents = 'none';
                    playerState.historiansHunchPending = false;
                    updateNotification("Historian's Hunch: One wrong answer removed.");
                }

                const questionText = question.question;
                questionTextEl.textContent = questionText;
                if (questionText.length < 65) questionTextEl.style.fontSize = '2.5rem';
                else if (questionText.length < 110) questionTextEl.style.fontSize = '2rem';
                else questionTextEl.style.fontSize = '1.75rem';

                answerChoices.forEach((choiceEl, index) => {
                    choiceEl.querySelector('p').textContent = question.choices[index];
                });
                gameAreaEl.classList.remove('switching');
            }, 300);
        }

        function handleAnswerClick(e) {
            playerState.questionsAnswered++;
            const selectedChoiceEl = e.currentTarget;
            const selectedAnswer = parseInt(selectedChoiceEl.dataset.choice);
            const correctAnswer = activeQuestionSet[currentQuestionIndex].answer;

            answerChoices.forEach(choice => choice.style.pointerEvents = 'none');

            if (selectedAnswer === correctAnswer) {
                selectedChoiceEl.classList.add('correct');
                
                playerState.correctAnswers++;
                playerState.pantherBuckProgress++;
                playerState.wrongStreak = 0;
                playerState.score += abilities.boostActive ? 2 : 1;
                scoreEl.textContent = playerState.score;
                correctAnswersEl.textContent = playerState.correctAnswers;
                
                if (playerState.correctAnswers > 0 && playerState.correctAnswers % 5 === 0) {
                    playerState.historiansHunchPending = true;
                }

                if (playerState.pantherBuckProgress === 10) {
                    playerState.pantherBucksEarned++;
                    playerState.pantherBuckProgress = 0;
                    addNotification({ type: 'pantherBuck' });
                }

                playerState.streak++;
                streakEl.textContent = playerState.streak;
                
                let specialEventOccurred = false;
                // Streak-based ability notifications
                if (playerState.streak === 3 && !playerState.earned3Streak) {
                    abilities.skip++;
                    playerState.earned3Streak = true;
                    addNotification({ type: 'streak', text: "You earned a SKIP!" });
                    specialEventOccurred = true;
                } else if (playerState.streak === 4 && !playerState.earned4Streak) {
                    timeLeft += 15;
                    timeCardEl.classList.add('flash-green');
                    setTimeout(() => timeCardEl.classList.remove('flash-green'), 1000);
                    playerState.earned4Streak = true;
                    addNotification({ type: 'streak', text: "TIME BONUS! +15 Seconds!" });
                    specialEventOccurred = true;
                } else if (playerState.streak === 5 && !playerState.earned5Streak) {
                    abilities.redo++;
                    playerState.earned5Streak = true;
                    addNotification({ type: 'streak', text: "You earned a SECOND CHANCE!" });
                    specialEventOccurred = true;
                } else if (playerState.streak === 7 && !playerState.earned7Streak) {
                    abilities.boostActive = true;
                    playerState.earned7Streak = true;
                    addNotification({ type: 'streak', text: "2x SCORE BOOST is active!" });
                    specialEventOccurred = true;
                }
                
                if (!specialEventOccurred && notificationQueue.length === 0) {
                    playCorrectSound();
                    triggerConfetti();
                }

                // Contextual notifications
                if (abilities.skip > 0) {
                    updateNotification("SKIP ability is ready to use.");
                } else if (10 - playerState.pantherBuckProgress === 1) {
                    updateNotification("One more for a Panther Buck!");
                } else if (playerState.streak === 2) {
                    updateNotification("Great! That's two in a row.");
                } else if (playerState.streak === 6) {
                    updateNotification("Incredible 6-question streak!");
                } else {
                    updateNotification("Correct! Keep it up.");
                }


            } else {
                playIncorrectSound();
                document.body.classList.add('red-flash');
                selectedChoiceEl.classList.add('incorrect');
                answerChoices[correctAnswer].classList.add('correct');
                
                if (wrongAnswers.length >= 2) wrongAnswers.shift();
                wrongAnswers.push(currentQuestionIndex);

                playerState.streak = 0;
                playerState.wrongStreak++;
                streakEl.textContent = playerState.streak;
                playerState.earned3Streak = false;
                playerState.earned4Streak = false;
                playerState.earned5Streak = false;
                playerState.earned7Streak = false;
                if (abilities.boostActive) {
                    abilities.boostActive = false;
                    updateNotification("2x Boost lost! Be careful.");
                }

                if (playerState.wrongStreak === 4) {
                    playerState.pantherBuckProgress = 0;
                    playerState.wrongStreak = 0;
                    updateNotification("Panther Buck progress lost! 4 wrong in a row.");
                } else if (playerState.wrongStreak === 3) {
                    updateNotification("Danger! One more wrong will reset Panther Buck progress.");
                } else {
                    updateNotification("Incorrect. Don't lose focus!");
                }
                
                headerGridEl.classList.add('shake');
                gameAreaEl.classList.add('shake');
                setTimeout(() => {
                    headerGridEl.classList.remove('shake');
                    gameAreaEl.classList.remove('shake');
                    document.body.classList.remove('red-flash');
                }, 500);
            }
            
            updateAbilitiesUI();
            setTimeout(displayNextQuestion, 2000);
        }
        
        function endGame() {
            if (!timerInterval && endGameModal.classList.contains('hidden')) return;
            clearInterval(timerInterval);
            timerInterval = null;
            timerEl.textContent = "00:00";
            
            finalScoreEl.textContent = playerState.score;
            endGameModal.classList.remove('hidden');
        }

        function setupNewTurn() {
            timeLeft = 300;
            timerEl.textContent = "05:00";
            endGameModal.classList.add('hidden');
            groupInfoModal.classList.remove('hidden');
            scoreEl.textContent = '0';
            streakEl.textContent = '0';
            correctAnswersEl.textContent = '0';
            questionTextEl.textContent = 'Your first question will appear here. Good luck!';
            answerChoices.forEach(choice => {
                choice.querySelector('p').textContent = '';
                choice.classList.remove('correct', 'incorrect');
            });
            resetPlayerState();
            updateAbilitiesUI();
            updateNotification("Select a grade to start a new game.");
        }
        
        function resetAllData() {
            playClickSound();
            setupNewTurn();
            resetConfirmModal.classList.add('hidden');
        }

        function showHint() {
            playClickSound();
            if (currentQuestionIndex > -1) {
                const hint = activeQuestionSet[currentQuestionIndex].hint;
                hintTextEl.textContent = hint;
                hintModal.classList.remove('hidden');
            }
        }

        // --- EVENT LISTENERS ---
        startGameBtn.addEventListener('click', startGame);
        newGameBtn.addEventListener('click', () => { playClickSound(); setupNewTurn(); });
        endTurnBtn.addEventListener('click', () => { playClickSound(); endGame(); });
        resetAllBtn.addEventListener('click', () => { playClickSound(); resetConfirmModal.classList.remove('hidden'); });
        aboutBtn.addEventListener('click', () => { playClickSound(); aboutModal.classList.remove('hidden'); });
        hintBtn.addEventListener('click', showHint);
        closeAboutBtn.addEventListener('click', () => { playClickSound(); aboutModal.classList.add('hidden'); });
        confirmResetBtn.addEventListener('click', resetAllData);
        cancelResetBtn.addEventListener('click', () => { playClickSound(); resetConfirmModal.classList.add('hidden'); });
        closeHintBtn.addEventListener('click', () => { playClickSound(); hintModal.classList.add('hidden'); });
        closeStreakBtn.addEventListener('click', () => { 
            playClickSound(); 
            streakModal.classList.add('hidden');
            isModalActive = false;
            processNotificationQueue();
        });
        answerChoices.forEach(choice => choice.addEventListener('click', handleAnswerClick));
        
        // Ability Listeners
        abilitySkipEl.addEventListener('click', activateSkip);
        abilityRedoEl.addEventListener('click', activateRedo);
        abilityInfoBtn.addEventListener('click', () => { playClickSound(); abilityInfoModal.classList.remove('hidden'); });
        closeAbilityInfoBtn.addEventListener('click', () => { playClickSound(); abilityInfoModal.classList.add('hidden'); });
        closePantherBuckBtn.addEventListener('click', () => { 
            playClickSound(); 
            pantherBuckModal.classList.add('hidden');
            isModalActive = false;
            processNotificationQueue();
        });

        // Initial setup
        updateNotification("Welcome! Select a grade to begin.");
    </script>
</body>
</html>

