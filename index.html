<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Classroom History Challenge</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.7.77/Tone.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Architects+Daughter&family=Montserrat:wght@400;700;900&family=VT323&display=swap" rel="stylesheet">
    <style>
        /* Basic Animations */
        @keyframes gradient-animation {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        @keyframes shake {
            0% { transform: translate(1px, 1px) rotate(0deg); }
            10% { transform: translate(-1px, -2px) rotate(-1deg); }
            20% { transform: translate(-3px, 0px) rotate(1deg); }
            30% { transform: translate(3px, 2px) rotate(0deg); }
            40% { transform: translate(1px, -1px) rotate(1deg); }
            50% { transform: translate(-1px, 2px) rotate(-1deg); }
            60% { transform: translate(-3px, 1px) rotate(0deg); }
            70% { transform: translate(3px, 1px) rotate(-1deg); }
            80% { transform: translate(-1px, -1px) rotate(1deg); }
            90% { transform: translate(1px, 2px) rotate(0deg); }
            100% { transform: translate(1px, -2px) rotate(-1deg); }
        }
        @keyframes jiggle {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-1px); }
            50% { transform: translateX(1px); }
            75% { transform: translateX(-1px); }
        }
        @keyframes glow {
            0% { text-shadow: 0 0 5px #fff, 0 0 10px #fff; }
            50% { text-shadow: 0 0 10px #fff, 0 0 20px #fff, 0 0 30px #fff; }
            100% { text-shadow: 0 0 5px #fff, 0 0 10px #fff; }
        }
        @keyframes pulse-glow {
            0% { box-shadow: 8px 8px 0px #92400e, 0 0 15px #f59e0b; }
            50% { box-shadow: 8px 8px 0px #92400e, 0 0 30px #f97316, 0 0 15px #f59e0b; }
            100% { box-shadow: 8px 8px 0px #92400e, 0 0 15px #f59e0b; }
        }
        @keyframes active-boost-wiggle {
            0%, 100% { transform: rotate(0); }
            25% { transform: rotate(-3deg); }
            50% { transform: rotate(3deg); }
            75% { transform: rotate(-3deg); }
        }
        @keyframes red-flash-animation {
            0% { background-color: transparent; }
            50% { background-color: rgba(239, 68, 68, 0.5); }
            100% { background-color: transparent; }
        }
        @keyframes passive-ready-glow {
            0% { box-shadow: 6px 6px 0px #15803d, 0 0 10px #4ade80; }
            50% { box-shadow: 6px 6px 0px #15803d, 0 0 20px #4ade80, 0 0 10px #4ade80; }
            100% { box-shadow: 6px 6px 0px #15803d, 0 0 10px #4ade80; }
        }
        @keyframes pulse-green {
            0% { transform: scale(1); box-shadow: 8px 8px 0px #14532d; }
            50% { transform: scale(1.02); box-shadow: 10px 10px 5px #14532d; }
            100% { transform: scale(1); box-shadow: 8px 8px 0px #14532d; }
        }
        @keyframes timer-flash-green {
            0%, 100% { color: white; }
            50% { color: #86efac; }
        }
        @keyframes scanline {
            0% { background-position: 0 0; }
            100% { background-position: 0 100%; }
        }
        @keyframes scan-line-anim {
            0% { top: -10%; }
            100% { top: 110%; }
        }
        @keyframes glitch-anim {
            0%, 95% {
                transform: translate(0, 0);
            }
            96% {
                transform: translate(-1px, 1px);
            }
            98% {
                transform: translate(1px, -1px);
            }
            100% {
                transform: translate(0, 0);
            }
        }

        @keyframes typing {
            from { width: 0; }
            to { width: 100%; }
        }


        @keyframes store-glow {
            0%, 100% { box-shadow: 4px 4px 0px #111827, 0 0 5px #f59e0b; }
            50% { box-shadow: 4px 4px 0px #111827, 0 0 20px #f97316, 0 0 10px #f59e0b; }
        }
        @keyframes store-jiggle {
            0%, 100% { transform: rotate(0); }
            25% { transform: rotate(-2deg); }
            50% { transform: rotate(2deg); }
            75% { transform: rotate(-2deg); }
        }
        .first-letter-btn-glow {
            overflow: hidden;
            white-space: nowrap;
            animation: typing 1s steps(60, end);
        }

        /* NEW MODAL ANIMATIONS */
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        @keyframes scaleUp {
            from {
                opacity: 0;
                transform: scale(0.95) translateY(10px);
            }
            to {
                opacity: 1;
                transform: scale(1) translateY(0);
            }
        }

        /* NEW Game Mode Selector Grid */
        .mode-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            grid-template-columns: repeat(3, 1fr);
            width: 100%;
            margin: 0 auto;
        }
        .mode-card {
            background-color: var(--main-color, #f3f4f6);
            border: clamp(3px, 0.5vw, 5px) solid #111827;
            border-radius: 1rem;
            padding: clamp(0.5rem, 2vw, 1.25rem);
            text-align: left;
            color: white;
            cursor: pointer;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        .mode-card:hover {
            transform: translateY(-10px) scale(1.03);
            box-shadow: 8px 8px 0px var(--shadow-color, #111827);
        }
        .mode-card.simple:hover {
            transform: translateY(-10px) scale(1.03);
            box-shadow: 8px 8px 0px var(--shadow-color, #111827);
        }
        .mode-card h3 {
            font-family: 'Montserrat', sans-serif;
            font-weight: 900;
            font-size: clamp(1rem, 2.5vw, 1.75rem);
            border-bottom: clamp(3px, 0.4vw, 4px) solid rgba(255, 255, 255, 0.5);
            padding-bottom: clamp(0.25rem, 1vh, 0.5rem);
            margin-bottom: clamp(0.5rem, 1.5vh, 0.75rem);
            color: white;
        }
        .mode-card.simple h3 {
            font-size: clamp(1.5rem, 4vw, 2.25rem);
            border-bottom: none;
            padding-bottom: 0;
            margin-bottom: 0;
            text-align: center;
        }
        .mode-card h3 span.text-5xl { /* Target the emoji specifically */
            font-size: clamp(1.5rem, 4vw, 2.75rem);
        }
        .mode-details {
            font-size: clamp(0.6rem, 1.8vw, 0.85rem);
            line-height: 1.4;
        }
        .mode-grid {
            gap: clamp(0.5rem, 1.5vw, 1rem);
        }
        .mode-details .detail-row {
            display: flex;
            justify-content: space-between;
            padding: clamp(0.1rem, 0.4vh, 0.2rem) 0;
        }

        /* General Body and Layout */
        body {
            font-family: 'Montserrat', sans-serif;
            color: #111827;
            background: linear-gradient(-45deg, #f97316, #c026d3, #0ea5e9, #10b981);
            background-size: 400% 400%;
            animation: gradient-animation 15s ease infinite;
            overflow: hidden;
            height: 100vh;
            width: 100vw;
        }
        .red-flash::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            animation: red-flash-animation 0.5s ease-in-out;
            z-index: -1;
        }
        .main-container {
            display: grid;
            grid-template-columns: 3fr 1fr;
            grid-template-rows: auto 1fr;
            gap: clamp(0.5rem, 2vh, 1.5rem);
            padding: clamp(0.5rem, 2vh, 1.5rem);
            height: 100%;
            min-height: 0;
        }
        .header-grid {
            grid-column: 1 / -1;
            display: grid;
            grid-template-columns: 1.5fr 2.5fr 1.5fr 1.5fr 2fr;
            gap: clamp(0.5rem, 2vw, 1.5rem);
        }
        .right-panel {
            display: flex;
            flex-direction: column;
            gap: clamp(0.5rem, 2vh, 1.5rem);
            min-height: 0;
            min-width: 0;
        }

        /* Stacked Streak/Correct Cards */
        .streak-correct-stack {
            display: flex;
            flex-direction: column;
            gap: clamp(0.25rem, 1vh, 0.75rem);
            min-height: 0;
        }
        .streak-correct-stack .card {
            flex: 1; /* Allow cards to grow and fill the space */
            padding: clamp(0.1rem, 0.5vw, 0.25rem); /* Reduced padding */
        }
        .streak-correct-stack .card h2 {
            font-size: clamp(0.6rem, 1.2vw, 0.9rem); /* Smaller title */
            margin-bottom: 0;
        }
        .streak-correct-stack .card .content {
            font-size: clamp(1rem, 2vw, 1.5rem); /* Smaller content font */
            line-height: 1;
        }

        /* Card Styles */
        .card {
            border: 6px solid #111827;
            border-radius: 1.5rem;
            padding: clamp(0.5rem, 1vw, 1rem);
            box-shadow: 8px 8px 0px #111827;
            text-align: center;
            font-weight: 700;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            background-color: rgba(255, 255, 255, 0.85);
            backdrop-filter: blur(10px);
        }
        .card h2 {
            font-family: 'Montserrat', sans-serif;
            font-weight: 900;
            text-transform: uppercase;
            font-size: clamp(0.7rem, 1.5vw, 1.1rem);
            margin-bottom: 0.25rem;
            color: rgba(0,0,0,0.6);
        }
        .card.time-card h2, .card.score-card h2, .card.streak-card h2, .card.correct-card h2 {
            color: rgba(255,255,255,0.7);
        }
        .card .content {
            font-family: 'Architects Daughter', cursive;
            font-size: clamp(1.5rem, 3vw, 2.5rem);
            line-height: 1.1;
        }
        .time-card { background-color: #ef4444; color: white; border-color: #991b1b; box-shadow: 8px 8px 0px #991b1b;}
        .time-card.flash-green { animation: timer-flash-green 0.5s ease-in-out 2; }
        .score-card { background-color: #22c55e; color: white; border-color: #14532d; box-shadow: 8px 8px 0px #14532d; animation: pulse-green 2s infinite ease-in-out;}
        .score-card .content {
            font-size: clamp(2rem, 4vw, 3.5rem);
            font-weight: 900;
            text-shadow: 3px 3px 0px rgba(0,0,0,0.2);
        }
        .streak-card { background-color: #a855f7; color: white; border-color: #5b21b6; box-shadow: 8px 8px 0px #5b21b6;}
        .correct-card { background-color: #2dd4bf; color: white; border-color: #0d9488; box-shadow: 8px 8px 0px #0d9488;}

        /* Header Buttons */
        .button-cluster {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: clamp(0.25rem, 1vh, 0.5rem);
            padding: 0; background: transparent; border: none; box-shadow: none; align-content: center;
        }
        .header-btn {
            color: white; border: 4px solid #111827; border-radius: 1rem; padding: 0.5rem;
            font-size: clamp(0.7rem, 2vh, 1rem); font-weight: 900; cursor: pointer; transition: all 0.2s;
            box-shadow: 4px 4px 0px #111827;
        }
        .header-btn:hover { transform: translate(2px, 2px); box-shadow: 2px 2px 0px #111827; }
        #storeBtn { background-color: #f59e0b; }
        #endTurnBtn { background-color: #8b5cf6; }
        #storeBtn.store-ready {
            animation: store-glow 1.5s infinite, store-jiggle 0.4s infinite;
        }
        #resetAllBtn { background-color: #ec4899; }
        #aboutBtn { background-color: #10b981; }

        /* Question Area */
        .question-container {
            background-color: #334155; border-color: #111827; box-shadow: 8px 8px 0px #111827;
            display: flex; flex-direction: column; gap: clamp(0.5rem, 2vh, 1.5rem);
            transition: opacity 0.3s ease-in-out, transform 0.3s ease-in-out;
            min-height: 0;
        }
        .question-container.switching { opacity: 0; transform: scale(0.95); }
        .question-container.shake { animation: shake 0.5s cubic-bezier(.36,.07,.19,.97) both; }
        .question-box {
            background-color: #fde047; border-color: #ca8a04; box-shadow: 8px 8px 0px #ca8a04;
            padding: 1.5rem; flex: 1 1 0; display: flex; flex-direction: column; align-items: center; justify-content: space-between; gap: 1rem;
        }
        #questionText {
            flex-grow: 1;
            /* font-size is now set by JS */
            text-align: center;
            user-select: none;
            -webkit-user-select: none;
            -ms-user-select: none;
            display: flex;
            align-items: center;
            justify-content: center;
            line-height: 1.1;
            padding: 0;
            margin: 0;
        }
        #hintBtn {
            background-color: #fb923c; border: 4px solid #c2410c; box-shadow: 4px 4px 0px #c2410c;
            border-radius: 50%; width: clamp(40px, 5vw, 60px); height: clamp(40px, 5vw, 60px); font-size: 1.5rem; font-weight: 900;
            flex-shrink: 0; cursor: pointer; transition: all 0.2s;
        }
        #hintBtn:hover { transform: translate(2px, 2px); box-shadow: 2px 2px 0px #c2410c; }
        .answer-grid {
            display: grid; grid-template-columns: 1fr 1fr; gap: clamp(0.5rem, 2vh, 1.5rem);
            flex: 2 1 0; min-height: 0;
        }
        .answer-choice {
            background-color: #f59e0b; border-color: #92400e; box-shadow: 8px 8px 0px #92400e;
            cursor: pointer; transition: all 0.2s; display: flex; align-items: center;
            justify-content: center; padding: clamp(0.5rem, 2vh, 1rem);
            font-size: clamp(0.8rem, 2.5vh, 1.5rem);
            font-weight: 900;
        }
        .answer-choice:hover { transform: translate(4px, 4px); box-shadow: 4px 4px 0px #92400e; }
        .answer-choice.removed {
            opacity: 0.3; cursor: not-allowed; background-color: #9ca3af;
            border-color: #4b5563; box-shadow: none; transform: none;
        }
        .correct { background-color: #22c55e !important; color: white !important; border-color: #14532d !important; box-shadow: 8px 8px 0px #14532d !important; }
        .incorrect { background-color: #ef4444 !important; color: white !important; border-color: #991b1b !important; box-shadow: 8px 8px 0px #991b1b !important; }

        /* Abilities Section */
        .abilities-container {
            background-color: #fde047; border-color: #ca8a04; box-shadow: 8px 8px 0px #ca8a04;
            padding: clamp(0.5rem, 1.5vw, 1rem);
            flex: 1 1 0;
            min-height: 0;
            display: flex;
            flex-direction: column;
        }
        .abilities-title {
            font-family: 'Montserrat', sans-serif;
            font-weight: 900;
            font-size: clamp(1rem, 3.5vw, 1.75rem);
            padding-bottom: clamp(0.1rem, 1vh, 0.25rem);
            margin-bottom: clamp(0.25rem, 1vh, 0.5rem);
            color: #ca8a04;
            width: 100%;
            text-align: center;
            flex-shrink: 0;
        }
        .abilities-layout {
            display: flex;
            flex-direction: column;
            gap: clamp(0.5rem, 1.5vh, 1rem);
            width: 100%;
            flex-grow: 1;
            min-height: 0;
            /* Distribute space to fill the container vertically */
            justify-content: space-around;
        }
        .top-abilities {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: clamp(0.25rem, 1vh, 0.5rem);
        }
        .ability-btn {
            background-color: #fefce8; border: 4px solid #eab308; box-shadow: 4px 4px 0px #eab308;
            padding: clamp(0.1rem, 1vh, 0.5rem);
            transition: all 0.2s; border-radius: 1rem; font-weight: 900; line-height: 1.2;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            position: relative;
            width: 100%;
            font-size: clamp(0.6rem, 2vh, 0.9rem);
            /* Allow buttons to grow to fill space */
            flex-grow: 1;
            flex-shrink: 1;
        }
        .ability-btn.locked { opacity: 0.5; cursor: not-allowed; background-color: #e2e8f0; }
        .ability-btn.earned { cursor: pointer; }
        .ability-btn.earned:hover { transform: translateY(-2px); box-shadow: 6px 6px 0px #eab308; }
        .ability-btn.active { border-color: #92400e; }
        #abilityBoost {
            font-size: clamp(0.7rem, 2.5vh, 1.1rem);
        }
        #abilityBoost.active:not(.locked) {
            animation: pulse-glow 1.5s infinite, active-boost-wiggle 0.5s ease-in-out infinite;
        }
        .ability-btn .uses {
            position: absolute; top: -10px; right: -10px; background-color: #dc2626; color: white;
            border-radius: 50%; display: flex; justify-content: center; align-items: center;
            width: clamp(18px, 3vh, 24px); height: clamp(18px, 3vh, 24px); top: clamp(-12px, -1.5vh, -8px); right: clamp(-12px, -1.5vh, -8px);
            font-size: clamp(0.6rem, 1.5vh, 0.875rem); font-weight: 900; border: 2px solid white;
        }
        #abilityInfoBtn {
            background-color: #fb923c; border-color: #c2410c; box-shadow: 4px 4px 0px #c2410c;
            color: white;
            font-size: clamp(0.7rem, 2.5vh, 1rem);
        }
        .passive-abilities-container {
             display: flex; flex-direction: column; gap: clamp(0.1rem, 1vh, 0.25rem);
             /* Allow this container to grow */
             flex-grow: 1;
             justify-content: space-around;
        }
        .passive-ability {
            background-color: #dcfce7; border: 4px solid #16a34a; box-shadow: 6px 6px 0px #15803d;
            border-radius: 1rem; padding: clamp(0.2rem, 1vh, 0.5rem); text-align: left; position: relative;
            width: 100%;
            transition: transform 0.2s;
        }
        .passive-ability.jiggle {
            animation-name: jiggle; /* lgtm [js/useless-assignment-to-local] */
            animation-iteration-count: infinite;
        }
        .passive-ability.ready { animation: passive-ready-glow 1.5s infinite; }
        .passive-ability-title { font-weight: 900; font-size: clamp(0.6rem, 1.8vh, 0.8rem); line-height: 1.2; }
        .progress-bar-container {
            width: 100%; background-color: #a7f3d0; border-radius: 0.5rem;
            height: clamp(0.75rem, 2vh, 1rem); border: 2px solid #15803d;
        }
        .progress-bar {
            background-color: #22c55e; height: 100%; border-radius: 0.25rem;
            transition: width 0.3s ease-in-out;
        }
        .panther-buck-counter {
            position: absolute; top: -10px; right: -10px; background-color: #a855f7;
            color: white; border-radius: 0.75rem; padding: 0.1rem 0.5rem;
            font-size: clamp(0.75rem, 1.5vh, 0.875rem); font-weight: 900; border: 2px solid white;
        }

        /* Notification Panel */
        #notificationPanel {
            background: #1e293b;
            border: 6px solid #111827;
            box-shadow: 8px 8px 0px #111827, inset 0 0 15px rgba(0,0,0,0.5);
            border-radius: 1.5rem;
            padding: 1rem;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            overflow: hidden;
            background-image: linear-gradient(rgba(255, 255, 255, 0.03) 1px, transparent 1px);
            background-size: 100% 2px;
            width: 100%;
        }
        #notificationPanel::after {
            content: '';
            position: absolute;
            left: 0;
            width: 100%;
            height: 3px;
            background: rgba(147, 197, 253, 0.5);
            box-shadow: 0 0 10px rgba(147, 197, 253, 0.8);
            animation: scan-line-anim 3s linear infinite;
        }
        #notificationPanel { height: clamp(80px, 12vh, 120px); }
        #notificationText {
            font-family: 'VT323', monospace;
            font-size: clamp(1.1rem, 3vh, 1.5rem);
            color: #93c5fd;
            text-shadow: 0 0 3px #2563eb, 0 0 5px #2563eb;
            width: 100%;
            /* The glitch animation is now applied via a class */
        }
        #notificationText.glitch {
             animation: glitch-anim 4s linear infinite;
        }
        #notificationText.typing {
            display: inline-block; /* Prevent collapsing and allow width animation */
            width: 100%; /* Ensure it doesn't try to exceed its container */
            max-width: 100%;
            overflow: hidden;
            white-space: nowrap;
            animation: typing 1s steps(60, end);
        }
        #notificationText::before, #notificationText::after {
            content: attr(data-text); position: absolute; top: 0; left: 0; width: 100%; height: 100%; display: none;
        }
        /* Modals */
        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background-color: rgba(0, 0, 0, 0.7); display: flex;
            justify-content: center; align-items: center; z-index: 100;
            padding: 1rem;
            animation: fadeIn 0.3s ease-out; /* MODIFIED */
        }
        .modal-content {
            background-color: white; padding: clamp(1rem, 3vw, 2rem); border-radius: 1.5rem;
            border: clamp(4px, 1vw, 6px) solid #111827;
            box-shadow: clamp(4px, 1vw, 8px) clamp(4px, 1vw, 8px) 0px #111827;
            text-align: left; max-width: min(90vw, 900px); /* General max-width for all modals */
            display: flex;
            max-height: 95vh; /* Responsive max-height */
            overflow-y: auto; /* Allow content to scroll if it overflows vertically */
            flex-direction: column;
            animation: scaleUp 0.3s ease-out; /* MODIFIED */
        }
        .modal-content h2 { font-family: 'Montserrat', sans-serif; font-weight: 900; text-align: center; }
        .modal-button {
            margin: 0.5rem; padding: clamp(0.5rem, 2vw, 0.75rem) clamp(1rem, 4vw, 2rem); border-radius: 0.75rem;
            border: clamp(3px, 0.5vw, 4px) solid #111827; font-weight: 700; cursor: pointer; transition: all 0.2s;
        }
        .modal-button:hover { transform: translate(4px, 4px); box-shadow: none; }

        #abilityInfoModal .space-y-4 {
            overflow-y: auto;
            padding-right: 1rem;
        }
        /* Store Modal */
        #storeModal .modal-content {
            max-width: 900px;
        }
        .store-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 4px solid #111827;
            padding-bottom: 1rem;
            margin-bottom: 1.5rem;
        }
        .store-score {
            font-size: 1.5rem;
            font-weight: 900;
            background-color: #fde047;
            padding: 0.5rem 1rem;
            border-radius: 1rem;
            border: 4px solid #ca8a04;
        }
        .store-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 1rem;
            padding: 0.5rem;
            overflow-y: auto;
        }
        .store-item {
            background-color: #f3f4f6;
            border: 4px solid #4b5563;
            box-shadow: 6px 6px 0px #4b5563;
            border-radius: 1.5rem;
            padding: 1rem;
            text-align: center;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            transition: all 0.2s;
        }
        .store-item:hover {
            transform: translateY(-4px);
            box-shadow: 8px 8px 0px #4b5563;
        }
        .store-item-icon {
            font-size: 3rem;
            line-height: 1;
        }
        .store-item-title {
            font-weight: 900;
            font-size: 1.1rem;
            margin-top: 0.5rem;
        }
        .store-item-desc {
            font-size: 0.8rem;
            margin: 0.5rem 0;
            flex-grow: 1;
        }
        .buy-btn {
            background-color: #22c55e;
            color: white;
            border: 4px solid #14532d;
            box-shadow: 4px 4px 0 #14532d;
            font-weight: 900;
            padding: 0.5rem 1rem;
            border-radius: 1rem;
            cursor: pointer;
            transition: all 0.2s;
        }
        .buy-btn:hover {
            transform: translate(2px, 2px);
            box-shadow: 2px 2px 0 #14532d;
        }
        .buy-btn:disabled {
            background-color: #9ca3af;
            border-color: #4b5563;
            box-shadow: 4px 4px 0 #4b5563;
            cursor: not-allowed;
            transform: none;
        }
        .buy-btn.purchased {
            background-color: #a855f7;
            border-color: #5b21b6;
            box-shadow: 4px 4px 0 #5b21b6;
            cursor: default;
        }


        /* FIXES FOR LAYOUT AND TIMER */
        #timer {
            font-family: 'VT323', monospace;
        }
        #notificationPanel {
            flex-shrink: 0;
        }

        /* Responsive Design */
        @media (max-width: 1024px) {
            .main-container { grid-template-columns: 1fr; height: auto; overflow-y: auto; }
            .header-grid { grid-template-columns: 1fr 1fr; grid-template-rows: auto auto; }
            .button-cluster { grid-column: 1 / -1; flex-direction: row; grid-row: 3; }
            .right-panel { flex-direction: column; }
            .store-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 1rem;
            }
        .header-grid {
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
        }
        .button-cluster { flex-wrap: wrap; justify-content: center; }
        }

        @media (max-width: 640px) {
            .mode-grid {
                grid-template-columns: repeat(2, 1fr); /* Revert to 2 columns on small screens */
            }


            .modal-content {
                padding: 1rem;
            }
            .store-header {
                padding-bottom: 0.5rem;
                margin-bottom: 1rem;
            }
            .store-header h2 {
                font-size: 1.75rem;
            }
            .store-score {
                font-size: 1rem;
                padding: 0.25rem 0.5rem;
            }
            .store-grid {
                gap: 0.5rem;
            }
            .store-item {
                padding: 0.5rem;
                border-radius: 1rem;
            }
            .store-item-icon {
                font-size: 2rem;
            }
            .store-item-title {
                font-size: 0.8rem;
            }
            .store-item-desc {
                font-size: 0.75rem;
                margin: 0.5rem 0;
            }
            .buy-btn {
                padding: 0.4rem;
                font-size: 0.8rem;
                border-radius: 0.75rem;
            }
            .passive-ability-title {
                font-size: clamp(0.7rem, 1.8vh, 0.9rem);
            }
            .progress-bar-container { height: clamp(0.85rem, 2vh, 1.1rem); }
        }

        /* SIGMA Progress Bar */
        #sigmaProgressContainer {
            background-color: #374151;
            border: 4px solid #111827;
            box-shadow: 6px 6px 0px #111827;
            border-radius: 1rem;
            padding: clamp(0.25rem, 1vh, 0.5rem);
            text-align: center;
            margin-bottom: clamp(0.25rem, 1vh, 0.5rem);
            width: 100%;
        }
        .sigma-progress-title {
            font-weight: 900;
            font-size: clamp(0.7rem, 2vh, 0.9rem);
            color: white;
            text-transform: uppercase;
        }
        #sigmaProgressText {
            font-family: 'VT323', monospace;
            font-size: clamp(0.8rem, 2.2vh, 1rem);
            color: #d1d5db;
        }
        #dokLabel {
            font-size: clamp(0.7rem, 1.8vh, 0.9rem);
            font-weight: 700;
            color: rgba(0,0,0,0.5);
            background-color: rgba(255,255,255,0.5);
            padding: 0.4rem 0.6rem;
            border-radius: 0.5rem;
            border: 2px solid rgba(0,0,0,0.2);
            user-select: none;
        }
        #storeTooltip {
            position: fixed;
            background-color: #fffbeb;
            color: #111827;
            padding: 1.25rem;
            border-radius: 1rem;
            font-size: 1.2rem;
            font-weight: 900;
            font-family: 'Montserrat', sans-serif;
            pointer-events: none;
            z-index: 2000;
            display: none;
            max-width: 320px;
            box-shadow: 8px 8px 0px #111827;
            border: 4px solid #111827;
        }
    </style>
</head>
<body>

     <div id="difficultyModal" class="modal-overlay">
        <div class="modal-content" style="text-align: center; background-color: #f9fafb;">
            <h2 class="text-4xl font-bold mb-6" style="font-family: 'Montserrat', sans-serif; font-weight: 900; font-size: clamp(1.75rem, 4vw, 2.5rem);">Choose Your Challenge</h2>
            <div class="grid grid-cols-2 md:grid-cols-3 gap-4">
                <!-- Easy Mode -->
                <div id="easyModeBtn" class="mode-card simple" style="--main-color: #3b82f6; --shadow-color: #1d4ed8;">
                    <h3 class="flex flex-col items-center gap-2">
                        <span class="text-5xl">üòä</span>
                        <span>Easy</span>
                    </h3>
                </div>
                <!-- Myth Debunker Mode -->
                <div id="mythModeBtn" class="mode-card simple" style="--main-color: #eab308; --shadow-color: #713f12;">
                    <h3 class="flex flex-col items-center gap-2">
                        <span class="text-5xl">ü§î</span>
                        <span>Myth Debunker</span>
                    </h3>
                </div>
                <!-- Hard Mode -->
                <div id="hardModeBtn" class="mode-card simple" style="--main-color: #f97316; --shadow-color: #9a3412;">
                    <h3 class="flex flex-col items-center gap-2">
                        <span class="text-5xl">üî•</span>
                        <span>Hard</span>
                    </h3>
                </div>
                <!-- Skibidi Mode -->
                <div id="skibidiModeBtn" class="mode-card simple" style="--main-color: #a855f7; --shadow-color: #5b21b6;">
                    <h3 class="flex flex-col items-center gap-2">
                        <span class="text-5xl">‚å®Ô∏è</span>
                        <span>Skibidi</span>
                    </h3>
                </div>
                <!-- Sigma Mode -->
                <div id="sigmaModeBtn" class="mode-card simple col-span-2" style="--main-color: #374151; --shadow-color: #111827;">
                    <h3 class="flex flex-col items-center gap-2">
                        <span class="text-5xl">‚ö°</span>
                        <span>Sigma</span>
                    </h3>
                </div>
            </div>
        </div>
    </div>

    <div id="easyRulesModal" class="modal-overlay hidden">
        <div class="modal-content">
            <h2 class="text-4xl font-bold mb-4">Welcome to Easy Mode! üòä</h2>
            <div class="space-y-4 text-lg">
                <p>The classic way to play. Perfect for learning the ropes or a casual game.</p>
                <ul class="list-disc list-inside ml-4 space-y-2">
                    <li><strong>Question Type:</strong> Standard Multiple Choice.</li>
                    <li><strong>Time Limit:</strong> 5:00 minutes.</li>
                    <li><strong>Abilities:</strong> Earned at a standard rate.</li>
                </ul>
                <p class="font-bold text-center mt-4">Ready to start?</p>
            </div>
            <div class="flex justify-center mt-6">
                <button id="acceptEasyBtn" class="modal-button bg-green-500 text-white" style="box-shadow: 4px 4px 0px #111827;">Let's Go!</button>
                <button id="declineEasyBtn" class="modal-button bg-gray-500 text-white" style="box-shadow: 4px 4px 0px #111827;">Go Back</button>
            </div>
        </div>
    </div>

    <div id="hardRulesModal" class="modal-overlay hidden">
        <div class="modal-content">
            <h2 class="text-4xl font-bold mb-4">Welcome to Hard Mode! üî•</h2>
            <div class="space-y-4 text-lg">
                <p>Face tougher, analytical questions that require deeper historical knowledge.</p>
                <ul class="list-disc list-inside ml-4 space-y-2">
                    <li><strong>Question Type:</strong> Analytical Multiple Choice Questions (DOK 2-6).</li>
                    <li><strong>Time Limit:</strong> 5:00 minutes.</li>
                    <li><strong>Panther Buck Streak:</strong> Earned at a <strong>7-streak</strong> (instead of 10).</li>
                </ul>
                <p class="font-bold text-center mt-4">Think you can handle the heat?</p>
            </div>
            <div class="flex justify-center mt-6">
                <button id="acceptHardBtn" class="modal-button bg-green-500 text-white" style="box-shadow: 4px 4px 0px #111827;">Bring it On!</button>
                <button id="declineHardBtn" class="modal-button bg-gray-500 text-white" style="box-shadow: 4px 4px 0px #111827;">Go Back</button>
            </div>
        </div>
    </div>

    <div id="explanationModal" class="modal-overlay hidden">
        <div class="modal-content border-yellow-500" style="background-color: #fffbeb; text-align: center; overflow-y: auto;">
            <h2 class="text-4xl font-bold mb-4 text-yellow-600">The Real Story... ü§î</h2>
            <p id="explanationText" class="text-xl mb-6 bg-white p-4 rounded-lg border-2 border-yellow-300"></p>
            <button id="closeExplanationBtn" class="modal-button bg-yellow-500 text-white" style="box-shadow: 4px 4px 0px #713f12;">Continue</button>
        </div>
    </div>

    <div id="skibidiRulesModal" class="modal-overlay hidden">
        <div class="modal-content">
            <h2 class="text-4xl font-bold mb-4">Welcome to Skibidi Mode!</h2>
            <div class="space-y-4 text-lg">
                <p>This is the ultimate challenge! Here are the new rules:</p>
                <ul class="list-disc list-inside ml-4 space-y-2">
                    <li><strong>Type Your Answers:</strong> No more multiple choice! You must type the correct word or phrase. Spelling counts!</li>
                    <li><strong>Faster Abilities:</strong> To make it fair, most abilities are earned <strong>faster</strong>.
                        <ul class="list-decimal list-inside ml-6">
                            <li>Time Tinkerer: 2-streak (was 4)</li>
                            <li>Panther Bucks: 5-streak (was 10-streak)</li>
                            <li>Skip: 2-streak (was 3)</li>
                            <li>Redo: 3-streak (was 5)</li>
                            <li>2x Boost: 4-streak (was 7)</li>
                        </ul>
                    </li>
                    <li><strong>No More Hunch:</strong> The "Historian's Hunch" passive ability is disabled in this mode. You're on your own!</li>
                </ul>
                <p class="font-bold text-center mt-4">Are you ready for the challenge?</p>
            </div>
            <div class="flex justify-center mt-6">
                <button id="acceptSkibidiBtn" class="modal-button bg-green-500 text-white" style="box-shadow: 4px 4px 0px #111827;">I Accept</button>
                <button id="declineSkibidiBtn" class="modal-button bg-gray-500 text-white" style="box-shadow: 4px 4px 0px #111827;">Go Back</button>
            </div>
        </div>
    </div>

    <div id="mythRulesModal" class="modal-overlay hidden">
        <div class="modal-content">
            <h2 class="text-4xl font-bold mb-4">Welcome to Myth Debunker Mode!</h2>
            <div class="space-y-4 text-lg">
                <p>This mode challenges your knowledge of historical truths!</p>
                <ul class="list-disc list-inside ml-4 space-y-2">
                    <li><strong>Fact or Myth:</strong> Questions will present a statement, and you'll decide if it's a historical fact or a common myth.</li>
                    <li><strong>Explanations:</strong> After each question, you'll receive a detailed explanation, whether you're right or wrong, to help you learn the real story.</li>
                    <li><strong>No Hints:</strong> The standard hint button is disabled in this mode, as the explanation serves a similar purpose.</li>
                </ul>
                <p class="font-bold text-center mt-4">Are you ready to debunk some myths?</p>
            </div>
            <div class="flex justify-center mt-6">
                <button id="acceptMythBtn" class="modal-button bg-green-500 text-white" style="box-shadow: 4px 4px 0px #111827;">I Accept</button>
                <button id="declineMythBtn" class="modal-button bg-gray-500 text-white" style="box-shadow: 4px 4px 0px #111827;">Go Back</button>
            </div>
        </div>
    </div>


    <div id="sigmaRulesModal" class="modal-overlay hidden">
        <div class="modal-content">
            <h2 class="text-4xl font-bold mb-4">Welcome to Sigma Mode!</h2>
            <div class="space-y-4 text-lg">
                <p>This is a test of speed and knowledge. Here are the rules:</p>
                <ul class="list-disc list-inside ml-4 space-y-2">
                    <li><strong>Beat the Clock:</strong> You start with only <strong>60 seconds</strong>. There is no time limit!</li>
                    <li><strong>Advance Through Stages:</strong> Survive three increasingly difficult stages.</li>
                    <li><strong>Stage 1 (Easy):</strong> Answer all Easy questions. Earn <strong>+15 seconds</strong> per correct answer.</li>
                    <li><strong>Stage 2 (Hard):</strong> Answer all Hard questions. Earn <strong>+20 seconds</strong> per correct answer.</li>
                    <li><strong>Stage 3 (Skibidi):</strong> Answer all Skibidi (typed) questions. Earn <strong>+25 seconds</strong> per correct answer.</li>
                </ul>
                <p class="font-bold text-center mt-4">Can you survive the ultimate challenge?</p>
            </div>
            <div class="flex justify-center mt-6">
                <button id="acceptSigmaBtn" class="modal-button bg-green-500 text-white" style="box-shadow: 4px 4px 0px #111827;">I Accept</button>
                <button id="declineSigmaBtn" class="modal-button bg-gray-500 text-white" style="box-shadow: 4px 4px 0px #111827;">Go Back</button>
            </div>
        </div>
    </div>

    <div id="storeTooltip"></div>
    <div id="gradeModal" class="modal-overlay hidden">
        <div class="modal-content" style="text-align: center;">
            <h2 class="text-4xl font-bold mb-4">Select Grade Level</h2>
            <div class="mb-4">
                <select id="gradeLevelSelect" class="w-full p-3 text-xl border-4 border-gray-800 rounded-xl">
                    <option value="grade6">6th Grade</option>
                    <option value="grade7">7th Grade</option>
                    <option value="grade8">8th Grade</option>
                </select>
            </div>
            <div class="flex justify-center gap-4 mt-6">
                <button id="backToDifficultyBtn" class="modal-button bg-gray-500 text-white" style="box-shadow: 4px 4px 0px #111827;">Back</button>
                <button id="startGameBtn" class="modal-button bg-green-500 text-white" style="box-shadow: 4px 4px 0px #111827;">Start Game!</button>
            </div>
        </div>
    </div>

    <div id="storeModal" class="modal-overlay hidden">
        <div class="modal-content">
            <div class="store-header">
                <h2 class="text-4xl font-bold">Power-Up Store</h2>
                <div class="store-score">
                    Points: <span id="storeScoreDisplay">0</span>
                </div>
            </div>
            <div class="store-grid">
                <div class="store-item" data-description="Adds 30 seconds to the clock.">
                    <div>
                        <div class="store-item-icon">üßä</div>
                        <h3 class="store-item-title">Time Freeze</h3>
                    </div>
                    <button class="buy-btn" data-item="timeFreeze">Buy (3 Pts)</button>
                </div>
                 <div class="store-item" data-description="Adds 60 seconds to the clock.">
                    <div>
                        <div class="store-item-icon">‚è≥</div>
                        <h3 class="store-item-title">Time Boost</h3>
                    </div>
                    <button class="buy-btn" data-item="timeBoost">Buy (8 Pts)</button>
                </div>
                <div class="store-item" data-description="Adds 90 seconds to the clock. Instant use.">
                    <div>
                        <div class="store-item-icon">üï∞Ô∏è</div>
                        <h3 class="store-item-title">Time Warp</h3>
                    </div>
                    <button class="buy-btn" data-item="timeWarp">Buy (10 Pts)</button>
                </div>
                <div class="store-item" data-description="Next hint won't pause the timer. One-time use.">
                    <div>
                        <div class="store-item-icon">ü§ù</div>
                        <h3 class="store-item-title">Diplomat's Pass</h3>
                    </div>
                    <button class="buy-btn" data-item="diplomatsPass">Buy (8 Pts)</button>
                </div>
                <div class="store-item" data-description="Permanent: Hunch removes 2 wrong answers.">
                    <div id="hunchUpgradeStoreItem">
                        <div class="store-item-icon">‚ú®</div>
                        <h3 class="store-item-title">Hunch Upgrade</h3>
                    </div>
                    <div id="firstLastLetterStoreItem" class="hidden">
                        <div class="store-item-icon">üî†</div>
                        <h3 class="store-item-title">Letter Insight</h3>
                    </div>
                    <button class="buy-btn" data-item="hunchUpgrade">Buy (15 Pts)</button>
                </div>
                <div class="store-item" data-description="Save your streak from one mistake. One-time use.">
                    <div>
                        <div class="store-item-icon">üõ°Ô∏è</div>
                        <h3 class="store-item-title">Streak Insurance</h3>
                    </div>
                    <button class="buy-btn" data-item="streakInsurance">Buy (5 Pts)</button>
                </div>
                <div class="store-item" data-description="Instantly grants one use of the &quot;SKIP&quot; ability.">
                    <div>
                        <div class="store-item-icon">üîñ</div>
                        <h3 class="store-item-title">Scholar's Bookmark</h3>
                    </div>
                    <button class="buy-btn" data-item="scholarsBookmark">Buy (4 Pts)</button>
                </div>
                 <div class="store-item" data-description="Permanent: Correct answers are worth 1.25 points.">
                    <div>
                        <div class="store-item-icon">üìú</div>
                        <h3 class="store-item-title">Lore Master's Scroll</h3>
                    </div>
                    <button class="buy-btn" data-item="loreMastersScroll">Buy (25 Pts)</button>
                </div>
            </div>
            <div class="text-center mt-6">
                <button id="closeStoreBtn" class="modal-button bg-gray-500 text-white" style="box-shadow: 4px 4px 0px #111827;">Close</button>
            </div>
        </div>
    </div>


    <div id="endGameModal" class="modal-overlay hidden">
        <div class="modal-content" style="text-align: center;">
            <h2 class="text-5xl font-bold mb-4">Time's Up!</h2>
            <p class="text-3xl mb-2">You scored <span id="finalScore" class="font-bold text-green-500"></span> points!</p>
            <p id="mistakesReviewText" class="text-xl mb-6"></p>
            <div class="flex justify-center gap-4">
                <button id="reviewMistakesBtn" class="modal-button bg-yellow-500 text-white hidden" style="box-shadow: 4px 4px 0px #111827;">Review Mistakes</button>
                <button id="newGameBtn" class="modal-button bg-blue-500 text-white" style="box-shadow: 4px 4px 0px #111827;">Play Again</button>
            </div>
        </div>
    </div>
    <div id="reviewModal" class="modal-overlay hidden">
        <div class="modal-content" style="max-width: 800px;">
            <h2 class="text-4xl font-bold mb-4">Review Mistakes (<span id="reviewCounter"></span>)</h2>
            <div id="reviewContent" class="space-y-4 mb-6">
                <p id="reviewQuestion" class="text-xl font-bold bg-slate-200 p-4 rounded-lg"></p>
                <div id="reviewChoices" class="space-y-2"></div>
                <div id="reviewUserAnswer" class="hidden"><p class="text-lg">Your answer: <span id="reviewUserAnswerText" class="font-bold text-red-500"></span></p></div>
            </div>
            <div class="flex justify-between items-center"><button id="prevReviewBtn" class="modal-button bg-gray-400 text-white">Previous</button><button id="closeReviewBtn" class="modal-button bg-gray-500 text-white">Close</button><button id="nextReviewBtn" class="modal-button bg-gray-400 text-white">Next</button></div>
        </div>
    </div>
    <div id="aboutModal" class="modal-overlay hidden">
        <div class="modal-content" style="text-align: center;">
            <h2 class="text-4xl font-bold mb-4">About the Creator</h2>
            <p class="text-xl mb-6">This app was created by Mr. Lopez Torres, a Social Studies teacher at Woodlawn Middle School, to make learning history fun and interactive for his students. Go Panthers!</p>
            <button id="closeAboutBtn" class="modal-button bg-gray-500 text-white" style="box-shadow: 4px 4px 0px #111827;">Close</button>
        </div>
    </div>
    <div id="resetConfirmModal" class="modal-overlay hidden">
        <div class="modal-content" style="text-align: center;">
            <h2 class="text-4xl font-bold mb-4">Reset Game?</h2>
            <p class="text-xl mb-6">Are you sure? This will restart the game.</p>
            <div>
                <button id="confirmResetBtn" class="modal-button bg-red-500 text-white" style="box-shadow: 4px 4px 0px #111827;">Yes, Reset!</button>
                <button id="cancelResetBtn" class="modal-button bg-gray-500 text-white" style="box-shadow: 4px 4px 0px #111827;">Cancel</button>
            </div>
        </div>
    </div>
    <div id="hintModal" class="modal-overlay hidden">
        <div class="modal-content" style="text-align: center;">
            <h2 class="text-4xl font-bold mb-4">Here's a Hint!</h2>
            <p id="hintText" class="text-2xl mb-6"></p>
            <button id="closeHintBtn" class="modal-button bg-gray-500 text-white" style="box-shadow: 4px 4px 0px #111827;">Got it!</button>
        </div>
    </div>
    <div id="skibidiIncorrectModal" class="modal-overlay hidden">
        <div class="modal-content" style="text-align: center;">
            <h2 class="text-4xl font-bold mb-4 text-red-500">Incorrect</h2>
            <p class="text-xl mb-2">The correct answer was:</p>
            <p id="skibidiCorrectAnswerText" class="text-3xl font-bold mb-6 bg-yellow-200 p-2 rounded-lg"></p>
            <button id="closeSkibidiIncorrectBtn" class="modal-button bg-gray-500 text-white" style="box-shadow: 4px 4px 0px #111827;">Continue</button>
        </div>
    </div>
    <div id="firstLetterModal" class="modal-overlay hidden">
        <div class="modal-content" style="text-align: center;">
            <h2 class="text-4xl font-bold mb-4">Letter Insight</h2>
            <p id="firstLetterText" class="text-3xl font-bold mb-6 bg-yellow-200 p-2 rounded-lg"></p>
            <button id="closeFirstLetterBtn" class="modal-button bg-gray-500 text-white" style="box-shadow: 4px 4px 0px #111827;">Got it!</button>
        </div>
    </div>

    <div id="settingsModal" class="modal-overlay hidden">
        <div class="modal-content" style="text-align: center;">
            <h2 class="text-4xl font-bold mb-6">Settings</h2>
            <div class="flex items-center justify-center gap-4 bg-slate-100 p-4 rounded-lg">
                <label for="soundToggle" class="text-xl font-bold">Game Sounds</label>
                <button id="soundToggle" class="relative inline-flex items-center h-6 rounded-full w-11 transition-colors bg-gray-300">
                    <span id="soundToggleKnob" class="inline-block w-4 h-4 transform bg-white rounded-full transition-transform translate-x-1"></span>
                </button>
            </div>
            <button id="closeSettingsBtn" class="modal-button bg-gray-500 text-white mt-8" style="box-shadow: 4px 4px 0px #111827;">Close</button>
        </div>
    </div>

    <div id="streakModal" class="modal-overlay hidden">
        <div class="modal-content" style="text-align: center;">
            <h2 class="text-5xl font-bold mb-4 text-purple-600 animate-[glow_1.5s_ease-in-out_infinite]">POWER UP!</h2>
            <p id="streakText" class="text-2xl mb-6"></p>
            <button id="closeStreakBtn" class="modal-button bg-purple-500 text-white">Awesome!</button>
        </div>
    </div>
    <div id="abilityInfoModal" class="modal-overlay hidden">
        <div class="modal-content">
            <h2 class="text-4xl font-bold mb-4">Help Center</h2>
            <div id="helpContentContainer" class="space-y-4 text-lg overflow-y-auto pr-2">
                <!-- Content is dynamically generated by showHelpModal() -->
            </div>
            <div class="text-center mt-6">
                 <button id="closeAbilityInfoBtn" class="modal-button bg-gray-500 text-white" style="box-shadow: 4px 4px 0px #111827;">Got It!</button>
            </div>
        </div>
    </div>
    <div id="pantherBuckModal" class="modal-overlay hidden">
        <div class="modal-content" style="text-align: center;">
            <h2 class="text-5xl font-bold mb-4 text-purple-600 animate-[glow_1.5s_ease-in-out_infinite]">PANTHER BUCK!</h2>
            <p class="text-2xl mb-6">You've earned a Panther Buck! See Mr. Lopez Torres to claim your reward!</p>
            <button id="closePantherBuckBtn" class="modal-button bg-purple-500 text-white">Awesome!</button>
        </div>
    </div>

    <div id="sigmaStageUpModal" class="modal-overlay hidden">
        <div class="modal-content" style="text-align: center;">
            <h2 class="text-5xl font-bold mb-4 text-yellow-500 animate-[glow_1.5s_ease-in-out_infinite]">STAGE CLEAR!</h2>
            <p id="sigmaStageUpText" class="text-2xl mb-6"></p>
            <button id="closeSigmaStageUpBtn" class="modal-button bg-blue-500 text-white">Continue</button>
        </div>
    </div>


    <main class="main-container">
        <header id="headerGrid" class="header-grid">
            <div class="card time-card" id="timeCard">
                <h2>Time</h2>
                <p id="timer" class="content">05:00</p>
            </div>
            <div class="card score-card">
                <h2>Score</h2>
                <p id="score" class="content">0</p>
            </div>
            <div class="streak-correct-stack">
                <div class="card streak-card">
                    <h2>Streak</h2>
                    <p id="streak" class="content">0</p>
                </div>
                <div class="card correct-card">
                    <h2>Correct</h2>
                    <p id="correctAnswers" class="content">0</p>
                </div>
            </div>
            <button id="storeBtn" class="header-btn flex items-center justify-center gap-2">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-5 h-5"><circle cx="9" cy="21" r="1"></circle><circle cx="20" cy="21" r="1"></circle><path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"></path></svg>
                Store
            </button>
            <div class="button-cluster">
                <button id="endTurnBtn" class="header-btn">End Game</button>
                <button id="resetAllBtn" class="header-btn">Reset</button>
                <button id="aboutBtn" class="header-btn">About</button>
                <button id="settingsBtn" class="header-btn bg-slate-500">Settings</button>
            </div>
        </header>

        <section id="gameArea" class="card question-container">
            <div id="questionBox" class="card question-box">
                <p id="questionText"></p>
                <div class="flex justify-center items-center gap-4 mt-2" id="question-controls">
                    <div id="dokLabel" class="hidden"></div>
                    <button id="hintBtn">?</button>
                    <button id="firstLetterBtn" class="hidden bg-blue-500 text-white border-blue-800 shadow-blue-800 hover:shadow-blue-800/50 rounded-full w-12 h-12 text-lg font-black transition-all duration-200 hover:translate-y-1" style="border-width: 4px; box-shadow: 4px 4px 0px #1e40af; flex-shrink: 0; width: clamp(40px, 5vw, 60px); height: clamp(40px, 5vw, 60px);">A_</button>
                </div>
            </div>
            <div id="answerArea">
                <div class="answer-grid">
                    <div class="card answer-choice" data-choice="0"><p></p></div>
                    <div class="card answer-choice" data-choice="1"><p></p></div>
                    <div class="card answer-choice" data-choice="2"><p></p></div>
                    <div class="card answer-choice" data-choice="3"><p></p></div>
                </div>
                <form id="skibidi-form" class="hidden w-full flex flex-col sm:flex-row gap-4 items-center justify-center p-4">
                    <input type="text" id="skibidi-input" class="w-full text-2xl p-3 border-4 border-gray-800 rounded-xl" placeholder="Type your answer...">
                    <button type="submit" id="skibidi-submit" class="modal-button bg-green-500 text-white" style="box-shadow: 4px 4px 0px #111827;">Submit</button>
                </form>
                <!-- NEW: Fact or Myth buttons -->
                <div id="mythAnswerButtons" class="hidden flex justify-center gap-4 mt-4">
                    <button id="factBtn" class="modal-button bg-blue-500 text-white" style="box-shadow: 4px 4px 0px #111827;">Fact</button>
                    <button id="mythBtn" class="modal-button bg-red-500 text-white" style="box-shadow: 4px 4px 0px #111827;">Myth</button>
                </div>
            </div>
        </section>

        <div class="right-panel">
            <section id="abilitiesContainer" class="card abilities-container">
                <h2 class="abilities-title">Abilities</h2>
                <div id="sigmaProgressContainer" class="hidden">
                    <p class="sigma-progress-title">SIGMA Stage <span id="sigmaStageDisplay">1</span> Progress</p>
                    <div class="progress-bar-container bg-gray-600 border-gray-800">
                        <div id="sigmaProgressBar" class="progress-bar bg-yellow-400"></div>
                    </div>
                    <p id="sigmaProgressText" class="text-sm font-semibold"></p>
                </div>
                <div class="abilities-layout">
                    <div class="passive-abilities-container">
                        <div id="hunchAbility" class="passive-ability">
                            <p class="passive-ability-title">Historian's Hunch</p>
                            <div class="progress-bar-container">
                                <div id="hunchProgress" class="progress-bar" style="width: 0%;"></div>
                            </div>
                        </div>
                        <div id="tinkerAbility" class="passive-ability">
                            <p class="passive-ability-title">Time Tinkerer</p>
                            <div class="progress-bar-container">
                                <div id="tinkerProgress" class="progress-bar" style="width: 0%;"></div>
                            </div>
                        </div>
                        <div id="pantherBuckAbility" class="passive-ability">
                                 <div id="pantherBuckCounter" class="panther-buck-counter">0 üêæ</div>
                            <p class="passive-ability-title">Panther Bucks</p>
                            <div class="progress-bar-container">
                                <div id="pantherBuckProgress" class="progress-bar" style="width: 0%;"></div>
                            </div>
                        </div>
                    </div>
                    <div class="top-abilities">
                        <button id="abilitySkip" class="ability-btn locked">
                            <span>SKIP</span>
                            <div id="skipUses" class="uses hidden"></div>
                        </button>
                        <button id="abilityRedo" class="ability-btn locked">
                            <span>REDO</span>
                            <div id="redoUses" class="uses hidden"></div>
                        </button>
                    </div>
                    <button id="abilityBoost" class="ability-btn locked">
                        <span>2x BOOST</span>
                    </button>
                    <button id="abilityInfoBtn" class="ability-btn earned">
                        <span>HELP</span>
                    </button>
                </div>
            </section>
            <div id="notificationPanel">
                <p id="notificationText"></p>
            </div>
        </div>
    <script>
        // --- DATA ---
        const gameQuestions = {
    EASY: {
        grade6: {
            unit1: [
                { question: "Which European power primarily sought land claims in North America for the fur trade?", choices: ["Spain", "England", "France", "Netherlands"], answer: 2, hint: "They built strong alliances with Native Americans to trade animal pelts.", dok: 1 },
                { question: "What was the first permanent English settlement in North America, founded in 1607?", choices: ["Plymouth", "Jamestown", "Roanoke", "Boston"], answer: 1, hint: "It was located in present-day Virginia and saved by tobacco.", dok: 1 },
                { question: "Which document, signed in 1620, was an early agreement for self-government by the Pilgrims?", choices: ["The Magna Carta", "The Mayflower Compact", "The Declaration of Independence", "The English Bill of Rights"], answer: 1, hint: "It was signed on their ship before landing at Plymouth.", dok: 1 },
                { question: "Who was the Native American who helped the Plymouth colonists survive by teaching them to farm?", choices: ["Pocahontas", "Chief Massasoit", "Squanto", "Metacom"], answer: 2, hint: "He acted as an interpreter and showed them how to use fish as fertilizer.", dok: 1 },
                { question: "Which religious group founded the Massachusetts Bay Colony to escape persecution in England?", choices: ["The Quakers", "The Puritans", "The Catholics", "The Pilgrims"], answer: 1, hint: "They wanted to 'purify' the Church of England.", dok: 1 }
            ],
            unit2: [
                { question: "Which colonial region's economy was heavily based on shipbuilding, fishing, and trade?", choices: ["The Middle Colonies", "The Southern Colonies", "The New England Colonies", "The Western Frontier"], answer: 2, hint: "They had rocky soil and short growing seasons.", dok: 1 },
                { question: "What was the horrific journey of enslaved Africans across the Atlantic Ocean called?", choices: ["The Columbian Exchange", "The Middle Passage", "The Northwest Passage", "The Great Migration"], answer: 1, hint: "It was the middle leg of the Triangular Trade route.", dok: 1 },
                { question: "Which religious group, known for pacifism and equality, settled in Pennsylvania?", choices: ["The Puritans", "The Pilgrims", "The Quakers", "The Anglicans"], answer: 2, hint: "They were led by William Penn.", dok: 1 },
                { question: "What were the large farms in the Southern colonies that relied on enslaved labor called?", choices: ["Plantations", "Granges", "Homesteads", "Manors"], answer: 0, hint: "They grew cash crops like tobacco and rice.", dok: 1 },
                { question: "A person who agreed to work for a set time in exchange for passage to the colonies was an...", choices: ["Enslaved person", "Indentured servant", "Apprentice", "Artisan"], answer: 1, hint: "They signed a contract, usually for 4 to 7 years.", dok: 1 }
            ],
            unit3: [
                { question: "Who is considered the 'Father of Louisiana' and founded New Orleans in 1718?", choices: ["John Law", "Alejandro O'Reilly", "Jean-Baptiste Le Moyne de Bienville", "Robert Cavelier de La Salle"], answer: 2, hint: "He served as governor of the colony multiple times.", dok: 1 },
                { question: "What was the set of laws created by the French to govern the lives of enslaved people?", choices: ["The Code Noir", "The Napoleonic Code", "The Bill of Rights", "The Magna Carta"], answer: 0, hint: "It translates to the 'Black Code'.", dok: 1 },
                { question: "Which group of exiles from Canada settled in Louisiana and became known as Cajuns?", choices: ["The Isle√±os", "The Acadians", "The Germans", "The Haitians"], answer: 1, hint: "They were expelled from Nova Scotia by the British.", dok: 1 },
                { question: "What is the oldest permanent European settlement in the Louisiana Purchase territory?", choices: ["New Orleans", "Baton Rouge", "Natchitoches", "Lafayette"], answer: 2, hint: "It was founded in 1714 as a trade outpost.", dok: 1 },
                { question: "Which Spanish governor earned a 'Bloody' nickname for crushing the 1768 rebellion?", choices: ["Bernardo de Galvez", "Antonio de Ulloa", "Alejandro O'Reilly", "Esteban Miro"], answer: 2, hint: "He firmly established Spanish authority in the colony.", dok: 1 }
            ],
            unit4: [
                { question: "The French and Indian War was fought primarily between France and which other European power?", choices: ["Spain", "Great Britain", "The Netherlands", "Portugal"], answer: 1, hint: "They were fighting for control of the Ohio River Valley.", dok: 1 },
                { question: "Which British act placed a tax on all paper goods, such as newspapers and legal documents?", choices: ["The Sugar Act", "The Quartering Act", "The Tea Act", "The Stamp Act"], answer: 3, hint: "Colonists had to buy a special seal to prove they paid.", dok: 1 },
                { question: "Who was the primary author of the Declaration of Independence?", choices: ["George Washington", "John Adams", "Thomas Jefferson", "Benjamin Franklin"], answer: 2, hint: "He wrote that 'all men are created equal.'", dok: 1 },
                { question: "What event involved the Sons of Liberty dumping taxed goods into the harbor?", choices: ["The Boston Massacre", "The Boston Tea Party", "The First Continental Congress", "The Battle of Bunker Hill"], answer: 1, hint: "They disguised themselves as Native Americans during the protest.", dok: 1 },
                { question: "Where did the British army surrender to George Washington, ending the Revolutionary War?", choices: ["Saratoga", "Lexington", "Yorktown", "Valley Forge"], answer: 2, hint: "General Cornwallis was trapped by the American army and French navy.", dok: 1 }
            ]
        },
        grade7: {
            unit1: [
                { question: "Who was the first President of the United States?", choices: ["John Adams", "Thomas Jefferson", "George Washington", "Alexander Hamilton"], answer: 2, hint: "He set many precedents, including leaving after two terms.", dok: 1 },
                { question: "Which leader of the Federalist Party served as the first Secretary of the Treasury?", choices: ["James Madison", "Thomas Jefferson", "Aaron Burr", "Alexander Hamilton"], answer: 3, hint: "He is featured on the ten-dollar bill.", dok: 1 },
                { question: "What was the 1794 uprising of farmers protesting a federal tax called?", choices: ["Shays' Rebellion", "Bacon's Rebellion", "The Whiskey Rebellion", "The Stamp Act Protest"], answer: 2, hint: "George Washington led troops to stop it.", dok: 1 },
                { question: "What did George Washington warn against in his Farewell Address?", choices: ["A strong national military", "Political parties and foreign alliances", "Westward expansion", "The creation of public schools"], answer: 1, hint: "He feared these would divide and endanger the young nation.", dok: 1 },
                { question: "The Alien and Sedition Acts, passed under John Adams, heavily restricted what freedom?", choices: ["Freedom of religion", "The right to bear arms", "Freedom of speech and the press", "The right to a speedy trial"], answer: 2, hint: "They made it illegal to criticize the government.", dok: 1 }
            ],
            unit2: [
                { question: "What 1803 land deal with France doubled the size of the United States?", choices: ["The Gadsden Purchase", "The Florida Purchase", "The Louisiana Purchase", "The Oregon Treaty"], answer: 2, hint: "It was purchased by Thomas Jefferson.", dok: 1 },
                { question: "Who did Thomas Jefferson send to explore the new western territory?", choices: ["Pike and Long", "Marquette and Joliet", "Lewis and Clark", "Boone and Crockett"], answer: 2, hint: "Their group was called the Corps of Discovery.", dok: 1 },
                { question: "What was the British practice of forcing American sailors to serve in their navy called?", choices: ["Blockading", "Impressment", "Embargo", "Conscription"], answer: 1, hint: "This was a major cause of the War of 1812.", dok: 1 },
                { question: "Who wrote 'The Star-Spangled Banner' after witnessing the attack on Fort McHenry?", choices: ["Francis Scott Key", "Thomas Jefferson", "Andrew Jackson", "James Madison"], answer: 0, hint: "He saw that the flag was still there in the morning.", dok: 1 },
                { question: "What battle made Andrew Jackson a national hero, even though the peace treaty was already signed?", choices: ["Battle of Lake Erie", "Battle of Tippecanoe", "Battle of New Orleans", "Battle of Yorktown"], answer: 2, hint: "He defended the mouth of the Mississippi River.", dok: 1 }
            ],
            unit3: [
                { question: "What foreign policy statement warned Europe not to colonize the Americas?", choices: ["The Truman Doctrine", "The Monroe Doctrine", "Manifest Destiny", "The American System"], answer: 1, hint: "It was issued in 1823 by the 5th president.", dok: 1 },
                { question: "The belief that the U.S. was meant to expand to the Pacific Ocean was known as...", choices: ["Imperialism", "Nationalism", "Manifest Destiny", "Sectionalism"], answer: 2, hint: "It translates to 'obvious fate'.", dok: 1 },
                { question: "What invention by Eli Whitney vastly increased the demand for enslaved labor in the South?", choices: ["The Steam Engine", "The Telegraph", "The Cotton Gin", "The Mechanical Reaper"], answer: 2, hint: "It quickly separated seeds from the fiber.", dok: 1 },
                { question: "The forced march of the Cherokee people to Indian Territory is tragically known as the...", choices: ["Trail of Tears", "Long Walk", "Great Migration", "Western Journey"], answer: 0, hint: "Thousands died due to exposure and disease.", dok: 1 },
                { question: "The rapid shift to machine-made goods in factories is known as the...", choices: ["Agricultural Revolution", "Industrial Revolution", "Information Age", "Progressive Era"], answer: 1, hint: "It began in New England with textile mills.", dok: 1 }
            ],
            unit4: [
                { question: "What was the first public meeting focused on women's rights in the U.S.?", choices: ["The Albany Congress", "The Boston Tea Party", "The Seneca Falls Convention", "The Constitutional Convention"], answer: 2, hint: "It was held in New York in 1848.", dok: 1 },
                { question: "Who was the famous 'conductor' on the Underground Railroad who never lost a passenger?", choices: ["Sojourner Truth", "Harriet Tubman", "Dorothea Dix", "Elizabeth Cady Stanton"], answer: 1, hint: "She was known as 'Moses' to her people.", dok: 1 },
                { question: "Which reformer campaigned to improve conditions in prisons and mental asylums?", choices: ["Horace Mann", "William Lloyd Garrison", "Dorothea Dix", "Frederick Douglass"], answer: 2, hint: "She convinced legislatures to build humane hospitals.", dok: 1 },
                { question: "What book by Harriet Beecher Stowe exposed the cruelty of slavery to Northern readers?", choices: ["Common Sense", "The Liberator", "Uncle Tom's Cabin", "The North Star"], answer: 2, hint: "Lincoln supposedly said it started the great war.", dok: 1 },
                { question: "Which Supreme Court case ruled that enslaved people were property and could not sue in court?", choices: ["Marbury v. Madison", "Worcester v. Georgia", "Dred Scott v. Sandford", "Plessy v. Ferguson"], answer: 2, hint: "It declared the Missouri Compromise unconstitutional.", dok: 1 }
            ]
        },
        grade8: {
            unit1: [
                { question: "African Americans who migrated from the South to Kansas after Reconstruction were called...", choices: ["Forty-niners", "Exodusters", "Sooners", "Muckrakers"], answer: 1, hint: "They sought to escape the Jim Crow South.", dok: 1 },
                { question: "What 1876 battle was a major victory for the Lakota and Cheyenne over Custer's cavalry?", choices: ["Battle of Wounded Knee", "Battle of the Alamo", "Battle of Little Bighorn", "Battle of Gettysburg"], answer: 2, hint: "It is also known as 'Custer's Last Stand'.", dok: 1 },
                { question: "The system of laws that enforced racial segregation in the South was known as...", choices: ["The Black Codes", "The Jim Crow system", "The Spoils System", "The American System"], answer: 1, hint: "It mandated separate facilities for whites and Blacks.", dok: 1 },
                { question: "Who founded the Tuskegee Institute and promoted vocational education for African Americans?", choices: ["W.E.B. Du Bois", "Ida B. Wells", "Booker T. Washington", "Marcus Garvey"], answer: 2, hint: "He believed economic skills should precede political equality.", dok: 1 },
                { question: "Which Supreme Court case established the 'separate but equal' doctrine in 1896?", choices: ["Dred Scott v. Sandford", "Plessy v. Ferguson", "Brown v. Board of Education", "Marbury v. Madison"], answer: 1, hint: "It legalized segregation for over 50 years.", dok: 1 }
            ],
            unit2: [
                { question: "What economic system is based on private ownership and competition in a free market?", choices: ["Communism", "Socialism", "Capitalism", "Mercantilism"], answer: 2, hint: "It drove the American Industrial Revolution.", dok: 1 },
                { question: "Which industrialist built a massive monopoly in the American steel industry?", choices: ["John D. Rockefeller", "Andrew Carnegie", "J.P. Morgan", "Cornelius Vanderbilt"], answer: 1, hint: "He used the Bessemer process and vertical integration.", dok: 1 },
                { question: "Journalists who investigated and exposed corruption and social problems were called...", choices: ["Robber Barons", "Muckrakers", "Populists", "Suffragettes"], answer: 1, hint: "Upton Sinclair and Ida Tarbell were famous examples.", dok: 1 },
                { question: "What was the political movement formed by farmers to fight back against big business and railroads?", choices: ["The Progressive Movement", "The Federalist Party", "The Populist Party", "The Whig Party"], answer: 2, hint: "Also known as the People's Party.", dok: 1 },
                { question: "The growth of cities, primarily due to industrialization and immigration, is called...", choices: ["Urbanization", "Assimilation", "Manifest Destiny", "Isolationism"], answer: 0, hint: "It led to overcrowded tenements and sanitation issues.", dok: 1 }
            ],
            unit3: [
                { question: "What 1898 war resulted in the U.S. acquiring Puerto Rico, Guam, and the Philippines?", choices: ["World War I", "The Mexican-American War", "The Spanish-American War", "The Civil War"], answer: 2, hint: "The sinking of the USS Maine helped trigger it.", dok: 1 },
                { question: "What man-made waterway connected the Atlantic and Pacific Oceans, drastically cutting travel time?", choices: ["The Suez Canal", "The Erie Canal", "The Panama Canal", "The Great Lakes Seaway"], answer: 2, hint: "President Theodore Roosevelt pushed for its construction.", dok: 1 },
                { question: "The sinking of which British passenger ship by a German U-boat outraged Americans in 1915?", choices: ["The Titanic", "The Maine", "The Lusitania", "The Arizona"], answer: 2, hint: "Over 100 Americans were killed.", dok: 1 },
                { question: "What was the primary style of fighting on the Western Front during World War I?", choices: ["Naval blockades", "Trench warfare", "Guerilla tactics", "Aerial bombing"], answer: 1, hint: "Soldiers lived in muddy ditches, causing a long stalemate.", dok: 1 },
                { question: "Which amendment, ratified in 1920, guaranteed women the right to vote?", choices: ["13th Amendment", "17th Amendment", "18th Amendment", "19th Amendment"], answer: 3, hint: "It was the culmination of the suffrage movement.", dok: 1 }
            ],
            unit4: [
                { question: "What era was defined by the 18th Amendment, which banned the manufacture and sale of alcohol?", choices: ["The Great Depression", "The Progressive Era", "Prohibition", "The Cold War"], answer: 2, hint: "It led to speakeasies and bootleggers.", dok: 1 },
                { question: "What was the 1920s cultural movement that celebrated African American art, music, and literature?", choices: ["The Great Awakening", "The Enlightenment", "The Harlem Renaissance", "The Second Great Migration"], answer: 2, hint: "It featured artists like Langston Hughes and Louis Armstrong.", dok: 1 },
                { question: "What severe environmental disaster devastated the Great Plains in the 1930s?", choices: ["The Great Flood", "The Dust Bowl", "The San Francisco Earthquake", "The Spanish Flu"], answer: 1, hint: "It was caused by drought and poor farming practices.", dok: 1 },
                { question: "What was the name of President Franklin D. Roosevelt's program to combat the Great Depression?", choices: ["The Square Deal", "The New Frontier", "The Great Society", "The New Deal"], answer: 3, hint: "It included programs like the CCC and TVA.", dok: 1 },
                { question: "Which controversial Louisiana governor and senator created the 'Share Our Wealth' program?", choices: ["Huey Long", "Jimmie Davis", "Edwin Edwards", "John McKeithen"], answer: 0, hint: "He was known as 'The Kingfish.'", dok: 1 }
            ]
        }
    },
    HARD: {
        grade6: {
            unit1: [
                { question: "Analyze the primary difference in motivation between the founding of Jamestown and Plymouth.", choices: ["Jamestown was for religion; Plymouth for profit.", "Jamestown was for profit; Plymouth for religious freedom.", "Both were founded primarily for military defense.", "Both were founded to find the Northwest Passage."], answer: 1, hint: "One was an investment company; the other was settled by Separatists.", dok: 3 },
                { question: "Evaluate the impact of Bacon's Rebellion on the labor system in the Virginia colony.", choices: ["It ended all farming in the region.", "It caused a shift from indentured servitude to enslaved African labor.", "It resulted in equal rights for poor farmers.", "It stopped the colony from expanding westward."], answer: 1, hint: "Wealthy planters began to fear uprisings from poor white servants.", dok: 4 },
                { question: "Explain how the geography of the New England colonies shaped their economic development.", choices: ["Rich soil led to large tobacco plantations.", "Rocky soil and natural harbors led to an economy based on fishing and shipbuilding.", "The warm climate allowed for year-round farming of cash crops.", "The lack of rivers prevented any trade networks from forming."], answer: 1, hint: "Since they couldn't farm on a large scale, they turned to the sea.", dok: 3 },
                { question: "Compare the French and English approaches to interacting with Native American populations.", choices: ["Both sought to conquer and enslave all tribes immediately.", "The French focused on trade alliances; the English focused on land acquisition and settlement.", "The English focused on trade alliances; the French focused on land acquisition.", "Neither group interacted with Native Americans at all."], answer: 1, hint: "France needed partners for the fur trade; England needed space for farms.", dok: 3 },
                { question: "Analyze the consequences of King Philip's War for Native Americans in New England.", choices: ["It resulted in the return of all tribal lands.", "It led to a lasting, peaceful treaty.", "It broke Native American power and allowed rapid colonial expansion.", "It had no significant impact on the region."], answer: 2, hint: "It was a devastating defeat that ended major indigenous resistance in the area.", dok: 3 }
            ],
            unit2: [
                { question: "Analyze the impact of the Triangular Trade on the continent of Africa.", choices: ["It increased the wealth and stability of all African nations.", "It led to depopulation, the loss of able-bodied workers, and increased warfare.", "It created a long-lasting era of peace between coastal tribes.", "It had no significant cultural or demographic impact."], answer: 1, hint: "The demand for enslaved people fueled conflict and societal collapse.", dok: 4 },
                { question: "Evaluate the role of town meetings in the development of colonial New England society.", choices: ["They established the absolute rule of the English King.", "They were exclusive clubs only for the wealthy elite.", "They served as an early form of direct democracy where citizens voted on local issues.", "They were used primarily to organize the militia."], answer: 2, hint: "It allowed ordinary community members to have a voice in local laws.", dok: 3 },
                { question: "Synthesize the reasons why the Middle Colonies were more culturally and religiously diverse than New England.", choices: ["New England legally banned all immigration.", "The Middle Colonies, particularly Pennsylvania, actively promoted religious tolerance.", "The Middle Colonies lacked any formal government structure.", "New England was geographically too difficult for ships to reach."], answer: 1, hint: "Consider the influence of Quaker beliefs on colonial policies.", dok: 3 },
                { question: "Analyze the economic interdependence between the Northern and Southern colonies.", choices: ["They functioned independently and did not trade with each other.", "The South grew food primarily to feed the North.", "The North relied on Southern cash crops to fuel its shipping and processing industries.", "The North provided all the agricultural labor for the South."], answer: 2, hint: "Northern merchants made vast fortunes shipping Southern tobacco and rice.", dok: 3 },
                { question: "Explain the fundamental difference between an indentured servant and an enslaved person in colonial law.", choices: ["Both were considered property for life.", "Servants worked under a temporary contract; enslaved people were considered property for life.", "Enslaved people worked under contracts; servants were property.", "Servants were paid high wages; enslaved people were paid low wages."], answer: 1, hint: "One condition was legally temporary; the other was permanent and hereditary.", dok: 3 }
            ],
            unit3: [
                { question: "Analyze the economic impact of John Law's 'Mississippi Bubble' on the Louisiana colony.", choices: ["It created lasting, stable wealth for all settlers.", "It led to a massive influx of settlers but ultimately resulted in a financial collapse.", "It had no significant impact on the colony's population or economy.", "It successfully paid off all of France's national debt."], answer: 1, hint: "While the financial scheme burst, it did succeed in bringing people to the colony.", dok: 4 },
                { question: "Evaluate the dual purpose of the French Code Noir in colonial Louisiana.", choices: ["It granted enslaved people full rights and banned religion.", "It established a strict legal framework for control while also mandating Catholic instruction.", "It abolished slavery and established free trade.", "It gave the Gens de Couleur Libres the right to vote."], answer: 1, hint: "It was a tool for subjugation that also included religious requirements.", dok: 4 },
                { question: "Compare the French and Spanish approaches to governing the Louisiana colony.", choices: ["The French maintained strict military control; the Spanish allowed self-rule.", "Both nations completely neglected the colony's administration.", "The French focused primarily on trade; the Spanish focused on order, administration, and military defense.", "The Spanish forced all colonists to adopt the Spanish language and customs immediately."], answer: 2, hint: "Think of Alejandro O'Reilly's actions to establish strong authority.", dok: 3 },
                { question: "Analyze the social significance of the 'Gens de Couleur Libres' in New Orleans.", choices: ["They were entirely prohibited from owning property.", "They formed a distinct, influential middle class of artisans, militia members, and property owners.", "They were primarily forced to work as field laborers.", "They held all the top political offices in the Spanish government."], answer: 1, hint: "They occupied a unique space in society between white colonists and enslaved Africans.", dok: 3 },
                { question: "Explain the strategic reasons behind the secret Treaty of Fontainebleau (1762).", choices: ["France sold Louisiana to Spain to pay off a massive debt.", "France transferred Louisiana to Spain to keep it out of British hands at the end of the war.", "Spain threatened to invade France if they didn't surrender the territory.", "The colonists successfully petitioned to join the Spanish Empire."], answer: 1, hint: "France knew they were losing the French and Indian War and wanted to protect their ally.", dok: 3 }
            ],
            unit4: [
                { question: "Analyze how the conclusion of the French and Indian War directly led to the American Revolution.", choices: ["It caused the colonists to ally with France against Britain.", "Britain's massive war debt led to the end of Salutary Neglect and the imposition of new taxes.", "The colonies gained so much land they decided they didn't need Britain.", "Native American tribes forced the British to grant the colonies independence."], answer: 1, hint: "The British felt the colonists should pay for their own defense.", dok: 4 },
                { question: "Evaluate the effectiveness of colonial boycotts against British taxation.", choices: ["They were completely ignored by the British Parliament.", "They caused severe economic pain for British merchants, leading to the repeal of several acts.", "They led directly to an immediate declaration of war.", "They only damaged the economy of the American colonies."], answer: 1, hint: "Hitting the British in their wallets proved to be a highly effective political weapon.", dok: 4 },
                { question: "Explain the constitutional argument behind the phrase 'Taxation without Representation'.", choices: ["Colonists refused to pay any taxes under any circumstances.", "Colonists believed only their own elected colonial assemblies possessed the legal right to tax them.", "Colonists demanded seats in the French Parliament.", "Colonists wanted the King to collect taxes personally."], answer: 1, hint: "It was about *who* had the authority to levy the tax, not just the money itself.", dok: 3 },
                { question: "Synthesize the main arguments presented by Thomas Paine in his pamphlet 'Common Sense'.", choices: ["Monarchy is an irrational system and it is illogical for an island to rule a continent.", "The colonies should remain loyal to the King but demand lower taxes.", "Taxes are necessary for protection and should be paid willingly.", "France is the true enemy of American liberty."], answer: 0, hint: "He used plain language to argue that independence was the only logical choice.", dok: 3 },
                { question: "Analyze the strategic importance of the Battle of Saratoga in the Revolutionary War.", choices: ["It allowed the British to successfully capture New York City.", "It proved the Continental Army could fight and secured a vital military alliance with France.", "It was the final battle that ended the conflict.", "It resulted in the devastating capture of George Washington."], answer: 1, hint: "Without the financial and naval support gained from this victory, the Americans likely would have lost.", dok: 4 }
            ]
        },
        grade7: {
            unit1: [
                { question: "Analyze how the differing philosophies of Alexander Hamilton and Thomas Jefferson laid the groundwork for the first political parties.", choices: ["Their agreement on foreign policy united the nation.", "Their fundamental disagreements on the scope of federal power and the economy created factional divides.", "Both leaders advocated for a weak central government, uniting voters.", "Their personal rivalry was the sole cause of the divisions."], answer: 1, hint: "Consider their contrasting visions of an industrial vs. agrarian society.", dok: 4 },
                { question: "Evaluate the significance of George Washington's response to the Whiskey Rebellion.", choices: ["It exposed the crippling weakness of the federal government.", "It proved the new constitutional government had the power and will to enforce its laws.", "It led to the immediate and permanent repeal of the federal tax.", "It caused several states to threaten secession from the Union."], answer: 1, hint: "Compare this decisive action to the government's inability to handle Shays' Rebellion.", dok: 4 },
                { question: "Explain how the Federalist defense of the National Bank relied on a 'loose construction' interpretation of the Constitution.", choices: ["They argued the Constitution explicitly mentioned a bank.", "They utilized the 'Necessary and Proper' clause to justify the bank's creation to manage the economy.", "They claimed the bank was unconstitutional but necessary anyway.", "They argued state banks should hold supreme authority."], answer: 1, hint: "They believed the government had implied powers not explicitly written in the text.", dok: 4 },
                { question: "Analyze the political consequences of the Alien and Sedition Acts passed under John Adams.", choices: ["They successfully unified the country against the threat of France.", "They were perceived as an unconstitutional attack on free speech and were used to jail political opponents.", "They were immediately struck down by the Supreme Court.", "They had no real political impact and were widely ignored."], answer: 1, hint: "How would a law that criminalizes government criticism affect a democracy?", dok: 3 },
                { question: "Evaluate the long-term historical impact of the Election of 1800 (the 'Revolution of 1800').", choices: ["It proved that power could not be transferred peacefully between opposing parties.", "It resulted in the dissolution of the Electoral College.", "It established the crucial precedent of a peaceful transfer of power between rival political factions.", "It led to a constitutional crisis that permanently weakened the presidency."], answer: 2, hint: "What did it mean for the stability of the Republic that the ruling party stepped down after losing?", dok: 4 }
            ],
            unit2: [
                { question: "Analyze the constitutional dilemma Thomas Jefferson faced regarding the Louisiana Purchase.", choices: ["He believed the purchase was explicitly authorized by the Constitution.", "He sought to pass a constitutional amendment before finalizing the treaty.", "He had to adopt a 'loose construction' interpretation of executive treaty-making powers to justify the purchase.", "He ignored the Constitution entirely and bypassed Congress."], answer: 2, hint: "As a strict constructionist, he struggled because the Constitution didn't explicitly grant the power to buy land.", dok: 4 },
                { question: "Evaluate the most significant long-term domestic consequence of the War of 1812 for the United States.", choices: ["The U.S. successfully annexed large portions of Canada.", "The war triggered a severe, decades-long economic depression.", "The war destroyed American manufacturing capabilities in New England.", "The war fostered a surge of nationalism and stimulated domestic industrial growth."], answer: 3, hint: "Cut off from British goods, Americans had to start making things themselves while feeling a new sense of pride.", dok: 4 },
                { question: "Compare the motivations of Native American groups who allied with Britain during the War of 1812 with those who allied with the U.S.", choices: ["All Native American groups universally allied with Britain.", "Tribes made strategic alliances based on preserving their land and sovereignty against expansion.", "All Native American groups remained strictly neutral.", "Motivations were based entirely on the fur trade."], answer: 1, hint: "Think about who represented the most immediate threat to indigenous lands at the time.", dok: 3 },
                { question: "Explain the psychological and political impact of the Battle of New Orleans.", choices: ["It was viewed as a minor skirmish with no real significance.", "Though fought after the peace treaty, it created massive national pride and propelled Jackson to political stardom.", "Jackson's defeat at the battle ruined his political career.", "It was seen as an embarrassing and unnecessary loss of life."], answer: 1, hint: "Focus on the symbolic importance of overwhelmingly defeating the British military.", dok: 3 },
                { question: "Synthesize how events like the West Florida Controversy demonstrated early American expansionist desires.", choices: ["They show the U.S. was hesitant to expand beyond its borders.", "They were isolated incidents orchestrated by the Spanish government.", "They reflected a clear, aggressive pattern of settlers pushing boundaries to solidify U.S. control of the Gulf Coast.", "They proved that diplomacy was always preferred over action."], answer: 2, hint: "Consider the actions of American settlers seizing forts in Spanish territory.", dok: 4 }
            ],
            unit3: [
                { question: "Analyze how the invention of the cotton gin contributed to the growth of sectionalism.", choices: ["It reduced the need for enslaved labor, bringing the North and South together politically.", "It made the Southern economy more industrial, mirroring the North.", "It deeply entrenched plantation agriculture and enslaved labor in the South while the North industrialized.", "It had no significant impact on the relationship between the two regions."], answer: 2, hint: "How did one invention reinforce two totally different economic systems?", dok: 4 },
                { question: "Evaluate President Andrew Jackson's response to the Supreme Court ruling in Worcester v. Georgia.", choices: ["He utilized the military to enforce the ruling and protect Cherokee lands.", "He openly defied the Court's authority, allowing the forced removal to proceed.", "He asked Congress to rewrite the Indian Removal Act.", "He resigned from office in protest of the decision."], answer: 1, hint: "He essentially said, 'John Marshall has made his decision; now let him enforce it.'", dok: 4 },
                { question: "Explain how the ideology of Manifest Destiny influenced U.S. actions regarding the Mexican-American War.", choices: ["It encouraged diplomacy to preserve peace at all costs.", "It provided a moral and divine justification for aggressive territorial expansion and war.", "It focused national attention solely on acquiring the Oregon Territory.", "It was used by opponents of the war to argue against expansion."], answer: 1, hint: "If a nation believes it is 'destined' by God to control the continent, how does it view obstacles?", dok: 3 },
                { question: "Analyze the economic impact of the Erie Canal and the Transportation Revolution.", choices: ["It made transportation slower and significantly more expensive.", "It connected the agricultural Midwest to Eastern markets, drastically lowering shipping costs and boosting trade.", "It primarily benefited only the state of New York.", "It caused a total collapse of the Southern economy."], answer: 1, hint: "Think about how moving goods efficiently by water changed the national economy.", dok: 3 },
                { question: "Synthesize the 'push' and 'pull' factors that drove massive Irish and German immigration in the 1840s.", choices: ["Immigrants were pushed by religious freedom and pulled by famine.", "Immigrants were pushed by famine and political turmoil, and pulled by the promise of jobs and land in the U.S.", "The only factor was the California Gold Rush.", "The U.S. government forced them to immigrate."], answer: 1, hint: "Connect disasters in Europe with opportunities in a growing America.", dok: 4 }
            ],
            unit4: [
                { question: "Analyze the significance of the language used in the 'Declaration of Sentiments' at the Seneca Falls Convention.", choices: ["It was written in French to appeal to international allies.", "By mimicking the Declaration of Independence, it effectively argued that women were entitled to the same foundational rights as men.", "It focused entirely on the abolition of slavery rather than women's rights.", "It was a legal contract to establish public schools."], answer: 1, hint: "Think about the phrase: 'We hold these truths to be self-evident: that all men and women are created equal.'", dok: 4 },
                { question: "Evaluate the impact of the Fugitive Slave Act of 1850 on Northern society.", choices: ["It made Northerners more sympathetic to Southern slaveholders.", "It outraged Northerners by forcing them to participate in the slave system, dramatically increasing anti-slavery sentiment.", "It completely stopped all escapes via the Underground Railroad.", "It peacefully resolved the tensions between the North and South."], answer: 1, hint: "It brought the brutal reality of slavery directly into free states.", dok: 4 },
                { question: "Explain how the concept of 'popular sovereignty' in the Kansas-Nebraska Act led to 'Bleeding Kansas.'", choices: ["It successfully banned slavery in the territory.", "By letting settlers vote on slavery, it triggered a violent rush of pro- and anti-slavery forces fighting to control the election.", "It forced all Native Americans to leave the territory.", "It resulted in a unanimous, peaceful vote."], answer: 1, hint: "When the people decide the law, extremes on both sides will try to rig the outcome.", dok: 3 },
                { question: "Analyze the core legal reasoning behind the Supreme Court's Dred Scott decision.", choices: ["The Court ruled Scott was free because he lived in a free state.", "The Court ruled that Black Americans were not citizens and that Congress had no constitutional authority to ban slavery in the territories.", "The Court ruled that slavery was illegal nationwide.", "The Court refused to hear the case entirely."], answer: 1, hint: "Chief Justice Taney's decision essentially declared the Missouri Compromise unconstitutional.", dok: 4 },
                { question: "Compare the approaches of abolitionists William Lloyd Garrison and Frederick Douglass.", choices: ["Both believed the Constitution was inherently pro-slavery.", "Garrison saw the Constitution as a pro-slavery document to be condemned, while Douglass believed its principles could be used to fight for freedom.", "Douglass advocated for violence, while Garrison strictly advocated for gradual political reform.", "Both focused exclusively on colonizing freed slaves in Africa."], answer: 1, hint: "One burned the document; the other cited its ideals.", dok: 4 }
            ]
        },
        grade8: {
            unit1: [
                { question: "Analyze the motivations of the 'Exodusters' migrating to the West in the late 1870s.", choices: ["They were seeking gold in the California mountains.", "They were fleeing the violence, disenfranchisement, and economic oppression of the Jim Crow South to find land and freedom.", "They were recruited by railroad companies to lay track.", "They were European immigrants seeking factory jobs."], answer: 1, hint: "Consider what was happening to African Americans in the South after Reconstruction ended.", dok: 3 },
                { question: "Evaluate the argument presented in Frederick Jackson Turner's 'Frontier Thesis'.", choices: ["He argued that the frontier was irrelevant to American history.", "He argued that the process of expanding the frontier shaped the unique American character of independence and democracy.", "He argued that the West should be returned to Native American control.", "He argued that industrial cities were the true source of American culture."], answer: 1, hint: "He believed facing the challenges of the wild made Americans who they are.", dok: 3 },
                { question: "Analyze the strategic and cultural impact of the near-extermination of the American buffalo.", choices: ["It allowed Native American tribes to develop new agricultural techniques.", "It was a deliberate tactic to subjugate Plains Indians by destroying their primary source of food, shelter, and cultural identity.", "It had no effect on the conflict between settlers and tribes.", "It was solely the result of a natural disease outbreak."], answer: 1, hint: "Without the buffalo, the nomadic lifestyle of the Plains tribes was impossible.", dok: 4 },
                { question: "Compare the philosophies of Booker T. Washington and W.E.B. Du Bois regarding civil rights.", choices: ["Both demanded immediate integration and voting rights.", "Washington prioritized economic self-reliance and vocational training, while Du Bois demanded immediate political equality and higher education.", "Du Bois focused on vocational training, while Washington founded the NAACP.", "Both believed African Americans should emigrate back to Africa."], answer: 1, hint: "Think of the 'Atlanta Compromise' versus the 'Talented Tenth'.", dok: 4 },
                { question: "Evaluate the long-term legal and social impact of the Plessy v. Ferguson decision.", choices: ["It immediately ended all segregation in the United States.", "It legitimized state-sponsored discrimination by establishing the 'separate but equal' doctrine, entrenching the Jim Crow system for decades.", "It applied only to railroad travel and had no broader impact.", "It guaranteed equal funding for all segregated public schools."], answer: 1, hint: "This ruling gave legal cover to systemic racism.", dok: 4 }
            ],
            unit2: [
                { question: "Analyze how the policy of 'laissez-faire' capitalism contributed to the rise of monopolies.", choices: ["It created strict labor laws that protected workers.", "It resulted in heavy taxation on large corporations.", "By minimizing government regulation, it allowed aggressive businessmen to eliminate competition and consolidate entire industries.", "It provided government subsidies exclusively to small family farms."], answer: 2, hint: "The term translates to 'let do' or 'hands off'.", dok: 3 },
                { question: "Evaluate the effectiveness of early labor unions in improving the lives of industrial workers.", choices: ["They immediately secured an 8-hour workday and high wages for all.", "Despite facing violent opposition and government intervention favoring owners, they laid the groundwork for future worker protections.", "They were entirely controlled by the factory owners.", "They focused solely on political elections rather than workplace conditions."], answer: 1, hint: "Strikes were often crushed, but the movement slowly brought attention to the issues.", dok: 4 },
                { question: "Explain the strategy of 'horizontal integration' used by industrialists like John D. Rockefeller.", choices: ["Owning every step of the supply chain, from raw materials to transport.", "Buying out or merging with all competing companies in the same industry to control the market.", "Refusing to use any new technological advancements.", "Paying workers high wages to ensure loyalty."], answer: 1, hint: "Think of expanding outward to absorb all your rivals.", dok: 3 },
                { question: "Analyze the role of 'muckrakers' in driving the reforms of the Progressive Era.", choices: ["They lobbied Congress to lower taxes on the wealthy.", "They used investigative journalism to expose corporate greed and societal rot, turning public opinion in favor of government regulation.", "They organized the construction of new factories.", "They promoted the expansion of American imperialism."], answer: 1, hint: "Their exposes on things like meatpacking forced the government to act.", dok: 4 },
                { question: "Synthesize the core grievances that led to the formation of the Populist Party.", choices: ["Wealthy bankers were angry about low interest rates.", "Urban factory workers wanted to ban all immigration.", "Farmers were drowning in debt, frustrated by high railroad shipping rates, and felt ignored by the major political parties.", "Southern planters wanted to expand slavery into the West."], answer: 2, hint: "The movement was rooted in the economic struggles of the agricultural working class.", dok: 4 }
            ],
            unit3: [
                { question: "Analyze the role of 'yellow journalism' in the outbreak of the Spanish-American War.", choices: ["It provided objective, balanced reporting that calmed public tensions.", "It deliberately sensationalized events like the sinking of the USS Maine to inflame public anger and push the government toward war.", "It focused entirely on domestic issues, ignoring the conflict in Cuba.", "It was a Spanish propaganda tool used to intimidate Americans."], answer: 1, hint: "Publishers like Hearst and Pulitzer used dramatic headlines to sell papers.", dok: 4 },
                { question: "Evaluate the strategic importance of the Panama Canal to American imperialism.", choices: ["It was built primarily as a tourist attraction.", "It vastly improved global trade efficiency and allowed the U.S. Navy to move quickly between oceans, projecting power globally.", "It was designed to protect Central America from European invasion.", "It severely damaged the U.S. economy due to construction costs."], answer: 1, hint: "Think about Theodore Roosevelt's 'Big Stick' diplomacy.", dok: 3 },
                { question: "Explain how the Zimmermann Telegram influenced the United States' entry into World War I.", choices: ["It was a plea for peace from the German government.", "It revealed a German plot to ally with Mexico and attack the U.S., shattering American neutrality.", "It proved that the British were illegally sinking American ships.", "It contained the designs for a new, devastating weapon."], answer: 1, hint: "It brought the threat of the European war directly to the American border.", dok: 3 },
                { question: "Analyze the purpose of the Espionage and Sedition Acts during World War I.", choices: ["To protect the free speech rights of anti-war protestors.", "To recruit more soldiers into the military.", "To silence dissent, prevent interference with the draft, and suppress criticism of the government's war effort.", "To expose German spies operating in Washington D.C."], answer: 2, hint: "The government argued that civil liberties could be restricted during wartime.", dok: 4 },
                { question: "Evaluate the reasons for the U.S. Senate's rejection of the Treaty of Versailles and the League of Nations.", choices: ["They believed the treaty was far too lenient on Germany.", "They feared that joining the League would surrender U.S. sovereignty and drag the nation into future European conflicts.", "President Wilson refused to sign the final document.", "The treaty did not grant the U.S. enough new territory."], answer: 1, hint: "Many senators wanted a return to the policy of isolationism.", dok: 4 }
            ],
            unit4: [
                { question: "Analyze the unintended consequences of the 18th Amendment (Prohibition).", choices: ["It successfully eliminated all alcohol consumption in the U.S.", "It led to a massive rise in organized crime, bootlegging, and a general disrespect for the law.", "It caused the immediate start of the Great Depression.", "It forced the closure of all movie theaters and jazz clubs."], answer: 1, hint: "Banning a popular product created a lucrative black market.", dok: 3 },
                { question: "Explain how the practice of 'buying on margin' contributed to the 1929 stock market crash.", choices: ["It meant the government heavily insured all stock purchases.", "It allowed investors to buy stocks with borrowed money, creating an artificial bubble that burst when prices dropped and loans were called in.", "It prevented ordinary citizens from investing in the market.", "It required buyers to use only gold to purchase stocks."], answer: 1, hint: "When the market dipped, people had to sell off everything to pay back their brokers.", dok: 4 },
                { question: "Evaluate the fundamental shift in the role of the federal government caused by the New Deal.", choices: ["The government withdrew completely from economic regulation.", "The government assumed unprecedented responsibility for the economic welfare of its citizens and the regulation of business.", "The government abolished the capitalist system entirely.", "The government focused solely on foreign policy and ignored domestic issues."], answer: 1, hint: "Programs like Social Security created a permanent 'safety net'.", dok: 4 },
                { question: "Analyze how human actions contributed to the environmental disaster of the Dust Bowl.", choices: ["Decades of deep plowing and over-farming removed the native grasses that held the soil in place, leaving it vulnerable to drought and wind.", "The construction of massive dams disrupted the natural water cycle of the plains.", "Excessive pollution from new urban factories poisoned the soil.", "The introduction of invasive species destroyed the local crops."], answer: 0, hint: "Farmers ignored traditional ecological balances in the pursuit of higher yields.", dok: 3 },
                { question: "Synthesize the political appeal of Huey Long in 1930s Louisiana.", choices: ["He appealed only to the wealthy elite and powerful corporations.", "He used populist rhetoric and his 'Share Our Wealth' program to appeal to the desperate, impoverished working class during the Depression.", "He promised to completely dismantle the state's infrastructure.", "He advocated for a return to the policies of the Gilded Age."], answer: 1, hint: "He promised to 'make every man a king' by heavily taxing the rich.", dok: 4 }
            ]
        }
    },
    SKIBIDI: {
        grade6: {
            unit1: [
                { question: "The first permanent English settlement in North America, founded in 1607, was ___.", answer: ["jamestown", "james town"], hint: "It is located in Virginia." },
                { question: "The Native American who helped the Pilgrims survive by teaching them to farm was ___.", answer: ["squanto", "tisquantum"], hint: "He spoke English and helped them use fish as fertilizer." },
                { question: "The agreement for self-government signed by the Pilgrims was the ___ Compact.", answer: ["mayflower"], hint: "Named after their ship." },
                { question: "The religious group that wanted to completely separate from the Church of England and founded Plymouth were the ___.", answer: ["pilgrims", "separatists"], hint: "They celebrated the first Thanksgiving." },
                { question: "The 1676 uprising of poor farmers in Virginia was known as ___ Rebellion.", answer: ["bacons", "bacon"], hint: "Led by a man named Nathaniel." }
            ],
            unit2: [
                { question: "The horrific journey of enslaved Africans across the Atlantic was called the ___ Passage.", answer: ["middle"], hint: "It was the center leg of the Triangular Trade." },
                { question: "William Penn founded Pennsylvania as a safe haven for a religious group known as the ___.", answer: ["quakers"], hint: "They believed in pacifism and equality." },
                { question: "Large agricultural estates in the South that relied on enslaved labor were called ___.", answer: ["plantations", "plantation"], hint: "They grew cash crops." },
                { question: "People who worked for a set number of years in exchange for passage to America were ___ servants.", answer: ["indentured"], hint: "They signed a temporary contract." },
                { question: "The region known for rocky soil, shipbuilding, and fishing was the ___ Colonies.", answer: ["new england"], hint: "It includes Massachusetts and Rhode Island." }
            ],
            unit3: [
                { question: "The 'Father of Louisiana' who founded New Orleans in 1718 is Jean-Baptiste Le Moyne de ___.", answer: ["bienville"], hint: "He was the brother of Iberville." },
                { question: "The set of laws governing the lives of enslaved people in French Louisiana was the Code ___.", answer: ["noir"], hint: "It means 'Black' in French." },
                { question: "The oldest permanent European settlement in Louisiana is ___.", answer: ["natchitoches"], hint: "It was founded in 1714." },
                { question: "The exiles from Canada who settled in Louisiana and developed a unique culture are the ___.", answer: ["acadians", "cajuns"], hint: "They were kicked out of Nova Scotia by the British." },
                { question: "The Spanish governor who crushed the 1768 rebellion earned the nickname 'Bloody' ___.", answer: ["oreilly", "o'reilly", "alejandro o'reilly"], hint: "He executed the leaders of the revolt." }
            ],
            unit4: [
                { question: "The war fought between Britain and France for control of North America was the ___ War.", answer: ["french and indian", "seven years"], hint: "It started in 1754." },
                { question: "The author of the Declaration of Independence was Thomas ___.", answer: ["jefferson"], hint: "He later became the 3rd President." },
                { question: "The first battles of the American Revolution were fought at Lexington and ___.", answer: ["concord"], hint: "It was the 'Shot Heard 'Round the World'." },
                { question: "The turning point battle that convinced France to ally with the Americans was the Battle of ___.", answer: ["saratoga"], hint: "It took place in New York." },
                { question: "The British general Cornwallis surrendered, effectively ending the war, at the Battle of ___.", answer: ["yorktown"], hint: "He was trapped on a peninsula in Virginia." }
            ]
        },
        grade7: {
            unit1: [
                { question: "The first President of the United States was George ___.", answer: ["washington"], hint: "He set the precedent of a two-term limit." },
                { question: "The leader of the Federalist Party and first Secretary of the Treasury was Alexander ___.", answer: ["hamilton"], hint: "He pushed for a National Bank." },
                { question: "The 1794 uprising of farmers protesting a federal tax was the ___ Rebellion.", answer: ["whiskey", "whiskeys"], hint: "Washington led troops to stop it." },
                { question: "The controversial laws passed by John Adams that limited free speech were the Alien and ___ Acts.", answer: ["sedition"], hint: "They targeted immigrants and government critics." },
                { question: "The diplomatic incident where French agents demanded a bribe from the U.S. was the ___ Affair.", answer: ["xyz"], hint: "It involved three unnamed agents." }
            ],
            unit2: [
                { question: "The land deal that doubled the size of the United States in 1803 was the ___ Purchase.", answer: ["louisiana"], hint: "Thomas Jefferson bought it from France." },
                { question: "The explorers sent by Jefferson to map the new western territory were ___ and Clark.", answer: ["lewis"], hint: "They were guided by Sacagawea." },
                { question: "The British practice of forcing American sailors into their navy is called ___.", answer: ["impressment"], hint: "It was a major cause of the War of 1812." },
                { question: "The national anthem, 'The Star-Spangled Banner,' was written by Francis Scott ___.", answer: ["key"], hint: "He watched the bombing of Fort McHenry." },
                { question: "The American general who became a hero at the Battle of New Orleans was Andrew ___.", answer: ["jackson"], hint: "He later became the 7th President." }
            ],
            unit3: [
                { question: "The belief that the U.S. was destined to expand to the Pacific Ocean is Manifest ___.", answer: ["destiny"], hint: "It means 'obvious fate'." },
                { question: "The forced removal of the Cherokee people to Indian Territory is known as the Trail of ___.", answer: ["tears"], hint: "Thousands died on this tragic journey." },
                { question: "The policy warning European nations to stay out of the Americas is the ___ Doctrine.", answer: ["monroe"], hint: "Issued in 1823." },
                { question: "The invention by Eli Whitney that vastly increased the demand for slavery was the ___ gin.", answer: ["cotton"], hint: "It separated seeds from fibers." },
                { question: "The man-made waterway connecting the Great Lakes to New York City is the ___ Canal.", answer: ["erie"], hint: "It revolutionized shipping." }
            ],
            unit4: [
                { question: "The first women's rights convention was held in 1848 at ___ Falls, New York.", answer: ["seneca"], hint: "They wrote the Declaration of Sentiments." },
                { question: "The famous conductor of the Underground Railroad was Harriet ___.", answer: ["tubman"], hint: "She was known as 'Moses'." },
                { question: "The author of the influential anti-slavery novel 'Uncle Tom's Cabin' was Harriet Beecher ___.", answer: ["stowe"], hint: "Her book angered the South." },
                { question: "The reformer who worked to improve prisons and mental asylums was Dorothea ___.", answer: ["dix"], hint: "She investigated terrible conditions in jails." },
                { question: "The Supreme Court case that ruled enslaved people were property, not citizens, was the ___ Scott decision.", answer: ["dred"], hint: "He sued for his freedom after living in free territory." }
            ]
        },
        grade8: {
            unit1: [
                { question: "African Americans who migrated to Kansas to escape the Jim Crow South were called ___.", answer: ["exodusters"], hint: "Their name references a biblical journey." },
                { question: "The 1876 battle known as 'Custer's Last Stand' was the Battle of Little ___.", answer: ["bighorn", "big horn"], hint: "A major victory for the Plains Indians." },
                { question: "The system of laws enforcing racial segregation in the South was called ___ Crow.", answer: ["jim"], hint: "Named after a minstrel show character." },
                { question: "The civil rights leader who co-founded the NAACP and demanded immediate equality was W.E.B. ___.", answer: ["dubois", "du bois"], hint: "He opposed Booker T. Washington's gradual approach." },
                { question: "The 1896 Supreme Court case that legalized 'separate but equal' segregation was Plessy v. ___.", answer: ["ferguson"], hint: "It upheld a Louisiana train car law." }
            ],
            unit2: [
                { question: "A company that has complete control over an entire industry is a ___.", answer: ["monopoly"], hint: "Standard Oil is a famous example." },
                { question: "Journalists who exposed corruption and social problems were known as ___.", answer: ["muckrakers", "muckraker"], hint: "Upton Sinclair was one." },
                { question: "The industrialist who built a monopoly in the American steel industry was Andrew ___.", answer: ["carnegie"], hint: "He used the Bessemer process." },
                { question: "The industrialist who created the Standard Oil trust was John D. ___.", answer: ["rockefeller"], hint: "He used horizontal integration." },
                { question: "The political party formed by farmers to fight big business was the ___ Party.", answer: ["populist", "peoples", "people's"], hint: "They wanted the free coinage of silver." }
            ],
            unit3: [
                { question: "The man-made waterway built to connect the Atlantic and Pacific oceans is the ___ Canal.", answer: ["panama"], hint: "Theodore Roosevelt championed its construction." },
                { question: "The 1898 conflict that made the U.S. a world power was the ___-American War.", answer: ["spanish"], hint: "Remember the Maine!" },
                { question: "The British passenger ship sunk by a German U-boat in 1915 was the ___.", answer: ["lusitania"], hint: "128 Americans died." },
                { question: "The secret message proposing an alliance between Germany and Mexico was the ___ Telegram.", answer: ["zimmermann", "zimmerman"], hint: "It pushed the U.S. into WWI." },
                { question: "The primary style of fighting on the Western Front in WWI was ___ warfare.", answer: ["trench"], hint: "Soldiers dug deep defensive networks." }
            ],
            unit4: [
                { question: "The era in which the manufacture and sale of alcohol was illegal was known as ___.", answer: ["prohibition"], hint: "It was established by the 18th Amendment." },
                { question: "The 1920s cultural movement celebrating African American art and music was the ___ Renaissance.", answer: ["harlem"], hint: "Located in a New York City neighborhood." },
                { question: "The severe environmental disaster of the 1930s on the Great Plains was the ___ Bowl.", answer: ["dust"], hint: "Caused by drought and over-farming." },
                { question: "President Franklin D. Roosevelt's program to combat the Great Depression was the New ___.", answer: ["deal"], hint: "It included Relief, Recovery, and Reform." },
                { question: "The populist Louisiana governor known for his 'Share Our Wealth' program was Huey ___.", answer: ["long"], hint: "His nickname was 'The Kingfish'." }
            ]
        }
    },
    MYTH: {
        grade6: {
            unit1: [
                { question: "MYTH or FACT: Christopher Columbus was the first European to reach North America.", isFact: false, explanation: "MYTH: Viking explorers, such as Leif Erikson, established settlements in North America nearly 500 years before Columbus sailed." },
                { question: "MYTH or FACT: The Pilgrims always wore black and white clothing with large buckles.", isFact: false, explanation: "MYTH: This is a 19th-century invention. Historical records show Pilgrims wore a variety of typical English colors like red, green, and brown." },
                { question: "MYTH or FACT: The House of Burgesses was the first representative assembly in the American colonies.", isFact: true, explanation: "FACT: Established in Jamestown in 1619, it allowed colonists to elect representatives, setting a crucial precedent for American democracy." },
                { question: "MYTH or FACT: Native American tribes had no concept of land use or territories before Europeans arrived.", isFact: false, explanation: "MYTH: While they did not buy and sell land as private property like Europeans, tribes had strict territorial boundaries and complex systems for hunting and farming rights." },
                { question: "MYTH or FACT: The Puritans established Massachusetts to create a society with total religious freedom for everyone.", isFact: false, explanation: "MYTH: The Puritans wanted freedom for *themselves*, but they were highly intolerant of other beliefs, famously banishing dissenters like Roger Williams and Anne Hutchinson." }
            ],
            unit2: [
                { question: "MYTH or FACT: Slavery existed in all 13 American colonies during the colonial period.", isFact: true, explanation: "FACT: While plantation slavery was most economically dominant in the Southern colonies, enslaved people were held and exploited in the Northern and Middle colonies as well." },
                { question: "MYTH or FACT: Indentured servants were legally considered slaves for the rest of their lives.", isFact: false, explanation: "MYTH: Indentured servants signed a contract to work for a specific period (usually 4 to 7 years) to pay off their travel debt, after which they were legally free." },
                { question: "MYTH or FACT: The Middle Colonies were the most culturally and religiously diverse region.", isFact: true, explanation: "FACT: Because colonies like Pennsylvania promoted religious tolerance, they attracted a wide variety of immigrants, including Germans, Dutch, and Scots-Irish." },
                { question: "MYTH or FACT: The New England colonies relied heavily on massive tobacco plantations.", isFact: false, explanation: "MYTH: New England's rocky soil and harsh winters made large-scale agriculture impossible. Their economy relied on fishing, whaling, shipbuilding, and trade." },
                { question: "MYTH or FACT: The Quakers believed in pacifism and the spiritual equality of all people.", isFact: true, explanation: "FACT: Because of their belief in the 'inner light' in everyone, Quakers were early advocates for fair treatment of Native Americans and the abolition of slavery." }
            ],
            unit3: [
                { question: "MYTH or FACT: New Orleans has always been the capital city of Louisiana.", isFact: false, explanation: "MYTH: The capital moved several times in the early years. Mobile and Biloxi both served as the capital before it was finally moved to New Orleans in 1722." },
                { question: "MYTH or FACT: The Acadians were exiled directly from France to Louisiana.", isFact: false, explanation: "MYTH: The Acadians were expelled from Acadia (modern-day Nova Scotia, Canada) by the British. After years of wandering, many found refuge in French/Spanish Louisiana." },
                { question: "MYTH or FACT: The French Code Noir granted enslaved people full rights as citizens.", isFact: false, explanation: "MYTH: The Code Noir was a harsh set of laws designed to control the enslaved population, though it did mandate Catholic instruction and forbid working on Sundays." },
                { question: "MYTH or FACT: Natchitoches is the oldest permanent European settlement in the Louisiana Purchase territory.", isFact: true, explanation: "FACT: Founded by the French in 1714 as a trade outpost, Natchitoches predates the founding of New Orleans by four years." },
                { question: "MYTH or FACT: France sold the Louisiana territory to Spain for a massive profit in 1762.", isFact: false, explanation: "MYTH: France gave Louisiana to Spain in the secret Treaty of Fontainebleau to prevent the British from taking it as a prize at the end of the French and Indian War." }
            ],
            unit4: [
                { question: "MYTH or FACT: The Declaration of Independence was fully signed by all delegates on July 4, 1776.", isFact: false, explanation: "MYTH: While the final wording was approved on July 4th, the actual signing ceremony did not begin until August 2nd." },
                { question: "MYTH or FACT: During his midnight ride, Paul Revere shouted, 'The British are coming!'", isFact: false, explanation: "MYTH: He likely shouted, 'The Regulars are coming out!' Shouting 'The British' would have made no sense, as the colonists still considered themselves British citizens." },
                { question: "MYTH or FACT: Every American colonist fiercely supported the war for independence.", isFact: false, explanation: "MYTH: The colonies were deeply divided. Historians estimate that roughly one-third were Patriots, one-third were Loyalists, and one-third remained neutral." },
                { question: "MYTH or FACT: The American colonists won the Revolutionary War entirely on their own.", isFact: false, explanation: "MYTH: Without massive financial, military, and naval support from European allies‚Äîespecially France, but also Spain and the Netherlands‚Äîthe Americans likely would have lost." },
                { question: "MYTH or FACT: The Proclamation of 1763 banned colonists from settling west of the Appalachian Mountains.", isFact: true, explanation: "FACT: King George III issued this proclamation to prevent costly conflicts with Native American tribes, which deeply angered colonists who felt they had fought for that land." }
            ]
        },
        grade7: {
            unit1: [
                { question: "MYTH or FACT: George Washington chopped down his father's cherry tree and confessed to it.", isFact: false, explanation: "MYTH: This famous story was completely invented by an early biographer, Parson Weems, to illustrate Washington's honesty. There is no historical evidence it happened." },
                { question: "MYTH or FACT: The Whiskey Rebellion proved the new federal government was weak and powerless.", isFact: false, explanation: "MYTH: It proved the exact opposite. By raising an army to crush the rebellion, Washington proved the new Constitutional government could enforce its laws, unlike the Articles of Confederation." },
                { question: "MYTH or FACT: Alexander Hamilton and Thomas Jefferson's disagreements led to the creation of the first political parties.", isFact: true, explanation: "FACT: Their intense conflicts over the National Bank, the economy, and federal power directly resulted in the formation of the Federalist and Democratic-Republican parties." },
                { question: "MYTH or FACT: The Alien and Sedition Acts were created to expand free speech rights.", isFact: false, explanation: "MYTH: They severely restricted free speech, allowing the government to jail newspaper editors and politicians who criticized President John Adams and the Federalist party." },
                { question: "MYTH or FACT: The Supreme Court case Marbury v. Madison established the power of judicial review.", isFact: true, explanation: "FACT: This landmark case established the Supreme Court's authority to declare laws or executive actions unconstitutional, cementing its role as a co-equal branch of government." }
            ],
            unit2: [
                { question: "MYTH or FACT: Thomas Jefferson fought a war with France to conquer the Louisiana Territory.", isFact: false, explanation: "MYTH: He purchased it peacefully. Napoleon Bonaparte, needing funds for his wars in Europe, sold the massive territory to the U.S. for $15 million in 1803." },
                { question: "MYTH or FACT: The Lewis and Clark expedition discovered a direct, all-water route to the Pacific Ocean.", isFact: false, explanation: "MYTH: While they successfully mapped the region and reached the ocean, they proved that a 'Northwest Passage' (a continuous water route) did not exist across the continent." },
                { question: "MYTH or FACT: The United States decisively won the War of 1812 and took over Canada.", isFact: false, explanation: "MYTH: The war was largely a military stalemate. The Treaty of Ghent restored all pre-war borders, though the U.S. did gain a surge of national pride and international respect." },
                { question: "MYTH or FACT: The Battle of New Orleans was fought after the peace treaty ending the war had already been signed.", isFact: true, explanation: "FACT: The Treaty of Ghent was signed in Europe weeks before the battle, but news traveled slowly across the Atlantic by ship, so the armies in Louisiana didn't know the war was over." },
                { question: "MYTH or FACT: The 'Era of Good Feelings' was a period of intense political fighting and civil war.", isFact: false, explanation: "MYTH: It was a period following the War of 1812 characterized by strong national unity and the temporary collapse of the two-party system, leaving only the Democratic-Republicans." }
            ],
            unit3: [
                { question: "MYTH or FACT: Manifest Destiny was an official law passed by Congress to force expansion.", isFact: false, explanation: "MYTH: It was not a law, but a widely held cultural belief that Americans were divinely ordained by God to settle the entire North American continent." },
                { question: "MYTH or FACT: The Trail of Tears was a voluntary migration by Native Americans seeking better land.", isFact: false, explanation: "MYTH: It was a brutal, forced relocation enacted by the U.S. government under the Indian Removal Act, resulting in the deaths of thousands of indigenous people." },
                { question: "MYTH or FACT: The invention of the cotton gin led to a decrease in the use of enslaved labor.", isFact: false, explanation: "MYTH: The cotton gin made processing cotton so incredibly profitable that plantation owners rapidly expanded their operations, drastically increasing the demand for enslaved labor." },
                { question: "MYTH or FACT: The Monroe Doctrine warned European nations against interfering in the Western Hemisphere.", isFact: true, explanation: "FACT: Issued in 1823, it declared that the Americas were off-limits to further European colonization and that the U.S. would view any interference as a hostile act." },
                { question: "MYTH or FACT: The Industrial Revolution in the U.S. began primarily in the Southern states.", isFact: false, explanation: "MYTH: It began in the North, specifically New England, where fast-moving rivers powered textile mills. The South remained heavily focused on agrarian plantation farming." }
            ],
            unit4: [
                { question: "MYTH or FACT: The Underground Railroad was a literal train system running under the soil.", isFact: false, explanation: "MYTH: It was a metaphor. It was actually a highly organized, secret network of safe houses, guides (conductors), and routes used to help enslaved people escape to freedom." },
                { question: "MYTH or FACT: The Seneca Falls Convention of 1848 immediately granted women the right to vote.", isFact: false, explanation: "MYTH: It was the launching point of the movement. Women would not secure the national right to vote until the 19th Amendment was ratified 72 years later." },
                { question: "MYTH or FACT: The Dred Scott Supreme Court decision ruled that enslaved people were property, not citizens.", isFact: true, explanation: "FACT: The 1857 ruling was a massive blow to the abolitionist movement, declaring that Black Americans had no constitutional rights and that Congress couldn't ban slavery in the territories." },
                { question: "MYTH or FACT: The Fugitive Slave Act of 1850 allowed accused runaways to testify in front of a jury.", isFact: false, explanation: "MYTH: Accused individuals were denied the right to a jury trial and could not testify. Furthermore, commissioners were paid more money to return a person to slavery than to set them free." },
                { question: "MYTH or FACT: Most people in the Northern states before the Civil War were radical abolitionists.", isFact: false, explanation: "MYTH: Radical abolitionists who wanted to end slavery immediately were a minority. Most Northerners were either indifferent or simply wanted to stop the *expansion* of slavery into new territories." }
            ]
        },
        grade8: {
            unit1: [
                { question: "MYTH or FACT: The 'Wild West' was a chaotic place where gunfights happened in the streets every day.", isFact: false, explanation: "MYTH: While violence occurred, most frontier towns strictly enforced gun control laws to maintain order. The Hollywood image of daily 'high noon' shootouts is highly exaggerated." },
                { question: "MYTH or FACT: The 'Exodusters' were African Americans who migrated to Kansas to escape the Jim Crow South.", isFact: true, explanation: "FACT: In the late 1870s, thousands of African Americans fled the violence and economic oppression of the post-Reconstruction South to seek land and freedom on the plains." },
                { question: "MYTH or FACT: The Supreme Court's ruling in Plessy v. Ferguson ensured that segregated facilities were truly equal.", isFact: false, explanation: "MYTH: The 'separate but equal' doctrine provided legal cover for systemic racism. In reality, facilities for Black Americans were almost universally underfunded and inferior." },
                { question: "MYTH or FACT: Booker T. Washington and W.E.B. Du Bois agreed entirely on the strategy for achieving civil rights.", isFact: false, explanation: "MYTH: They deeply disagreed. Washington advocated for gradual economic self-reliance (the 'Atlanta Compromise'), while Du Bois demanded immediate political equality and founded the NAACP." },
                { question: "MYTH or FACT: The U.S. government actively encouraged the slaughter of the American buffalo.", isFact: true, explanation: "FACT: Officials recognized that the Plains Indians depended entirely on the buffalo. Exterminating the herds was a calculated strategy to force tribes onto reservations." }
            ],
            unit2: [
                { question: "MYTH or FACT: Laissez-faire government policies helped prevent the rise of corporate monopolies.", isFact: false, explanation: "MYTH: 'Laissez-faire' means 'hands off'. Because the government refused to regulate businesses, powerful industrialists were able to ruthlessly crush competition and form massive monopolies." },
                { question: "MYTH or FACT: Muckraking journalists played a major role in exposing corruption and bringing about Progressive reforms.", isFact: true, explanation: "FACT: Investigative writers like Upton Sinclair and Ida Tarbell shocked the public with their findings, leading directly to laws like the Meat Inspection Act and anti-trust enforcement." },
                { question: "MYTH or FACT: Immigrants arriving in the late 1800s easily found safe, high-paying jobs in factories.", isFact: false, explanation: "MYTH: Most immigrants faced brutal working conditions, extremely long hours, low wages, and dangerous environments. Child labor was also rampant due to deep poverty." },
                { question: "MYTH or FACT: Horizontal integration involves buying out all competing companies in the same industry.", isFact: true, explanation: "FACT: This strategy, famously used by John D. Rockefeller's Standard Oil, allows a company to eliminate competition and control the market price of a product." },
                { question: "MYTH or FACT: The Populist Party was formed by wealthy bankers to protect their profits.", isFact: false, explanation: "MYTH: The Populist (or People's) Party was a grassroots movement formed by desperate farmers and laborers fighting against the power of banks, railroads, and big business." }
            ],
            unit3: [
                { question: "MYTH or FACT: The United States joined the League of Nations to help prevent future global wars.", isFact: false, explanation: "MYTH: Despite President Woodrow Wilson being the chief architect of the League, the U.S. Senate refused to ratify the treaty, fearing it would drag the country into foreign conflicts." },
                { question: "MYTH or FACT: 'Yellow Journalism' played a major role in pushing the U.S. into the Spanish-American War.", isFact: true, explanation: "FACT: Newspaper publishers sensationalized stories, particularly the explosion of the USS Maine, to inflame public anger and boost sales, highly influencing the push for war." },
                { question: "MYTH or FACT: The Zimmermann Telegram was a German proposal of alliance to Mexico against the U.S.", isFact: true, explanation: "FACT: Germany promised to help Mexico recover lost territory (like Texas) if they attacked the U.S. Its interception and publication outraged the American public." },
                { question: "MYTH or FACT: The 19th Amendment guaranteeing women the right to vote was passed without any opposition.", isFact: false, explanation: "MYTH: The suffrage movement fought a grueling, decades-long battle. Activists faced public mockery, arrest, physical violence, and force-feeding in prison before winning the vote in 1920." },
                { question: "MYTH or FACT: Trench warfare on the Western Front led to quick, decisive military victories in WWI.", isFact: false, explanation: "MYTH: Trench warfare resulted in a brutal, years-long stalemate. The defensive advantage of machine guns and barbed wire made advancing across 'No Man's Land' nearly impossible and deadly." }
            ],
            unit4: [
                { question: "MYTH or FACT: Prohibition successfully stopped all alcohol consumption in the United States.", isFact: false, explanation: "MYTH: While legal sales stopped, it fueled a massive black market. People drank in illegal 'speakeasies,' and it led to the rapid rise of violent organized crime syndicates." },
                { question: "MYTH or FACT: Buying stocks 'on margin' was a safe, risk-free way to invest in the 1920s.", isFact: false, explanation: "MYTH: It was incredibly reckless. Buying on margin meant borrowing money to buy stocks. When the market crashed, investors lost everything and couldn't repay their massive loans." },
                { question: "MYTH or FACT: The Dust Bowl was an environmental disaster worsened by poor farming practices.", isFact: true, explanation: "FACT: While a severe drought was the trigger, decades of deep plowing had destroyed the native prairie grasses. Without roots to hold the soil, the wind blew it away in massive dust storms." },
                { question: "MYTH or FACT: The New Deal ended the Great Depression immediately within its first year.", isFact: false, explanation: "MYTH: While the New Deal provided vital relief and reformed the banking system, unemployment remained high for years. The massive industrial production required for WWII ultimately ended the Depression." },
                { question: "MYTH or FACT: Huey Long was a popular Louisiana politician because he advocated for heavily taxing the rich.", isFact: true, explanation: "FACT: His populist 'Share Our Wealth' program appealed strongly to poor and working-class citizens during the Depression by promising to redistribute wealth from corporations and the elite." }
            ]
        }
    }
};

        // --- SOUND ENGINE ---
        const filter = new Tone.Filter(400, "lowpass").toDestination();
        const filterEnv = new Tone.FrequencyEnvelope({
            attack: 0.01,
            decay: 0.1,
            sustain: 0,
            release: 0.1,
            baseFrequency: 200,
            octaves: 2
        });
        filterEnv.connect(filter.frequency);
        const synth = new Tone.PolySynth(Tone.Synth).toDestination();
        const pluckSynth = new Tone.PluckSynth().connect(filter);

        function playCorrectSound() {
            if (isMuted) return;
            const now = Tone.now();
            synth.triggerAttackRelease("C4", "8n", now);
            synth.triggerAttackRelease("E4", "8n", now + 0.1);
            synth.triggerAttackRelease("G4", "8n", now + 0.2);
            synth.triggerAttackRelease("C5", "8n", now + 0.3);
        }
        function playIncorrectSound() { if (isMuted) return;
            const now = Tone.now();
            synth.triggerAttackRelease("C2", "8n", now);
        }
        function playClickSound() { if (isMuted) return;
            pluckSynth.triggerAttack("C4", Tone.now());
            filterEnv.triggerAttack();
        }
        function playPurchaseSound() { if (isMuted) return;
            const now = Tone.now();
            synth.triggerAttackRelease("E5", "16n", now);
            synth.triggerAttackRelease("G5", "16n", now + 0.1);
        }
        function playStartSound() { if (isMuted) return;
            const now = Tone.now();
            synth.triggerAttackRelease("G3", "8n", now);
            synth.triggerAttackRelease("C4", "8n", now + 0.1);
        }
        function playStreakSound() { if (isMuted) return;
            const now = Tone.now();
            synth.triggerAttackRelease("G4", "8n", now);
            synth.triggerAttackRelease("C5", "8n", now + 0.1);
            synth.triggerAttackRelease("E5", "4n", now + 0.2);
        }
        function playPantherBuckSound() {
            const now = Tone.now();
            if (!isMuted) synth.triggerAttackRelease("A5", "8n", now);
        }

        // --- GAME STATE ---
        let playerState = {};
        let timerInterval = null;
        let timeLeft = 300;
        let storeNotificationInterval = null;
        let currentQuestionIndex = -1;
        let questionsCopy = [];
        let activeQuestionSet = [];
        let wrongAnswers = [];
        let permanentWrongAnswers = [];
        let abilities = {};
        let notificationQueue = [];
        let isModalActive = false;
        let isGamePaused = false;
        let notificationTimer = null;
        let isMuted = false;
        let lastNotificationMessage = '';
        let reviewIndex = 0;
        let gameMode = 'EASY';
        let sigmaStage = 1;
        let sigmaCorrectInStage = 0;
        let timeHistory = [];
        const correctMessages = [
            "Excellent!",
            "Great job!",
            "You're on fire!",
            "That's right!",
            "Keep it up!",
            "Awesome!",
            "Correct! You've got this.",
            "Nice one!",
            "Brilliant!",
            "You're a history whiz!"
        ];

        // --- DOM ELEMENTS ---
        const bodyEl = document.body;
        const timerEl = document.getElementById('timer');
        const timeCardEl = document.getElementById('timeCard');
        const scoreEl = document.getElementById('score');
        const streakEl = document.getElementById('streak');
        const correctAnswersEl = document.getElementById('correctAnswers');
        const gameAreaEl = document.getElementById('gameArea');
        const questionTextEl = document.getElementById('questionText');
        const answerChoices = document.querySelectorAll('.answer-choice');
        const headerGridEl = document.getElementById('headerGrid');

        // Modals
        const difficultyModal = document.getElementById('difficultyModal');
        const gradeModal = document.getElementById('gradeModal');
        const endGameModal = document.getElementById('endGameModal');
        const reviewModal = document.getElementById('reviewModal');
        const easyRulesModal = document.getElementById('easyRulesModal');
        const hardRulesModal = document.getElementById('hardRulesModal');
        const mythRulesModal = document.getElementById('mythRulesModal');
        const skibidiRulesModal = document.getElementById('skibidiRulesModal');
        const aboutModal = document.getElementById('aboutModal');
        const resetConfirmModal = document.getElementById('resetConfirmModal');
        const hintModal = document.getElementById('hintModal');
        const settingsModal = document.getElementById('settingsModal');
        const streakModal = document.getElementById('streakModal');
        const streakTextEl = document.getElementById('streakText');
        const abilityInfoModal = document.getElementById('abilityInfoModal');
        const pantherBuckModal = document.getElementById('pantherBuckModal');
        const storeModal = document.getElementById('storeModal');
        const hunchUpgradeStoreItem = document.getElementById('hunchUpgradeStoreItem');
        const sigmaRulesModal = document.getElementById('sigmaRulesModal');
        const skibidiIncorrectModal = document.getElementById('skibidiIncorrectModal');
        const firstLetterModal = document.getElementById('firstLetterModal');

        const explanationModal = document.getElementById('explanationModal');
        const explanationTextEl = document.getElementById('explanationText');
        const sigmaStageUpModal = document.getElementById('sigmaStageUpModal');
        const dokLabel = document.getElementById('dokLabel');
        const closeSigmaStageUpBtn = document.getElementById('closeSigmaStageUpBtn');
        // Sigma Mode UI
        const sigmaProgressContainer = document.getElementById('sigmaProgressContainer');
        const sigmaProgressBar = document.getElementById('sigmaProgressBar');
        const sigmaProgressText = document.getElementById('sigmaProgressText');
        const sigmaStageDisplay = document.getElementById('sigmaStageDisplay');


        // Buttons
        const easyModeBtn = document.getElementById('easyModeBtn');
        const hardModeBtn = document.getElementById('hardModeBtn');
        const skibidiModeBtn = document.getElementById('skibidiModeBtn');
        const acceptEasyBtn = document.getElementById('acceptEasyBtn');
        const declineEasyBtn = document.getElementById('declineEasyBtn');
        const acceptHardBtn = document.getElementById('acceptHardBtn');
        const declineHardBtn = document.getElementById('declineHardBtn');
        const acceptSkibidiBtn = document.getElementById('acceptSkibidiBtn');
        const declineSkibidiBtn = document.getElementById('declineSkibidiBtn');
        const mythModeBtn = document.getElementById('mythModeBtn');
        const acceptMythBtn = document.getElementById('acceptMythBtn');
        const declineMythBtn = document.getElementById('declineMythBtn');
        const sigmaModeBtn = document.getElementById('sigmaModeBtn');
        const acceptSigmaBtn = document.getElementById('acceptSigmaBtn');
        const declineSigmaBtn = document.getElementById('declineSigmaBtn');
        const backToDifficultyBtn = document.getElementById('backToDifficultyBtn');
        const gradeLevelSelect = document.getElementById('gradeLevelSelect');
        const startGameBtn = document.getElementById('startGameBtn');
        const newGameBtn = document.getElementById('newGameBtn');
        const storeBtn = document.getElementById('storeBtn');
        const reviewMistakesBtn = document.getElementById('reviewMistakesBtn');
        const closeReviewBtn = document.getElementById('closeReviewBtn');
        const nextReviewBtn = document.getElementById('nextReviewBtn');
        const prevReviewBtn = document.getElementById('prevReviewBtn');
        const endTurnBtn = document.getElementById('endTurnBtn');
        const resetAllBtn = document.getElementById('resetAllBtn');
        const aboutBtn = document.getElementById('aboutBtn');
        const hintBtn = document.getElementById('hintBtn');
        const closeAboutBtn = document.getElementById('closeAboutBtn');
        const settingsBtn = document.getElementById('settingsBtn');
        const closeSettingsBtn = document.getElementById('closeSettingsBtn');
        const soundToggle = document.getElementById('soundToggle');
        const confirmResetBtn = document.getElementById('confirmResetBtn');
        const cancelResetBtn = document.getElementById('cancelResetBtn');
        const closeHintBtn = document.getElementById('closeHintBtn');
        const closeStreakBtn = document.getElementById('closeStreakBtn');
        const closeAbilityInfoBtn = document.getElementById('closeAbilityInfoBtn');
        const closePantherBuckBtn = document.getElementById('closePantherBuckBtn');
        const closeStoreBtn = document.getElementById('closeStoreBtn');
        const buyBtns = document.querySelectorAll('.buy-btn');
        const closeSkibidiIncorrectBtn = document.getElementById('closeSkibidiIncorrectBtn');
        const closeExplanationBtn = document.getElementById('closeExplanationBtn');
        const firstLetterBtn = document.getElementById('firstLetterBtn');
        const closeFirstLetterBtn = document.getElementById('closeFirstLetterBtn');
        const sigmaStageUpText = document.getElementById('sigmaStageUpText');

        // Modal Content
        const finalScoreEl = document.getElementById('finalScore');
        const mistakesReviewTextEl = document.getElementById('mistakesReviewText');
        const reviewQuestionEl = document.getElementById('reviewQuestion');
        const reviewChoicesEl = document.getElementById('reviewChoices');
        const reviewUserAnswerEl = document.getElementById('reviewUserAnswer');
        const reviewUserAnswerTextEl = document.getElementById('reviewUserAnswerText');
        const hintTextEl = document.getElementById('hintText');
        const storeScoreDisplay = document.getElementById('storeScoreDisplay');
        const skibidiCorrectAnswerTextEl = document.getElementById('skibidiCorrectAnswerText');
        const firstLetterTextEl = document.getElementById('firstLetterText');

        // Ability & Notification Elements
        const abilitySkipEl = document.getElementById('abilitySkip');
        const abilityRedoEl = document.getElementById('abilityRedo');
        const abilityBoostEl = document.getElementById('abilityBoost');
        const abilityInfoBtn = document.getElementById('abilityInfoBtn');
        const skipUsesEl = document.getElementById('skipUses');
        const redoUsesEl = document.getElementById('redoUses');
        const hunchAbilityEl = document.getElementById('hunchAbility');
        const tinkerAbilityEl = document.getElementById('tinkerAbility');
        const pantherBuckAbilityEl = document.getElementById('pantherBuckAbility');
        const hunchProgressEl = document.getElementById('hunchProgress');
        const tinkerProgressEl = document.getElementById('tinkerProgress');
        const pantherBuckProgressEl = document.getElementById('pantherBuckProgress');
        const pantherBuckCounterEl = document.getElementById('pantherBuckCounter');
        const notificationTextEl = document.getElementById('notificationText');

        // Skibidi Mode elements
        const answerAreaEl = document.getElementById('answerArea');
        const skibidiFormEl = document.getElementById('skibidi-form');
        const skibidiInputEl = document.getElementById('skibidi-input');
        const answerGridEl = document.querySelector('.answer-grid');
        // NEW Myth Mode elements
        const mythAnswerButtons = document.getElementById('mythAnswerButtons');
        const factBtn = document.getElementById('factBtn');
        const mythBtn = document.getElementById('mythBtn');


        // --- SOUND ENGINE ---
        function playCorrectSound() {
            if (isMuted) return;
            const now = Tone.now();
            synth.triggerAttackRelease("C4", "8n", now);
            synth.triggerAttackRelease("E4", "8n", now + 0.1);
            synth.triggerAttackRelease("G4", "8n", now + 0.2);
            synth.triggerAttackRelease("C5", "8n", now + 0.3);
        }
        function playIncorrectSound() { if (isMuted) return;
            const now = Tone.now();
            synth.triggerAttackRelease("C2", "8n", now);
        }
        function playClickSound() { if (isMuted) return;
            pluckSynth.triggerAttack("C4", Tone.now());
            filterEnv.triggerAttack();
        }
        function playPurchaseSound() { if (isMuted) return;
            const now = Tone.now();
            synth.triggerAttackRelease("E5", "16n", now);
            synth.triggerAttackRelease("G5", "16n", now + 0.1);
        }
        function playStartSound() { if (isMuted) return;
            const now = Tone.now();
            synth.triggerAttackRelease("G3", "8n", now);
            synth.triggerAttackRelease("C4", "8n", now + 0.1);
        }
        function playStreakSound() { if (isMuted) return;
            const now = Tone.now();
            synth.triggerAttackRelease("G4", "8n", now);
            synth.triggerAttackRelease("C5", "8n", now + 0.1);
            synth.triggerAttackRelease("E5", "4n", now + 0.2);
        }
        function playPantherBuckSound() {
            const now = Tone.now();
            if (!isMuted) synth.triggerAttackRelease("A5", "8n", now);
        }

        // --- HELPER & NOTIFICATION FUNCTIONS ---
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
        }

        function adjustFontSize(element) {
            let fontSize = 150; // Start with a very large font size
            element.style.fontSize = `${fontSize}px`;

            // Loop to reduce font size until the text fits within the element's own bounds
            while ((element.scrollHeight > element.clientHeight || element.scrollWidth > element.clientWidth) && fontSize > 10) {
                fontSize--;
                element.style.fontSize = `${fontSize}px`;
            }
        }

        function triggerConfetti() {
            confetti({ particleCount: 100, spread: 70, origin: { y: 0.6 }, zIndex: 101 });
        }

        function addNotification(notification) {
            notificationQueue.push(notification);
            processNotificationQueue();
        }

        function processNotificationQueue() {
            if (isModalActive || notificationQueue.length === 0) {
                return;
            }
            isModalActive = true;
            const notification = notificationQueue.shift();

            triggerConfetti();

            if (notification.type === 'streak') {
                playStreakSound();
                streakTextEl.textContent = notification.text;
                streakModal.classList.remove('hidden');
            } else if (notification.type === 'pantherBuck') {
                playPantherBuckSound();
                pantherBuckModal.classList.remove('hidden');
            }
        }

        function updateNotification(message) {
            if (message === lastNotificationMessage) return;
            lastNotificationMessage = message;

            if (notificationTimer) clearTimeout(notificationTimer);

            // Reset all animations and content
            notificationTextEl.classList.remove('typing', 'glitch');
            notificationTextEl.textContent = '';
            notificationTextEl.dataset.text = '';

            // Force a reflow to restart the animation
            void notificationTextEl.offsetWidth;

            notificationTextEl.textContent = message;
            notificationTextEl.classList.add('typing');

            notificationTimer = setTimeout(() => {
                notificationTextEl.classList.remove('typing');
                notificationTextEl.classList.add('glitch');
                notificationTextEl.dataset.text = message; // Apply text for glitch effect
            }, 1000); // Duration should match the typing animation
        }

        // --- STORE LOGIC ---
        const storeItems = {
            timeFreeze: { cost: 3 },
            timeBoost: { cost: 8 },
            timeWarp: { cost: 10 },
            diplomatsPass: { cost: 8 },
            hunchUpgrade: { cost: 15, permanent: true },
            streakInsurance: { cost: 5 },
            scholarsBookmark: { cost: 4 },
            loreMastersScroll: { cost: 25, permanent: true },
            firstLastLetterUpgrade: { cost: 3, permanent: true }
        };

        function openStore() {
            playClickSound();
            storeScoreDisplay.textContent = Math.floor(playerState.score);

            buyBtns.forEach(btn => {
                let originalItemName = btn.getAttribute('data-item-original') || btn.dataset.item;
                if (!btn.getAttribute('data-item-original')) {
                    btn.setAttribute('data-item-original', originalItemName);
                }

                let itemName = originalItemName;

                // Toggle store items based on game mode
                if (originalItemName === 'hunchUpgrade') {
                    const isSkibidi = gameMode === 'SKIBIDI';
                    hunchUpgradeStoreItem.classList.toggle('hidden', isSkibidi);
                    firstLastLetterStoreItem.classList.toggle('hidden', !isSkibidi);

                    const storeItem = btn.closest('.store-item');
                    if (isSkibidi) {
                        storeItem.dataset.description = "Permanent: The letter hint shows the first AND last letter of the answer.";
                    } else {
                        storeItem.dataset.description = "Permanent: Hunch removes 2 wrong answers.";
                    }

                    if (isSkibidi) {
                        itemName = 'firstLastLetterUpgrade';
                    } else {
                        itemName = 'hunchUpgrade';
                    }
                    btn.textContent = `Buy (${storeItems[itemName].cost} Pts)`; // Explicitly update text here
                    btn.dataset.item = itemName; // Update the button's current data attribute
                }

                // Re-fetch item after potential name change
                const currentItem = storeItems[itemName];
                if (!currentItem) return;

                // Disable if already purchased (for permanent items)
                if (currentItem.permanent && ((abilities.hunchUpgraded && itemName === 'hunchUpgrade') || (abilities.loreMasterActive && itemName === 'loreMastersScroll') || (abilities.firstLastLetterUpgraded && itemName === 'firstLastLetterUpgrade'))) {
                    btn.disabled = true;
                    btn.textContent = 'Purchased';
                    btn.classList.add('purchased');
                }

                // Disable if already have an active consumable
                else if ( (itemName === 'streakInsurance' && abilities.streakInsurance) || (itemName === 'diplomatsPass' && abilities.diplomatsPass) ) {
                     btn.disabled = true;
                     btn.textContent = 'Active';
                }
                // Disable if not enough points
                else if (playerState.score < currentItem.cost) {
                    btn.disabled = true;
                } else {
                    btn.disabled = false;
                    btn.textContent = `Buy (${currentItem.cost} Pts)`;
                    btn.classList.remove('purchased');
                }
            });

            storeModal.classList.remove('hidden');
        }

        function buyItem(e) {
            const itemName = e.target.dataset.item;
            const item = storeItems[itemName];

            if (Math.floor(playerState.score) >= item.cost) {
                playPurchaseSound();
                playerState.score -= item.cost;
                scoreEl.textContent = Math.floor(playerState.score);

                // Apply item effect
                switch (itemName) {
                    case 'timeFreeze':
                        timeLeft += 30;
                        timeCardEl.classList.add('flash-green');
                        setTimeout(() => timeCardEl.classList.remove('flash-green'), 1000);
                        updateNotification("+30 seconds purchased!");
                        break;
                    case 'timeBoost':
                        timeLeft += 60;
                        timeCardEl.classList.add('flash-green');
                        setTimeout(() => timeCardEl.classList.remove('flash-green'), 1000);
                        updateNotification("+60 seconds purchased!");
                        break;
                    case 'timeWarp':
                        timeLeft += 90;
                        timeCardEl.classList.add('flash-green');
                        setTimeout(() => timeCardEl.classList.remove('flash-green'), 1000);
                        updateNotification("+90 seconds purchased!");
                        break;
                    case 'diplomatsPass':
                        abilities.diplomatsPass = true;
                        updateNotification("Diplomat's Pass is active!");
                        break;
                    case 'hunchUpgrade':
                        abilities.hunchUpgraded = true;
                        updateNotification("Hunch Upgrade purchased!");
                        break;
                    case 'streakInsurance':
                        abilities.streakInsurance = true;
                        updateNotification("Streak Insurance is active!");
                        break;
                    case 'scholarsBookmark':
                        abilities.skip++;
                        updateAbilitiesUI();
                        updateNotification("Scholar's Bookmark purchased! +1 SKIP.");
                        break;
                    case 'loreMastersScroll':
                        // Ensure score is updated immediately if it's not a whole number
                        if (playerState.score % 1 !== 0) {
                            scoreEl.textContent = playerState.score.toFixed(2);
                        }
                        abilities.loreMasterActive = true;
                        updateNotification("Lore Master's Scroll purchased!");
                        break;
                    case 'firstLastLetterUpgrade':
                        abilities.firstLastLetterUpgraded = true;
                        firstLetterBtn.classList.add('first-letter-btn-glow');
                        updateNotification("Letter Insight purchased!");
                        break;
                }
                openStore(); // Refresh store UI after purchase
            }
        }


        // --- ABILITY LOGIC ---
        function updateAbilitiesUI() {
            const isSkibidi = gameMode === 'SKIBIDI';
            const hunchThreshold = isSkibidi ? 3 : 5;
            const tinkerThreshold = isSkibidi ? 2 : 4;
            const buckStreakThreshold = gameMode === 'HARD' ? 7 : (isSkibidi ? 5 : 10);

            pantherBuckCounterEl.textContent = `${playerState.pantherBucksEarned} üêæ`;

            if(isSkibidi) {
                hunchAbilityEl.style.display = 'none';
            } else {
                hunchAbilityEl.style.display = 'block';
                const hunchProgress = (playerState.correctAnswers % hunchThreshold) / hunchThreshold * 100;
                hunchProgressEl.style.width = `${hunchProgress}%`;
                hunchAbilityEl.classList.toggle('ready', hunchProgress >= 80);
                hunchAbilityEl.querySelector('.passive-ability-title').textContent = `Historian's Hunch (Next: ${hunchThreshold})`;
                if (hunchProgress > 50) {
                    hunchAbilityEl.classList.add('jiggle');
                    const duration = 0.4 - ((hunchProgress - 50) / 50) * 0.3;
                    hunchAbilityEl.style.animationDuration = `${duration}s`;
                } else {
                    hunchAbilityEl.classList.remove('jiggle');
                    hunchAbilityEl.style.animationDuration = '';
                }
            }

            const tinkerProgress = Math.min((playerState.streak / tinkerThreshold) * 100, 100);
            tinkerProgressEl.style.width = `${tinkerProgress}%`;
            tinkerAbilityEl.classList.toggle('ready', playerState.streak >= tinkerThreshold);
            tinkerAbilityEl.querySelector('.passive-ability-title').textContent = `Time Tinkerer (Streak: ${tinkerThreshold})`;
            if (tinkerProgress > 50) {
                tinkerAbilityEl.classList.add('jiggle');
                const duration = 0.4 - ((tinkerProgress - 50) / 50) * 0.3;
                tinkerAbilityEl.style.animationDuration = `${duration}s`;
            } else {
                tinkerAbilityEl.classList.remove('jiggle');
                tinkerAbilityEl.style.animationDuration = '';
            }

            // Update Panther Buck progress bar based on current streak
            const buckProgress = (playerState.streak % buckStreakThreshold) / buckStreakThreshold * 100;
            pantherBuckProgressEl.style.width = `${buckProgress}%`;
            pantherBuckAbilityEl.querySelector('.passive-ability-title').textContent = `Panther Buck (Streak: ${buckStreakThreshold})`;
            if (abilities.skip > 0) {
                abilitySkipEl.classList.remove('locked');
                abilitySkipEl.classList.add('earned');
                skipUsesEl.textContent = abilities.skip;
                skipUsesEl.classList.remove('hidden');
            } else {
                abilitySkipEl.classList.add('locked');
                abilitySkipEl.classList.remove('earned');
                skipUsesEl.classList.add('hidden');
            }
            if (abilities.redo > 0) {
                abilityRedoEl.classList.remove('locked');
                abilityRedoEl.classList.add('earned');
                redoUsesEl.textContent = abilities.redo;
                redoUsesEl.classList.remove('hidden');
            } else {
                abilityRedoEl.classList.add('locked');
                abilityRedoEl.classList.remove('earned');
                redoUsesEl.classList.add('hidden');
            }
            if (abilities.boost2xActive || abilities.boost3xActive) {
                abilityBoostEl.classList.remove('locked');
                abilityBoostEl.classList.add('active');
            } else {
                abilityBoostEl.classList.remove('active');
                // The 'locked' class is only added if no boost is active and streak is 0
                if (playerState.streak < (isSkibidi ? 4 : 7)) abilityBoostEl.classList.add('locked');
            }
        }

        function activateSkip() {
            if (abilities.skip > 0) {
                playClickSound();
                abilities.skip--;
                updateAbilitiesUI();
                updateNotification("Question skipped!");
                displayNextQuestion();
            }
        }

        function activateRedo() {
            if (abilities.redo > 0 && wrongAnswers.length > 0) {
                playClickSound();
                abilities.redo--;
                if (currentQuestionIndex !== -1) {
                    const currentQuestionObject = activeQuestionSet[currentQuestionIndex];
                    questionsCopy.push(currentQuestionObject);
                    shuffleArray(questionsCopy);
                }
                const questionsToRedo = [...wrongAnswers];
                questionsCopy.unshift(...questionsToRedo);
                updateNotification(`Second Chance! Answering ${wrongAnswers.length} questions again.`);
                wrongAnswers = [];
                updateAbilitiesUI();
                displayNextQuestion();
            }
        }

        // --- CORE GAME LOGIC ---
        function resetPlayerState() {
             playerState = {
                score: 0, questionsAnswered: 0, streak: 0, correctAnswers: 0,
                wrongStreak: 0, earned10Streak: false,
                earned3Streak: false, earned4Streak: false, earned5Streak: false, earned7Streak: false, hasSeenStoreInvite: false, pantherBucksAwardedForStreaks: [],
                historiansHunchPending: false, pantherBucksEarned: 0
            };
            abilities = {
                skip: 0, redo: 0, boost2xActive: false, boost3xActive: false,
                hunchUpgraded: false, streakInsurance: false, // Reset store-bought abilities
                loreMasterActive: false, diplomatsPass: false, historiansArchive: false, firstLastLetterUpgraded: false
            };
            wrongAnswers = [];
            permanentWrongAnswers = [];
        }

        function getQuestions(mode, grade) {
            if (!gameQuestions[mode]) {
                console.warn(`Mode ${mode} not found.`);
                return [];
            }
            if (!gameQuestions[mode][grade]) {
                console.warn(`Grade ${grade} not found in mode ${mode}.`);
                return [];
            }

            const gradeData = gameQuestions[mode][grade];
            let questions = [];
            // Iterate over units (unit1, unit2, etc.)
            Object.values(gradeData).forEach(unitQuestions => {
                if (Array.isArray(unitQuestions)) {
                    questions = questions.concat(unitQuestions);
                }
            });
            return questions;
        }

        async function startGame() {
            await Tone.start();
            if (storeNotificationInterval) clearInterval(storeNotificationInterval);
            playStartSound();
            resetPlayerState();
            isGamePaused = false; // Explicitly unpause the game at the start
            scoreEl.textContent = '0';
            streakEl.textContent = '0';
            correctAnswersEl.textContent = '0';
            sigmaProgressContainer.classList.add('hidden'); // Hide by default
            gradeModal.classList.add('hidden');

            const selectedGrade = gradeLevelSelect.value;
            let questionBank;
            let activeQuestionSetKey = selectedGrade; // Use the value from the select dropdown
            let initialNotification = "The challenge has begun. Good luck!";

            if (gameMode === 'SIGMA') {
                sigmaStage = 1;
                sigmaCorrectInStage = 0;
                sigmaProgressContainer.classList.remove('hidden');
                // Start with easy questions for stage 1
                activeQuestionSet = getQuestions('EASY', activeQuestionSetKey);
                questionsCopy = [...activeQuestionSet];
                initialNotification = "SIGMA MODE: Stage 1 - Easy Questions. Good luck!";
            } else {
                activeQuestionSet = getQuestions(gameMode, activeQuestionSetKey);
                questionsCopy = [...activeQuestionSet];
                shuffleArray(questionsCopy);
            }

            shuffleArray(questionsCopy);
            // UI setup based on game mode
            const isSkibidi = gameMode === 'SKIBIDI';
            answerGridEl.classList.toggle('hidden', isSkibidi);
            skibidiFormEl.classList.toggle('hidden', !isSkibidi);
            mythAnswerButtons.classList.add('hidden'); // Hide myth buttons by default
            hunchAbilityEl.classList.toggle('hidden', isSkibidi);
            firstLetterBtn.classList.toggle('hidden', !isSkibidi);
            if (isSkibidi) {
                firstLetterBtn.classList.remove('first-letter-btn-glow');
                hunchUpgradeStoreItem.nextElementSibling.dataset.item = 'firstLastLetterUpgrade';
            } else {
                hunchUpgradeStoreItem.nextElementSibling.dataset.item = 'hunchUpgrade';
            }

            updateAbilitiesUI();
            startTimer();
            updateNotification(initialNotification);
            displayNextQuestion();
            if (gameMode === 'SIGMA') {
                updateSigmaProgress();
            }
            startStoreNotifier();
        }

        function updateSigmaProgress() {
            if (gameMode !== 'SIGMA') return;

            const totalQuestionsInStage = activeQuestionSet.length;
            const requiredForNextStage = Math.ceil(totalQuestionsInStage / 2);

            // Progress is now based on correct answers in the stage
            const progress = (sigmaCorrectInStage / requiredForNextStage) * 100;
            sigmaProgressBar.style.width = `${progress}%`;
            sigmaProgressText.textContent = `${sigmaCorrectInStage} / ${requiredForNextStage} Correct`;
            sigmaStageDisplay.textContent = sigmaStage;
        }
        function startTimer() {
            if (timerInterval) clearInterval(timerInterval);
            timeLeft = gameMode === 'SIGMA' ? 60 : 300;
            timeHistory = [timeLeft];
            const initialMinutes = Math.floor(timeLeft / 60).toString().padStart(2, '0');
            const initialSeconds = (timeLeft % 60).toString().padStart(2, '0');

            timerEl.textContent = `${initialMinutes}:${initialSeconds}`;
            timerInterval = setInterval(() => {
                if (isGamePaused) return;
                timeLeft--;
                timeHistory.push(timeLeft);
                const minutes = Math.floor(timeLeft / 60).toString().padStart(2, '0');
                const seconds = (timeLeft % 60).toString().padStart(2, '0');
                timerEl.textContent = `${minutes}:${seconds}`;

                if (timeLeft === 150) updateNotification("Halfway through! Keep up the pace!");
                else if (timeLeft === 60) updateNotification("Warning: One minute remaining!");

                if (timeLeft <= 0) endGame();
            }, 1000);
        }

        function startStoreNotifier() {
            if (storeNotificationInterval) clearInterval(storeNotificationInterval);

            storeNotificationInterval = setInterval(() => {
                if (isGamePaused || isModalActive) return;

                // Find the minimum cost of an available item
                const minCost = Object.values(storeItems)
                    .filter(item => !item.permanent || !isItemPurchased(item))
                    .reduce((min, item) => Math.min(min, item.cost), Infinity);

                if (Math.floor(playerState.score) >= minCost) {
                    storeBtn.classList.add('store-ready');
                    updateNotification("You have enough points to buy items in the store! üõçÔ∏è");
                } else {
                    storeBtn.classList.remove('store-ready');
                }
            }, 10000); // Check every 10 seconds
        }

        function isItemPurchased(item) { return false; /* Placeholder for more complex logic if needed */ }

        function displayNextQuestion() {
            gameAreaEl.classList.add('switching');
            setTimeout(() => {
                const totalQuestionsInStage = activeQuestionSet.length;
                const requiredForNextStage = Math.ceil(totalQuestionsInStage / 2);

                // SIGMA Mode Stage Progression
                if (gameMode === 'SIGMA' && sigmaCorrectInStage >= requiredForNextStage) {
                    sigmaStage++;
                    const selectedGrade = gradeLevelSelect.value;
                    let nextQuestionSet = null;
                    let stageName = '';

                    if (sigmaStage === 2) {
                        nextQuestionSet = getQuestions('HARD', selectedGrade);
                        stageName = 'Hard';
                    } else if (sigmaStage === 3) {
                        nextQuestionSet = getQuestions('SKIBIDI', selectedGrade);
                        stageName = 'Skibidi';
                    }

                    if (nextQuestionSet && nextQuestionSet.length > 0) {
                        activeQuestionSet = nextQuestionSet;
                        isGamePaused = true;
                        questionsCopy = [...activeQuestionSet];
                        shuffleArray(questionsCopy);
                        sigmaCorrectInStage = 0; // Reset correct counter for new stage

                        sigmaStageUpText.textContent = `Congratulations! You are now entering Stage ${sigmaStage}: ${stageName} Questions!`;
                        sigmaStageUpModal.classList.remove('hidden');

                        updateSigmaProgress();
                        playStreakSound();
                    } else {
                        // All stages are complete
                        endGame();
                        return;
                    }
                }

                if (questionsCopy.length === 0) {
                    endGame();
                    return;
                }


                const question = questionsCopy.shift();
                currentQuestionIndex = activeQuestionSet.indexOf(question); // Keep track of the original question

                const isMythTypeQuestion = gameMode === 'MYTH';
                const isSkibidiTypeQuestion = gameMode === 'SKIBIDI' || (gameMode === 'SIGMA' && sigmaStage === 3);

                // Reset UI elements for all modes
                answerGridEl.classList.add('hidden');
                skibidiFormEl.classList.add('hidden');
                mythAnswerButtons.classList.add('hidden');
                hintBtn.classList.add('hidden'); // Hide by default, then show if applicable
                firstLetterBtn.classList.add('hidden'); // Hide by default, then show if applicable
                dokLabel.classList.add('hidden'); // Hide by default, then show if applicable

                // DOK Label Logic
                // DOK is only relevant for multiple-choice questions (Easy/Hard/Sigma-MC)
                if (question.dok && (gameMode === 'EASY' || gameMode === 'HARD' || (gameMode === 'SIGMA' && sigmaStage < 3))) {
                    dokLabel.textContent = `DOK ${question.dok}`;
                    dokLabel.classList.remove('hidden');
                } else {
                    dokLabel.classList.add('hidden');
                }


                if (isMythTypeQuestion) {
                    // --- MYTH DEBUNKER LOGIC ---
                    mythAnswerButtons.classList.remove('hidden');
                    factBtn.disabled = false;
                    mythBtn.disabled = false;
                } else if (isSkibidiTypeQuestion) {
                    // --- TYPED ANSWER LOGIC (SKIBIDI/SIGMA-SKIBIDI) ---
                    skibidiFormEl.classList.remove('hidden');
                    hintBtn.classList.remove('hidden'); // Show the standard hint button
                    firstLetterBtn.classList.remove('hidden'); // Show letter hint button for skibidi
                } else {
                    // --- MULTIPLE CHOICE LOGIC (EASY/HARD/SIGMA-MC) ---
                    answerGridEl.classList.remove('hidden');
                    hintBtn.classList.remove('hidden'); // Show the standard hint button
                }


                if(!isSkibidiTypeQuestion && !isMythTypeQuestion) {
                    // --- MULTIPLE CHOICE LOGIC (EASY/HARD/SIGMA-MC) ---

                    // --- Answer Randomization ---
                    // 1. Create a mappable array of choices with their original index
                    let choicesWithOriginalIndex = question.choices.map((text, index) => ({ text, originalIndex: index }));

                    // 2. Shuffle this new array
                    shuffleArray(choicesWithOriginalIndex);

                    // 3. Find the new position of the correct answer
                    const newCorrectAnswerIndex = choicesWithOriginalIndex.findIndex(choice => choice.originalIndex === question.answer);

                    // Reset UI elements
                    answerChoices.forEach(choice => {
                        choice.classList.remove('correct', 'incorrect', 'removed');
                        choice.style.pointerEvents = 'auto';
                    });

                    // Apply Hunch logic before displaying, using the shuffled positions
                    if (playerState.historiansHunchPending) {
                        let wrongChoiceElements = [0, 1, 2, 3].filter(i => i !== newCorrectAnswerIndex);
                        shuffleArray(wrongChoiceElements);
                        const choicesToRemove = abilities.hunchUpgraded ? 2 : 1;
                        for(let i=0; i < choicesToRemove && i < wrongChoiceElements.length; i++) {
                            answerChoices[wrongChoiceElements[i]].classList.add('removed');
                            answerChoices[wrongChoiceElements[i]].style.pointerEvents = 'none';
                        }
                        playerState.historiansHunchPending = false;
                        const message = abilities.hunchUpgraded ? "Hunch Upgrade: Two wrong answers removed." : "Historian's Hunch: One wrong answer removed.";
                        updateNotification(message);
                    }

                    // 4. Populate the UI with the shuffled choices
                    answerChoices.forEach((choiceEl, index) => {
                        choiceEl.querySelector('p').textContent = choicesWithOriginalIndex[index].text;
                        // Temporarily store the new correct index on the game area for handleAnswerClick
                        gameAreaEl.dataset.correct = newCorrectAnswerIndex;
                    });
                } else { // --- TYPED ANSWER LOGIC (SKIBIDI/SIGMA-SKIBIDI) ---
                }

                // Reset hint button state
                hintBtn.disabled = false;
                if (gameMode === 'SKIBIDI') {
                    firstLetterBtn.disabled = false;
                }

                const questionText = question.question;
                questionTextEl.textContent = questionText;

                // For Skibidi and Myth mode, clear and enable input/buttons
                if (isSkibidiTypeQuestion) {
                    skibidiInputEl.value = '';
                    skibidiInputEl.disabled = false;
                    skibidiInputEl.focus();
                    skibidiInputEl.classList.remove('correct', 'incorrect');
                }

                adjustFontSize(questionTextEl);

                gameAreaEl.classList.remove('switching');

                // Update progress AFTER the question has been shifted from the array.
                updateSigmaProgress();
            }, 300);
        }

        function normalizeAnswer(answer) {
            return answer.toLowerCase().trim().replace(/[.,\/#!$%\^&\*;:{}=\-_`~()]/g,"");
        }

        function handleSkibidiSubmit(e) {
            e.preventDefault();
            const userAnswer = skibidiInputEl.value;
            if (!userAnswer) return;

            const question = activeQuestionSet[currentQuestionIndex]; // This is correct
            const correctAnswers = Array.isArray(question.answer) ? question.answer : [question.answer];
            const isCorrect = correctAnswers.some(ans => normalizeAnswer(userAnswer) === normalizeAnswer(ans));

            skibidiInputEl.disabled = true;
            // Disable hint buttons after answering
            hintBtn.disabled = true;
            firstLetterBtn.disabled = true;

            handleAnswer(isCorrect, null);
        }


        function handleAnswerClick(e) {
            const selectedChoiceEl = e.currentTarget;
            const selectedAnswer = parseInt(selectedChoiceEl.dataset.choice);
            // Retrieve the correct answer's current position from the dataset
            const correctAnswer = parseInt(gameAreaEl.dataset.correct);

            // Disable hint buttons after answering
            hintBtn.disabled = true;
            firstLetterBtn.disabled = true;

            answerChoices.forEach(choice => choice.style.pointerEvents = 'none');
            selectedChoiceEl.classList.add(selectedAnswer === correctAnswer ? 'correct' : 'incorrect');
            if(selectedAnswer !== correctAnswer) {
                 answerChoices[correctAnswer].classList.add('correct');
            }

            handleAnswer(selectedAnswer === correctAnswer, selectedChoiceEl, selectedChoiceEl.querySelector('p').textContent);
        }

        function handleMythAnswerClick(e) {
            const selectedButton = e.currentTarget;
            const userAnswerIsFact = selectedButton.id === 'factBtn';

            // Disable buttons to prevent double-clicking
            factBtn.disabled = true;
            mythBtn.disabled = true;

            const question = activeQuestionSet[currentQuestionIndex];
            const isCorrect = userAnswerIsFact === question.isFact;

            // Highlight correct/incorrect
            selectedButton.classList.add(isCorrect ? 'correct' : 'incorrect');
            if (!isCorrect) {
                const correctButton = question.isFact ? factBtn : mythBtn;
                correctButton.classList.add('correct');
            }
            handleAnswer(isCorrect, null); // Pass null for selectedChoiceEl as it's not a standard MC
            showExplanation(question.explanation); // Always show explanation in Myth mode
        }

        function showExplanation(explanation, isCorrect) {
            isGamePaused = true;
            explanationTextEl.textContent = explanation;
            explanationModal.classList.remove('hidden');
        }

        function handleAnswer(isCorrect, selectedChoiceEl) {
            let proceedToNextQuestionAutomatically = true;
            playerState.questionsAnswered++;
            const isSkibidi = gameMode === 'SKIBIDI';
            const hunchThreshold = isSkibidi ? 3 : 5;
            const tinkerThreshold = isSkibidi ? 2 : 4;
            const skipThreshold = isSkibidi ? 2 : 3;
            const redoThreshold = isSkibidi ? 3 : 5;
            const boostThreshold = isSkibidi ? 4 : 7;

            // Update Score Boost button text and fill
            const boost3xThreshold = isSkibidi ? 6 : 10;
            const nextBoostThreshold = abilities.boost2xActive ? boost3xThreshold : boostThreshold;
            const boostText = abilities.boost3xActive ? '3x BOOST' : (abilities.boost2xActive ? '2x BOOST (Next: 3x)' : '2x BOOST');
            abilityBoostEl.querySelector('span').textContent = boostText;


            if (isCorrect) {
                // Add time in SIGMA mode
                if (gameMode === 'SIGMA') {
                    let timeToAdd = 15; // Default for stage 1
                    if (sigmaStage === 2) timeToAdd = 20;
                    if (sigmaStage === 3) timeToAdd = 25;
                    timeLeft += timeToAdd;
                    sigmaCorrectInStage++;
                    timeCardEl.classList.add('flash-green');
                    setTimeout(() => timeCardEl.classList.remove('flash-green'), 1000);
                } else if (isSkibidi) {
                    // This is for the original skibidi mode, not sigma skibidi stage
                    // No time is added here.
                }

                if(skibidiFormEl.style.display !== 'none') skibidiInputEl.classList.add('correct');
                playerState.correctAnswers++;
                playerState.wrongStreak = 0;

                let basePoints = abilities.loreMasterActive ? 1.25 : 1;
                let pointsToAdd;

                if (abilities.boost3xActive) {
                    pointsToAdd = basePoints * 3;
                } else if (abilities.boost2xActive) {
                    pointsToAdd = basePoints * 2;
                } else {
                    pointsToAdd = basePoints;
                }

                playerState.score += pointsToAdd; // Always update the actual score
                scoreEl.textContent = Number(playerState.score.toFixed(2)).toString().replace(/\.00$/, ''); // Then update the display
                correctAnswersEl.textContent = playerState.correctAnswers;

                if (!isSkibidi && playerState.correctAnswers > 0 && playerState.correctAnswers % hunchThreshold === 0) {
                    playerState.historiansHunchPending = true;
                }

                playerState.streak++;
                streakEl.textContent = playerState.streak;

                let specialEventOccurred = false;
                if (playerState.streak === skipThreshold && !playerState.earned3Streak) {
                    abilities.skip++;
                    playerState.earned3Streak = true;
                    addNotification({ type: 'streak', text: "You earned a SKIP!" });
                    specialEventOccurred = true;
                } else if (playerState.streak === tinkerThreshold && !playerState.earned4Streak) {
                    timeLeft += 15;
                    timeCardEl.classList.add('flash-green');
                    setTimeout(() => timeCardEl.classList.remove('flash-green'), 1000);
                    playerState.earned4Streak = true;
                    addNotification({ type: 'streak', text: "TIME BONUS! +15 Seconds!" });
                    specialEventOccurred = true;
                } else if (playerState.streak === redoThreshold && !playerState.earned5Streak) {
                    abilities.redo++;
                    playerState.earned5Streak = true;
                    addNotification({ type: 'streak', text: "You earned a SECOND CHANCE!" });
                    specialEventOccurred = true;
                } else if (playerState.streak === boostThreshold && !abilities.boost2xActive) {
                    abilities.boost2xActive = true;
                    playerState.earned7Streak = true;
                    addNotification({ type: 'streak', text: "2x SCORE BOOST is active!" });
                    specialEventOccurred = true;
                } else if (playerState.streak === boost3xThreshold && !abilities.boost3xActive) {
                    abilities.boost3xActive = true;
                    playerState.earned10Streak = true;
                    addNotification({ type: 'streak', text: "UPGRADE! 3x SCORE BOOST is active!" });
                    specialEventOccurred = true;
                }

                // New Panther Buck Streak Logic
                const buckStreakThreshold = gameMode === 'HARD' ? 7 : (isSkibidi ? 5 : 10);
                if (playerState.streak > 0 && playerState.streak % buckStreakThreshold === 0 && !playerState.pantherBucksAwardedForStreaks.includes(playerState.streak)) {
                    playerState.pantherBucksEarned++;
                    playerState.pantherBucksAwardedForStreaks.push(playerState.streak);
                    addNotification({ type: 'pantherBuck' });
                    updateNotification(`A ${playerState.streak}-streak earned you a Panther Buck!`);
                    specialEventOccurred = true; // This ensures the panther buck modal shows
                }

                if (!specialEventOccurred && notificationQueue.length === 0) {
                    playCorrectSound();
                    triggerConfetti();
                }

                if (abilities.skip > 0) updateNotification("SKIP ability is ready to use.");
                // This notification is no longer relevant with the new streak-based system.
                // else if (buckThreshold - playerState.pantherBuckProgress === 1) updateNotification("One more for a Panther Buck!");
                else if (playerState.streak === 2) updateNotification("Great! That's two in a row.");
                else if (playerState.streak === 6) updateNotification("Incredible 6-question streak!");
                else {
                    const randomMessage = correctMessages[Math.floor(Math.random() * correctMessages.length)];
                    updateNotification(randomMessage);
                }

                if (gameMode === 'SKIBIDI' && !abilities.firstLastLetterUpgraded && playerState.score >= 5) {
                    updateNotification("You can afford Letter Insight in the store!");
                }

            } else { // If the answer is INCORRECT
                playIncorrectSound();
                document.body.classList.add('red-flash');

                // Store the actual question object
                const currentQuestionObject = activeQuestionSet[currentQuestionIndex];

                if (currentQuestionObject && !wrongAnswers.includes(currentQuestionObject)) {
                    wrongAnswers.push(currentQuestionObject);
                }

                if (currentQuestionObject && !permanentWrongAnswers.includes(currentQuestionObject)) {
                    permanentWrongAnswers.push(currentQuestionObject);
                }

                // Streak Insurance Check
                if (abilities.streakInsurance) {
                    abilities.streakInsurance = false; // Use up the insurance
                    updateNotification("Streak Insurance saved your streak!");
                } else {
                    playerState.streak = 0;
                    playerState.earned3Streak = false;
                    playerState.earned4Streak = false;
                    playerState.earned5Streak = false;
                    playerState.earned7Streak = false;
                    playerState.earned10Streak = false;
                    // Resetting streak also means they can earn panther bucks again for those streaks if they reach them.
                    if (abilities.boost2xActive || abilities.boost3xActive) {
                        abilities.boost2xActive = abilities.boost3xActive = false;
                        updateNotification("2x Boost lost! Be careful.");
                    }
                }

                playerState.wrongStreak++;
                streakEl.textContent = playerState.streak;

                if (playerState.wrongStreak === 2 && gameMode !== 'MYTH') playerState.wrongStreak = 0; // Only reset wrong streak for non-myth modes

                headerGridEl.classList.add('shake');
                gameAreaEl.classList.add('shake');

                if (!skibidiFormEl.classList.contains('hidden')) { // Check if it's a typed-answer question
                    proceedToNextQuestionAutomatically = false; // Stop the automatic next question
                    skibidiInputEl.classList.add('incorrect');
                    updateNotification("Incorrect. Review the answer below.");

                    // Show the modal with the correct answer
                    const question = activeQuestionSet[currentQuestionIndex];
                    if (!question) { // Fallback if question is somehow undefined
                        updateNotification("Error: Question not found for review.");
                        return;
                    }
                    const correctAnswer = Array.isArray(question.answer) ? question.answer.join(' / ') : question.answer;
                    skibidiCorrectAnswerTextEl.textContent = correctAnswer;
                    skibidiIncorrectModal.classList.remove('hidden');
                } else {
                    updateNotification("Incorrect. Don't lose focus!");
                }

                setTimeout(() => {
                    headerGridEl.classList.remove('shake');
                    gameAreaEl.classList.remove('shake');
                    document.body.classList.remove('red-flash');
                    if(!skibidiFormEl.classList.contains('hidden')) {
                        skibidiInputEl.classList.remove('correct', 'incorrect');
                    }
                }, 500);
            }

            updateAbilitiesUI();
            if (proceedToNextQuestionAutomatically && gameMode !== 'MYTH') { // Do not auto-proceed in Myth mode
                setTimeout(displayNextQuestion, 2000);
            }
        }

        function endGame() {
            if (!timerInterval && endGameModal.classList.contains('hidden')) return;
            clearInterval(timerInterval);
            clearInterval(storeNotificationInterval);
            timerInterval = null;
            isGamePaused = true;
            timerEl.textContent = "00:00";
            finalScoreEl.textContent = Math.floor(playerState.score);

            if (permanentWrongAnswers.length > 0) {
                mistakesReviewTextEl.textContent = `You made ${permanentWrongAnswers.length} mistake(s).`;
                reviewMistakesBtn.classList.remove('hidden');
            } else {
                mistakesReviewTextEl.textContent = "You made 0 mistakes. Perfect game!";
                reviewMistakesBtn.classList.add('hidden');
            }

            endGameModal.classList.remove('hidden');
        }


        function setupNewTurn() {
            if(timerInterval) clearInterval(timerInterval);
            if(storeNotificationInterval) clearInterval(storeNotificationInterval);
            timeLeft = 300;
            timerEl.textContent = "05:00";
            endGameModal.classList.add('hidden');
            difficultyModal.classList.remove('hidden'); // Go back to difficulty select
            gradeModal.classList.add('hidden');
            reviewModal.classList.add('hidden');
            scoreEl.textContent = '0';
            streakEl.textContent = '0';
            sigmaProgressContainer.classList.add('hidden');
            correctAnswersEl.textContent = '0';
            questionTextEl.textContent = 'Choose your difficulty to begin!';

            if(gameMode !== 'SKIBIDI') {
                answerChoices.forEach(choice => {
                    choice.querySelector('p').textContent = '';
                    choice.classList.remove('correct', 'incorrect');
                });
            } else {
                // Reset store buttons to their default state on a new turn
                buyBtns.forEach(btn => {
                    btn.disabled = false;
                    btn.classList.remove('purchased');
                    const itemName = btn.dataset.item;
                    if (storeItems[itemName]) {
                        btn.textContent = `Buy (${storeItems[itemName].cost} Pts)`;
                    }
                });
                skibidiInputEl.value = '';
            }

            resetPlayerState();
            updateAbilitiesUI();
            storeBtn.classList.remove('store-ready');
            updateNotification("Welcome! Choose your difficulty to begin.");
        }

        function resetAllData() {
            playClickSound();
            resetConfirmModal.classList.add('hidden');
            setupNewTurn();
        }

        function showHint() {
            playClickSound();
            if (currentQuestionIndex > -1) {
                if (abilities.diplomatsPass) {
                    abilities.diplomatsPass = false;
                    updateNotification("Diplomat's Pass used! The timer will not pause.");
                } else {
                    isGamePaused = true;
                }
                const hint = activeQuestionSet[currentQuestionIndex].hint;
                hintTextEl.textContent = hint;
                hintModal.classList.remove('hidden');
            }
        }

        function showFirstLetters() {
            playClickSound();
            const currentQuestion = activeQuestionSet[currentQuestionIndex];
            const isSkibidiTypeQuestion = currentQuestion && !currentQuestion.choices;

            if (currentQuestionIndex > -1 && isSkibidiTypeQuestion) {
                isGamePaused = true;
                const question = activeQuestionSet[currentQuestionIndex];
                // Use the first answer in the array if multiple are possible
                const answer = (Array.isArray(question.answer) ? question.answer[0] : question.answer).trim();
                let hintText;
                if (abilities.firstLastLetterUpgraded) {
                    const first = answer.charAt(0);
                    const last = answer.length > 1 ? answer.charAt(answer.length - 1) : '';
                    hintText = `${first}...${last}`;
                } else {
                    hintText = answer.split(' ').map(word => word.charAt(0)).join(' ');
                }
                firstLetterTextEl.textContent = hintText;
                firstLetterModal.classList.remove('hidden');
            }
        }

        function showHelpModal() {
            playClickSound();
            isGamePaused = true;
            const isSkibidi = gameMode === 'SKIBIDI';

            // Clear existing content
            const helpContainer = document.getElementById('helpContentContainer');
            helpContainer.innerHTML = '';

            // Set title
            abilityInfoModal.querySelector('h2').textContent = "Help Center";

            // Generate content based on game mode
            const helpContent = `
                <div class="grid md:grid-cols-2 gap-4 text-base">
                    <div class="bg-slate-100 p-4 rounded-lg border-2 border-slate-300">
                        <h3 class="font-bold text-lg mb-2 text-blue-600">üéØ Game Goal</h3>
                        <p>Answer as many questions as you can before the timer runs out! Correct answers earn points, and streaks unlock special abilities.</p>
                    </div>
                    <div class="bg-slate-100 p-4 rounded-lg border-2 border-slate-300">
                        <h3 class="font-bold text-lg mb-2 text-yellow-600">üõçÔ∏è The Store</h3>
                        <p>Click the "Store" button to spend points on powerful one-time items and permanent upgrades to help you in your game.</p>
                    </div>
                    <div class="bg-slate-100 p-4 rounded-lg border-2 border-slate-300 ${isSkibidi ? '' : 'md:col-span-2'}">
                        <h3 class="font-bold text-lg mb-2 text-orange-600">${isSkibidi ? '‚å®Ô∏è Skibidi Mode' : '‚ùì Hints'}</h3>
                        ${isSkibidi ? `
                        <ul class="list-disc list-inside space-y-1">
                            <li><strong>Type Your Answers:</strong> No multiple choice! Spelling counts.</li>
                            <li><strong>Letter Hints:</strong> Use the 'A_' button to see the first letter(s) of the answer.</li>
                            <li><strong>Faster Abilities:</strong> All streak and correct-answer requirements are reduced!</li>
                        </ul>
                        ` : `
                        <p>Click the <strong>'?' button</strong> below the question to get a clue. Be careful, the timer will pause while the hint is open unless you have a special item from the store!</p>
                        `}
                    </div>
                    <div class="bg-slate-100 p-4 rounded-lg border-2 border-slate-300 ${isSkibidi ? '' : 'md:col-span-2'}">
                        <h3 class="font-bold text-lg mb-2 text-purple-600">‚ö° Abilities</h3>
                        <p class="mb-2">Abilities are earned through streaks and total correct answers. They are divided into Passive (automatic) and Active (clickable) types.</p>
                        <ul class="list-disc list-inside space-y-1">
                            <li><strong>Time Tinkerer (Passive):</strong> Get a <strong>${isSkibidi ? '2' : '4'}-streak</strong> to add <strong>15 seconds</strong> to the clock.</li>
                            ${!isSkibidi ? `<li><strong>Historian's Hunch (Passive):</strong> For every <strong>5 correct answers</strong>, one wrong choice is removed on the next question.</li>` : ''}
                            <li><strong>Panther Bucks (Streak-Based):</strong> Earn a Panther Buck for achieving a <strong>${gameMode === 'HARD' ? '7' : (isSkibidi ? '5' : '10')}-streak</strong>!</li>
                            <li><strong>SKIP (Active):</strong> Earned at a <strong>${isSkibidi ? '2' : '3'}-streak</strong>. Click to skip a hard question.</li>
                            <li><strong>REDO (Active):</strong> Earned at a <strong>${isSkibidi ? '3' : '5'}-streak</strong>. Brings back all your wrong answers for another try.</li>
                            <li><strong>2x BOOST (Active):</strong> Earned at a <strong>${isSkibidi ? '4' : '7'}-streak</strong>. Doubles your points until you get one wrong.</li>
                        </ul>
                    </div>
                </div>
            `;
            helpContainer.innerHTML = helpContent;
            abilityInfoModal.classList.remove('hidden');
        }

        // --- REVIEW MISTAKES LOGIC ---
        function openReviewModal() {
            playClickSound();
            if (permanentWrongAnswers.length === 0) return;
            reviewIndex = 0;
            endGameModal.classList.add('hidden');
            reviewModal.classList.remove('hidden');
            displayReviewQuestion();
        }

        function displayReviewQuestion() {
            const question = permanentWrongAnswers[reviewIndex];

            document.getElementById('reviewCounter').textContent = `${reviewIndex + 1} / ${permanentWrongAnswers.length}`;
            reviewQuestionEl.textContent = question.question;
            reviewChoicesEl.innerHTML = ''; // Clear previous choices

            if (gameMode === 'MYTH') {
                reviewUserAnswerEl.classList.add('hidden');
                const correctAnswerText = question.isFact ? 'Fact' : 'Myth';
                reviewChoicesEl.innerHTML = `
                    <div class="p-3 rounded-lg bg-green-200 border-2 border-green-700 text-green-800 font-bold">Correct Answer: ${correctAnswerText}</div>
                    <div class="p-3 mt-2 rounded-lg bg-yellow-100 border-2 border-yellow-400 text-yellow-800">${question.explanation}</div>
                `;
            } else if (!question.choices) { // Check if it's a skibidi-type question
                reviewUserAnswerEl.classList.add('hidden'); // Not tracking user's typed answer for now
                const correctAnswerText = Array.isArray(question.answer) ? question.answer.join(' / ') : question.answer;
                reviewChoicesEl.innerHTML = `<div class="p-3 rounded-lg bg-green-200 border-2 border-green-700 text-green-800 font-bold">Correct Answer: ${correctAnswerText}</div>`;
            } else { // Standard multiple-choice question
                reviewUserAnswerEl.classList.add('hidden'); // Not tracking user's choice for now
                question.choices.forEach((choiceText, index) => {
                    const choiceDiv = document.createElement('div');
                    choiceDiv.textContent = choiceText;
                    choiceDiv.className = 'p-3 rounded-lg border-2';
                    if (index === question.answer) {
                        choiceDiv.classList.add('bg-green-200', 'border-green-700', 'text-green-800', 'font-bold');
                    } else {
                        choiceDiv.classList.add('bg-gray-100', 'border-gray-400');
                    }
                    reviewChoicesEl.appendChild(choiceDiv);
                });
            }

            prevReviewBtn.disabled = reviewIndex === 0;
            nextReviewBtn.disabled = reviewIndex === permanentWrongAnswers.length - 1;
        }




        // --- EVENT LISTENERS ---
        easyModeBtn.addEventListener('click', () => {
            playClickSound();
            gameMode = 'EASY';
            difficultyModal.classList.add('hidden');
            easyRulesModal.classList.remove('hidden');
        });
        hardModeBtn.addEventListener('click', () => {
            playClickSound();
            gameMode = 'HARD';
            difficultyModal.classList.add('hidden');
            hardRulesModal.classList.remove('hidden');
        });

        acceptEasyBtn.addEventListener('click', () => {
            playClickSound();
            easyRulesModal.classList.add('hidden');
            gradeModal.classList.remove('hidden');
        });
        declineEasyBtn.addEventListener('click', () => {
            playClickSound();
            easyRulesModal.classList.add('hidden');
            difficultyModal.classList.remove('hidden');
        });
        acceptHardBtn.addEventListener('click', () => {
            playClickSound();
            hardRulesModal.classList.add('hidden');
            gradeModal.classList.remove('hidden');
        });
        declineHardBtn.addEventListener('click', () => {
            playClickSound();
            hardRulesModal.classList.add('hidden');
            difficultyModal.classList.remove('hidden');
        });
        skibidiModeBtn.addEventListener('click', () => {
            playClickSound();
            gameMode = 'SKIBIDI';
            difficultyModal.classList.add('hidden');
            skibidiRulesModal.classList.remove('hidden');
        });

        sigmaModeBtn.addEventListener('click', () => {
            playClickSound();
            gameMode = 'SIGMA';
            difficultyModal.classList.add('hidden');
            sigmaRulesModal.classList.remove('hidden');
        });
        acceptSigmaBtn.addEventListener('click', () => {
            playClickSound();
            sigmaRulesModal.classList.add('hidden');
            gradeModal.classList.remove('hidden');
        });
        declineSigmaBtn.addEventListener('click', () => {
            playClickSound();
            sigmaRulesModal.classList.add('hidden');
            difficultyModal.classList.remove('hidden');
        });

        acceptSkibidiBtn.addEventListener('click', () => {
            playClickSound();
            skibidiRulesModal.classList.add('hidden');
            gradeModal.classList.remove('hidden');
        });
        declineSkibidiBtn.addEventListener('click', () => {
            playClickSound();
            skibidiRulesModal.classList.add('hidden');
            difficultyModal.classList.remove('hidden');
        });

        mythModeBtn.addEventListener('click', () => {
            playClickSound();
            gameMode = 'MYTH';
            difficultyModal.classList.add('hidden');
            mythRulesModal.classList.remove('hidden');
        });
        acceptMythBtn.addEventListener('click', () => {
            playClickSound();
            mythRulesModal.classList.add('hidden');
            gradeModal.classList.remove('hidden');
        });
        declineMythBtn.addEventListener('click', () => {
            playClickSound();
            mythRulesModal.classList.add('hidden');
            difficultyModal.classList.remove('hidden');
        });

        backToDifficultyBtn.addEventListener('click', () => {
            playClickSound();
            gradeModal.classList.add('hidden');
            difficultyModal.classList.remove('hidden');
        });


        startGameBtn.addEventListener('click', startGame);
        newGameBtn.addEventListener('click', () => { playClickSound(); setupNewTurn(); });
        reviewMistakesBtn.addEventListener('click', openReviewModal);
        closeReviewBtn.addEventListener('click', () => {
            playClickSound();
            reviewModal.classList.add('hidden');
            endGameModal.classList.remove('hidden'); // Show end game modal again
        });
        nextReviewBtn.addEventListener('click', () => {
            playClickSound();
            if (reviewIndex < permanentWrongAnswers.length - 1) { reviewIndex++; displayReviewQuestion(); }
        });
        prevReviewBtn.addEventListener('click', () => {
            playClickSound();
            if (reviewIndex > 0) { reviewIndex--; displayReviewQuestion(); }
        });
        storeBtn.addEventListener('click', openStore);
        endTurnBtn.addEventListener('click', () => { playClickSound(); endGame(); });
        resetAllBtn.addEventListener('click', () => { playClickSound(); resetConfirmModal.classList.remove('hidden'); });
        aboutBtn.addEventListener('click', () => { playClickSound(); aboutModal.classList.remove('hidden'); });
        hintBtn.addEventListener('click', showHint);
        closeAboutBtn.addEventListener('click', () => { playClickSound(); aboutModal.classList.add('hidden'); });
        confirmResetBtn.addEventListener('click', resetAllData);
        cancelResetBtn.addEventListener('click', () => { playClickSound(); resetConfirmModal.classList.add('hidden'); });

        // Settings Modal Listeners
        settingsBtn.addEventListener('click', () => {
            playClickSound();
            isGamePaused = true;
            settingsModal.classList.remove('hidden');
        });
        closeSettingsBtn.addEventListener('click', () => {
            playClickSound();
            settingsModal.classList.add('hidden');
            if (timerInterval) isGamePaused = false;
        });
        soundToggle.addEventListener('click', () => {
            isMuted = !isMuted;
            soundToggle.classList.toggle('bg-green-500', !isMuted);
            soundToggle.classList.toggle('bg-gray-300', isMuted);
            document.getElementById('soundToggleKnob').classList.toggle('translate-x-6', !isMuted);
            document.getElementById('soundToggleKnob').classList.toggle('translate-x-1', isMuted);
            if (!isMuted) playClickSound();
        });

        closeHintBtn.addEventListener('click', () => {
            playClickSound();
            hintModal.classList.add('hidden');
            if (timerInterval) isGamePaused = false;
        });
        closeExplanationBtn.addEventListener('click', () => {
            playClickSound();
            explanationModal.classList.add('hidden');
            displayNextQuestion(); // Move to the next question after closing the explanation
        });
        closeStreakBtn.addEventListener('click', () => {
            playClickSound();
            streakModal.classList.add('hidden');
            isModalActive = false;
            processNotificationQueue();
        });
        firstLetterBtn.addEventListener('click', showFirstLetters);
        closeFirstLetterBtn.addEventListener('click', () => {
            playClickSound();
            firstLetterModal.classList.add('hidden');
            isGamePaused = false;
        });
        answerChoices.forEach(choice => choice.addEventListener('click', handleAnswerClick));
        factBtn.addEventListener('click', handleMythAnswerClick);
        mythBtn.addEventListener('click', handleMythAnswerClick);
        skibidiFormEl.addEventListener('submit', handleSkibidiSubmit);

        // Listener for the new Skibidi incorrect modal
        closeSkibidiIncorrectBtn.addEventListener('click', () => {
            playClickSound();
            skibidiIncorrectModal.classList.add('hidden');
            displayNextQuestion(); // Proceed to the next question only after closing the modal
        });

        closeSigmaStageUpBtn.addEventListener('click', () => {
            playClickSound();
            sigmaStageUpModal.classList.add('hidden');
            isGamePaused = false;
            updateNotification(`Stage ${sigmaStage} has begun. Good luck!`);
        });

        // Store Listeners
        closeStoreBtn.addEventListener('click', () => { playClickSound(); storeModal.classList.add('hidden'); });
        buyBtns.forEach(btn => btn.addEventListener('click', buyItem));

        // Ability Listeners
        abilitySkipEl.addEventListener('click', activateSkip);
        abilityRedoEl.addEventListener('click', activateRedo);
        abilityInfoBtn.addEventListener('click', showHelpModal);
        closeAbilityInfoBtn.addEventListener('click', () => {
            playClickSound();
            abilityInfoModal.classList.add('hidden');
            // Only unpause if the game is actually running and not showing another modal
            if (timerInterval) isGamePaused = false;
        });
        closePantherBuckBtn.addEventListener('click', () => {
            playClickSound();
            pantherBuckModal.classList.add('hidden');
            isModalActive = false;
            processNotificationQueue();
        });

        // Initial setup
        updateNotification("Welcome! Choose your difficulty to begin.");

        window.addEventListener('resize', () => {
            if (currentQuestionIndex > -1) {
                adjustFontSize(questionTextEl);
            }
        });

        // Store Tooltip Logic
        const storeTooltip = document.getElementById('storeTooltip');
        const storeItemsEls = document.querySelectorAll('.store-item');

        storeItemsEls.forEach(item => {
            item.addEventListener('mouseenter', (e) => {
                const desc = item.dataset.description;
                if (desc) {
                    storeTooltip.textContent = desc;
                    storeTooltip.style.display = 'block';
                }
            });
            item.addEventListener('mousemove', (e) => {
                storeTooltip.style.left = e.clientX + 15 + 'px';
                storeTooltip.style.top = e.clientY + 15 + 'px';
            });
            item.addEventListener('mouseleave', () => {
                storeTooltip.style.display = 'none';
            });
        });
    </script>
</body>
</html>
